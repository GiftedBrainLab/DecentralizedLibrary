var Aa=Object.defineProperty;var zr=Object.getOwnPropertySymbols;var Ra=Object.prototype.hasOwnProperty,ba=Object.prototype.propertyIsEnumerable;var qr=(De,ke,ve)=>ke in De?Aa(De,ke,{enumerable:!0,configurable:!0,writable:!0,value:ve}):De[ke]=ve,vr=(De,ke)=>{for(var ve in ke||(ke={}))Ra.call(ke,ve)&&qr(De,ve,ke[ve]);if(zr)for(var ve of zr(ke))ba.call(ke,ve)&&qr(De,ve,ke[ve]);return De};import{c as La,a as Da,R as Ia,r as wa}from"./index.29f8f2ea.js";import{a as Qr}from"./index.0890b907.js";var $r={exports:{}};(function(De,ke){typeof window!="undefined"&&function(re,j){De.exports=j()}(La,function(){return function(ve){var re={};function j($){if(re[$])return re[$].exports;var V=re[$]={i:$,l:!1,exports:{}};return ve[$].call(V.exports,V,V.exports,j),V.l=!0,V.exports}return j.m=ve,j.c=re,j.d=function($,V,D){j.o($,V)||Object.defineProperty($,V,{enumerable:!0,get:D})},j.r=function($){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty($,Symbol.toStringTag,{value:"Module"}),Object.defineProperty($,"__esModule",{value:!0})},j.t=function($,V){if(V&1&&($=j($)),V&8||V&4&&typeof $=="object"&&$&&$.__esModule)return $;var D=Object.create(null);if(j.r(D),Object.defineProperty(D,"default",{enumerable:!0,value:$}),V&2&&typeof $!="string")for(var ee in $)j.d(D,ee,function(h){return $[h]}.bind(null,ee));return D},j.n=function($){var V=$&&$.__esModule?function(){return $.default}:function(){return $};return j.d(V,"a",V),V},j.o=function($,V){return Object.prototype.hasOwnProperty.call($,V)},j.p="/dist/",j(j.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(ve,re,j){var $=Object.prototype.hasOwnProperty,V="~";function D(){}Object.create&&(D.prototype=Object.create(null),new D().__proto__||(V=!1));function ee(T,_,I){this.fn=T,this.context=_,this.once=I||!1}function h(T,_,I,S,w){if(typeof I!="function")throw new TypeError("The listener must be a function");var P=new ee(I,S||T,w),C=V?V+_:_;return T._events[C]?T._events[C].fn?T._events[C]=[T._events[C],P]:T._events[C].push(P):(T._events[C]=P,T._eventsCount++),T}function c(T,_){--T._eventsCount===0?T._events=new D:delete T._events[_]}function q(){this._events=new D,this._eventsCount=0}q.prototype.eventNames=function(){var _=[],I,S;if(this._eventsCount===0)return _;for(S in I=this._events)$.call(I,S)&&_.push(V?S.slice(1):S);return Object.getOwnPropertySymbols?_.concat(Object.getOwnPropertySymbols(I)):_},q.prototype.listeners=function(_){var I=V?V+_:_,S=this._events[I];if(!S)return[];if(S.fn)return[S.fn];for(var w=0,P=S.length,C=new Array(P);w<P;w++)C[w]=S[w].fn;return C},q.prototype.listenerCount=function(_){var I=V?V+_:_,S=this._events[I];return S?S.fn?1:S.length:0},q.prototype.emit=function(_,I,S,w,P,C){var z=V?V+_:_;if(!this._events[z])return!1;var N=this._events[z],G=arguments.length,Q,J;if(N.fn){switch(N.once&&this.removeListener(_,N.fn,void 0,!0),G){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,I),!0;case 3:return N.fn.call(N.context,I,S),!0;case 4:return N.fn.call(N.context,I,S,w),!0;case 5:return N.fn.call(N.context,I,S,w,P),!0;case 6:return N.fn.call(N.context,I,S,w,P,C),!0}for(J=1,Q=new Array(G-1);J<G;J++)Q[J-1]=arguments[J];N.fn.apply(N.context,Q)}else{var oe=N.length,ie;for(J=0;J<oe;J++)switch(N[J].once&&this.removeListener(_,N[J].fn,void 0,!0),G){case 1:N[J].fn.call(N[J].context);break;case 2:N[J].fn.call(N[J].context,I);break;case 3:N[J].fn.call(N[J].context,I,S);break;case 4:N[J].fn.call(N[J].context,I,S,w);break;default:if(!Q)for(ie=1,Q=new Array(G-1);ie<G;ie++)Q[ie-1]=arguments[ie];N[J].fn.apply(N[J].context,Q)}}return!0},q.prototype.on=function(_,I,S){return h(this,_,I,S,!1)},q.prototype.once=function(_,I,S){return h(this,_,I,S,!0)},q.prototype.removeListener=function(_,I,S,w){var P=V?V+_:_;if(!this._events[P])return this;if(!I)return c(this,P),this;var C=this._events[P];if(C.fn)C.fn===I&&(!w||C.once)&&(!S||C.context===S)&&c(this,P);else{for(var z=0,N=[],G=C.length;z<G;z++)(C[z].fn!==I||w&&!C[z].once||S&&C[z].context!==S)&&N.push(C[z]);N.length?this._events[P]=N.length===1?N[0]:N:c(this,P)}return this},q.prototype.removeAllListeners=function(_){var I;return _?(I=V?V+_:_,this._events[I]&&c(this,I)):(this._events=new D,this._eventsCount=0),this},q.prototype.off=q.prototype.removeListener,q.prototype.addListener=q.prototype.on,q.prefixed=V,q.EventEmitter=q,ve.exports=q},"./node_modules/url-toolkit/src/url-toolkit.js":function(ve,re,j){(function($){var V=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,D=/^([^\/?#]*)(.*)$/,ee=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(q,T,_){if(_=_||{},q=q.trim(),T=T.trim(),!T){if(!_.alwaysNormalize)return q;var I=c.parseURL(q);if(!I)throw new Error("Error trying to parse base URL.");return I.path=c.normalizePath(I.path),c.buildURLFromParts(I)}var S=c.parseURL(T);if(!S)throw new Error("Error trying to parse relative URL.");if(S.scheme)return _.alwaysNormalize?(S.path=c.normalizePath(S.path),c.buildURLFromParts(S)):T;var w=c.parseURL(q);if(!w)throw new Error("Error trying to parse base URL.");if(!w.netLoc&&w.path&&w.path[0]!=="/"){var P=D.exec(w.path);w.netLoc=P[1],w.path=P[2]}w.netLoc&&!w.path&&(w.path="/");var C={scheme:w.scheme,netLoc:S.netLoc,path:null,params:S.params,query:S.query,fragment:S.fragment};if(!S.netLoc&&(C.netLoc=w.netLoc,S.path[0]!=="/"))if(!S.path)C.path=w.path,S.params||(C.params=w.params,S.query||(C.query=w.query));else{var z=w.path,N=z.substring(0,z.lastIndexOf("/")+1)+S.path;C.path=c.normalizePath(N)}return C.path===null&&(C.path=_.alwaysNormalize?c.normalizePath(S.path):S.path),c.buildURLFromParts(C)},parseURL:function(q){var T=V.exec(q);return T?{scheme:T[1]||"",netLoc:T[2]||"",path:T[3]||"",params:T[4]||"",query:T[5]||"",fragment:T[6]||""}:null},normalizePath:function(q){for(q=q.split("").reverse().join("").replace(ee,"");q.length!==(q=q.replace(h,"")).length;);return q.split("").reverse().join("")},buildURLFromParts:function(q){return q.scheme+q.netLoc+q.path+q.params+q.query+q.fragment}};ve.exports=c})()},"./node_modules/webworkify-webpack/index.js":function(ve,re,j){function $(_){var I={};function S(P){if(I[P])return I[P].exports;var C=I[P]={i:P,l:!1,exports:{}};return _[P].call(C.exports,C,C.exports,S),C.l=!0,C.exports}S.m=_,S.c=I,S.i=function(P){return P},S.d=function(P,C,z){S.o(P,C)||Object.defineProperty(P,C,{configurable:!1,enumerable:!0,get:z})},S.r=function(P){Object.defineProperty(P,"__esModule",{value:!0})},S.n=function(P){var C=P&&P.__esModule?function(){return P.default}:function(){return P};return S.d(C,"a",C),C},S.o=function(P,C){return Object.prototype.hasOwnProperty.call(P,C)},S.p="/",S.oe=function(P){throw console.error(P),P};var w=S(S.s=ENTRY_MODULE);return w.default||w}var V="[\\.|\\-|\\+|\\w|/|@]+",D="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+V+").*?\\)";function ee(_){return(_+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function h(_){return!isNaN(1*_)}function c(_,I,S){var w={};w[S]=[];var P=I.toString(),C=P.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!C)return w;for(var z=C[1],N=new RegExp("(\\\\n|\\W)"+ee(z)+D,"g"),G;G=N.exec(P);)G[3]!=="dll-reference"&&w[S].push(G[3]);for(N=new RegExp("\\("+ee(z)+'\\("(dll-reference\\s('+V+'))"\\)\\)'+D,"g");G=N.exec(P);)_[G[2]]||(w[S].push(G[1]),_[G[2]]=j(G[1]).m),w[G[2]]=w[G[2]]||[],w[G[2]].push(G[4]);for(var Q=Object.keys(w),J=0;J<Q.length;J++)for(var oe=0;oe<w[Q[J]].length;oe++)h(w[Q[J]][oe])&&(w[Q[J]][oe]=1*w[Q[J]][oe]);return w}function q(_){var I=Object.keys(_);return I.reduce(function(S,w){return S||_[w].length>0},!1)}function T(_,I){for(var S={main:[I]},w={main:[]},P={main:{}};q(S);)for(var C=Object.keys(S),z=0;z<C.length;z++){var N=C[z],G=S[N],Q=G.pop();if(P[N]=P[N]||{},!(P[N][Q]||!_[N][Q])){P[N][Q]=!0,w[N]=w[N]||[],w[N].push(Q);for(var J=c(_,_[N][Q],N),oe=Object.keys(J),ie=0;ie<oe.length;ie++)S[oe[ie]]=S[oe[ie]]||[],S[oe[ie]]=S[oe[ie]].concat(J[oe[ie]])}}return w}ve.exports=function(_,I){I=I||{};var S={main:j.m},w=I.all?{main:Object.keys(S.main)}:T(S,_),P="";Object.keys(w).filter(function(Q){return Q!=="main"}).forEach(function(Q){for(var J=0;w[Q][J];)J++;w[Q].push(J),S[Q][J]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",P=P+"var "+Q+" = ("+$.toString().replace("ENTRY_MODULE",JSON.stringify(J))+")({"+w[Q].map(function(oe){return""+JSON.stringify(oe)+": "+S[Q][oe].toString()}).join(",")+`});
`}),P=P+"new (("+$.toString().replace("ENTRY_MODULE",JSON.stringify(_))+")({"+w.main.map(function(Q){return""+JSON.stringify(Q)+": "+S.main[Q].toString()}).join(",")+"}))(self);";var C=new window.Blob([P],{type:"text/javascript"});if(I.bare)return C;var z=window.URL||window.webkitURL||window.mozURL||window.msURL,N=z.createObjectURL(C),G=new window.Worker(N);return G.objectURL=N,G}},"./src/crypt/decrypter.js":function(ve,re,j){j.r(re);var $=function(){function P(z,N){this.subtle=z,this.aesIV=N}var C=P.prototype;return C.decrypt=function(N,G){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},G,N)},P}(),V=function(){function P(z,N){this.subtle=z,this.key=N}var C=P.prototype;return C.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},P}(),D=V;function ee(P){var C=P.byteLength,z=C&&new DataView(P).getUint8(C-1);return z?P.slice(0,C-z):P}var h=function(){function P(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var C=P.prototype;return C.uint8ArrayToUint32Array_=function(N){for(var G=new DataView(N),Q=new Uint32Array(4),J=0;J<4;J++)Q[J]=G.getUint32(J*4);return Q},C.initTable=function(){var N=this.sBox,G=this.invSBox,Q=this.subMix,J=Q[0],oe=Q[1],ie=Q[2],fe=Q[3],Se=this.invSubMix,Ce=Se[0],Pe=Se[1],be=Se[2],ut=Se[3],Ie=new Uint32Array(256),Me=0,Ve=0,Be=0;for(Be=0;Be<256;Be++)Be<128?Ie[Be]=Be<<1:Ie[Be]=Be<<1^283;for(Be=0;Be<256;Be++){var Ge=Ve^Ve<<1^Ve<<2^Ve<<3^Ve<<4;Ge=Ge>>>8^Ge&255^99,N[Me]=Ge,G[Ge]=Me;var Ne=Ie[Me],ge=Ie[Ne],tt=Ie[ge],Re=Ie[Ge]*257^Ge*16843008;J[Me]=Re<<24|Re>>>8,oe[Me]=Re<<16|Re>>>16,ie[Me]=Re<<8|Re>>>24,fe[Me]=Re,Re=tt*16843009^ge*65537^Ne*257^Me*16843008,Ce[Ge]=Re<<24|Re>>>8,Pe[Ge]=Re<<16|Re>>>16,be[Ge]=Re<<8|Re>>>24,ut[Ge]=Re,Me?(Me=Ne^Ie[Ie[Ie[tt^Ne]]],Ve^=Ie[Ie[Ve]]):Me=Ve=1}},C.expandKey=function(N){for(var G=this.uint8ArrayToUint32Array_(N),Q=!0,J=0;J<G.length&&Q;)Q=G[J]===this.key[J],J++;if(!Q){this.key=G;var oe=this.keySize=G.length;if(oe!==4&&oe!==6&&oe!==8)throw new Error("Invalid aes key size="+oe);var ie=this.ksRows=(oe+6+1)*4,fe,Se,Ce=this.keySchedule=new Uint32Array(ie),Pe=this.invKeySchedule=new Uint32Array(ie),be=this.sBox,ut=this.rcon,Ie=this.invSubMix,Me=Ie[0],Ve=Ie[1],Be=Ie[2],Ge=Ie[3],Ne,ge;for(fe=0;fe<ie;fe++){if(fe<oe){Ne=Ce[fe]=G[fe];continue}ge=Ne,fe%oe===0?(ge=ge<<8|ge>>>24,ge=be[ge>>>24]<<24|be[ge>>>16&255]<<16|be[ge>>>8&255]<<8|be[ge&255],ge^=ut[fe/oe|0]<<24):oe>6&&fe%oe===4&&(ge=be[ge>>>24]<<24|be[ge>>>16&255]<<16|be[ge>>>8&255]<<8|be[ge&255]),Ce[fe]=Ne=(Ce[fe-oe]^ge)>>>0}for(Se=0;Se<ie;Se++)fe=ie-Se,Se&3?ge=Ce[fe]:ge=Ce[fe-4],Se<4||fe<=4?Pe[Se]=ge:Pe[Se]=Me[be[ge>>>24]]^Ve[be[ge>>>16&255]]^Be[be[ge>>>8&255]]^Ge[be[ge&255]],Pe[Se]=Pe[Se]>>>0}},C.networkToHostOrderSwap=function(N){return N<<24|(N&65280)<<8|(N&16711680)>>8|N>>>24},C.decrypt=function(N,G,Q,J){for(var oe=this.keySize+6,ie=this.invKeySchedule,fe=this.invSBox,Se=this.invSubMix,Ce=Se[0],Pe=Se[1],be=Se[2],ut=Se[3],Ie=this.uint8ArrayToUint32Array_(Q),Me=Ie[0],Ve=Ie[1],Be=Ie[2],Ge=Ie[3],Ne=new Int32Array(N),ge=new Int32Array(Ne.length),tt,Re,yt,Et,_e,Ze,rt,nt,pt,bt,Je,Tt,ze,Lt,st=this.networkToHostOrderSwap;G<Ne.length;){for(pt=st(Ne[G]),bt=st(Ne[G+1]),Je=st(Ne[G+2]),Tt=st(Ne[G+3]),_e=pt^ie[0],Ze=Tt^ie[1],rt=Je^ie[2],nt=bt^ie[3],ze=4,Lt=1;Lt<oe;Lt++)tt=Ce[_e>>>24]^Pe[Ze>>16&255]^be[rt>>8&255]^ut[nt&255]^ie[ze],Re=Ce[Ze>>>24]^Pe[rt>>16&255]^be[nt>>8&255]^ut[_e&255]^ie[ze+1],yt=Ce[rt>>>24]^Pe[nt>>16&255]^be[_e>>8&255]^ut[Ze&255]^ie[ze+2],Et=Ce[nt>>>24]^Pe[_e>>16&255]^be[Ze>>8&255]^ut[rt&255]^ie[ze+3],_e=tt,Ze=Re,rt=yt,nt=Et,ze=ze+4;tt=fe[_e>>>24]<<24^fe[Ze>>16&255]<<16^fe[rt>>8&255]<<8^fe[nt&255]^ie[ze],Re=fe[Ze>>>24]<<24^fe[rt>>16&255]<<16^fe[nt>>8&255]<<8^fe[_e&255]^ie[ze+1],yt=fe[rt>>>24]<<24^fe[nt>>16&255]<<16^fe[_e>>8&255]<<8^fe[Ze&255]^ie[ze+2],Et=fe[nt>>>24]<<24^fe[_e>>16&255]<<16^fe[Ze>>8&255]<<8^fe[rt&255]^ie[ze+3],ze=ze+3,ge[G]=st(tt^Me),ge[G+1]=st(Et^Ve),ge[G+2]=st(yt^Be),ge[G+3]=st(Re^Ge),Me=pt,Ve=bt,Be=Je,Ge=Tt,G=G+4}return J?ee(ge.buffer):ge.buffer},C.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},P}(),c=h,q=j("./src/errors.ts"),T=j("./src/utils/logger.js"),_=j("./src/events.js"),I=j("./src/utils/get-self-scope.js"),S=Object(I.getSelfScope)(),w=function(){function P(z,N,G){var Q=G===void 0?{}:G,J=Q.removePKCS7Padding,oe=J===void 0?!0:J;if(this.logEnabled=!0,this.observer=z,this.config=N,this.removePKCS7Padding=oe,oe)try{var ie=S.crypto;ie&&(this.subtle=ie.subtle||ie.webkitSubtle)}catch{}this.disableWebCrypto=!this.subtle}var C=P.prototype;return C.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},C.decrypt=function(N,G,Q,J){var oe=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(T.logger.log("JS AES decrypt"),this.logEnabled=!1);var ie=this.decryptor;ie||(this.decryptor=ie=new c),ie.expandKey(G),J(ie.decrypt(N,0,Q,this.removePKCS7Padding))}else{this.logEnabled&&(T.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var fe=this.subtle;this.key!==G&&(this.key=G,this.fastAesKey=new D(fe,G)),this.fastAesKey.expandKey().then(function(Se){var Ce=new $(fe,Q);Ce.decrypt(N,Se).catch(function(Pe){oe.onWebCryptoError(Pe,N,G,Q,J)}).then(function(Pe){J(Pe)})}).catch(function(Se){oe.onWebCryptoError(Se,N,G,Q,J)})}},C.onWebCryptoError=function(N,G,Q,J,oe){this.config.enableSoftwareAES?(T.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(G,Q,J,oe)):(T.logger.error("decrypting error : "+N.message),this.observer.trigger(_.default.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:N.message}))},C.destroy=function(){var N=this.decryptor;N&&(N.destroy(),this.decryptor=void 0)},P}();re.default=w},"./src/demux/demuxer-inline.js":function(ve,re,j){j.r(re);var $=j("./src/events.js"),V=j("./src/errors.ts"),D=j("./src/crypt/decrypter.js"),ee=j("./src/polyfills/number.js"),h=j("./src/utils/logger.js"),c=j("./src/utils/get-self-scope.js");function q(y,L,x,f){var g,m,E,A,b,O=navigator.userAgent.toLowerCase(),U=f,B=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(g=((L[x+2]&192)>>>6)+1,m=(L[x+2]&60)>>>2,m>B.length-1){y.trigger($.default.ERROR,{type:V.ErrorTypes.MEDIA_ERROR,details:V.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+m});return}return A=(L[x+2]&1)<<2,A|=(L[x+3]&192)>>>6,h.logger.log("manifest codec:"+f+",ADTS data:type:"+g+",sampleingIndex:"+m+"["+B[m]+"Hz],channelConfig:"+A),/firefox/i.test(O)?m>=6?(g=5,b=new Array(4),E=m-3):(g=2,b=new Array(2),E=m):O.indexOf("android")!==-1?(g=2,b=new Array(2),E=m):(g=5,b=new Array(4),f&&(f.indexOf("mp4a.40.29")!==-1||f.indexOf("mp4a.40.5")!==-1)||!f&&m>=6?E=m-3:((f&&f.indexOf("mp4a.40.2")!==-1&&(m>=6&&A===1||/vivaldi/i.test(O))||!f&&A===1)&&(g=2,b=new Array(2)),E=m)),b[0]=g<<3,b[0]|=(m&14)>>1,b[1]|=(m&1)<<7,b[1]|=A<<3,g===5&&(b[1]|=(E&14)>>1,b[2]=(E&1)<<7,b[2]|=2<<2,b[3]=0),{config:b,samplerate:B[m],channelCount:A,codec:"mp4a.40."+g,manifestCodec:U}}function T(y,L){return y[L]===255&&(y[L+1]&246)===240}function _(y,L){return y[L+1]&1?7:9}function I(y,L){return(y[L+3]&3)<<11|y[L+4]<<3|(y[L+5]&224)>>>5}function S(y,L){return!!(L+1<y.length&&T(y,L))}function w(y,L){if(S(y,L)){var x=_(y,L);if(L+x>=y.length)return!1;var f=I(y,L);if(f<=x)return!1;var g=L+f;if(g===y.length||g+1<y.length&&T(y,g))return!0}return!1}function P(y,L,x,f,g){if(!y.samplerate){var m=q(L,x,f,g);y.config=m.config,y.samplerate=m.samplerate,y.channelCount=m.channelCount,y.codec=m.codec,y.manifestCodec=m.manifestCodec,h.logger.log("parsed codec:"+y.codec+",rate:"+m.samplerate+",nb channel:"+m.channelCount)}}function C(y){return 1024*9e4/y}function z(y,L,x,f,g){var m,E,A,b=y.length;if(m=_(y,L),E=I(y,L),E-=m,E>0&&L+m+E<=b)return A=x+f*g,{headerLength:m,frameLength:E,stamp:A}}function N(y,L,x,f,g){var m=C(y.samplerate),E=z(L,x,f,g,m);if(E){var A=E.stamp,b=E.headerLength,O=E.frameLength,U={unit:L.subarray(x+b,x+b+O),pts:A,dts:A};return y.samples.push(U),{sample:U,length:O+b}}}var G=j("./src/demux/id3.js"),Q=function(){function y(x,f,g){this.observer=x,this.config=g,this.remuxer=f}var L=y.prototype;return L.resetInitSegment=function(f,g,m,E){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:g,duration:E,inputTimeScale:9e4}},L.resetTimeStamp=function(){},y.probe=function(f){if(!f)return!1;for(var g=G.default.getID3Data(f,0)||[],m=g.length,E=f.length;m<E;m++)if(w(f,m))return h.logger.log("ADTS sync word found !"),!0;return!1},L.append=function(f,g,m,E){for(var A=this._audioTrack,b=G.default.getID3Data(f,0)||[],O=G.default.getTimeStamp(b),U=Object(ee.isFiniteNumber)(O)?O*90:g*9e4,B=0,M=U,Y=f.length,H=b.length,Z=[{pts:M,dts:M,data:b}];H<Y-1;)if(S(f,H)&&H+5<Y){P(A,this.observer,f,H,A.manifestCodec);var W=N(A,f,H,U,B);if(W)H+=W.length,M=W.sample.pts,B++;else{h.logger.log("Unable to parse AAC frame");break}}else G.default.isHeader(f,H)?(b=G.default.getID3Data(f,H),Z.push({pts:M,dts:M,data:b}),H+=b.length):H++;this.remuxer.remux(A,{samples:[]},{samples:Z,inputTimeScale:9e4},{samples:[]},g,m,E)},L.destroy=function(){},y}(),J=Q,oe=j("./src/demux/mp4demuxer.js"),ie={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(L,x,f,g,m){if(!(f+24>x.length)){var E=this.parseHeader(x,f);if(E&&f+E.frameLength<=x.length){var A=E.samplesPerFrame*9e4/E.sampleRate,b=g+m*A,O={unit:x.subarray(f,f+E.frameLength),pts:b,dts:b};return L.config=[],L.channelCount=E.channelCount,L.samplerate=E.sampleRate,L.samples.push(O),{sample:O,length:E.frameLength}}}},parseHeader:function(L,x){var f=L[x+1]>>3&3,g=L[x+1]>>1&3,m=L[x+2]>>4&15,E=L[x+2]>>2&3,A=L[x+2]>>1&1;if(f!==1&&m!==0&&m!==15&&E!==3){var b=f===3?3-g:g===3?3:4,O=ie.BitratesMap[b*14+m-1]*1e3,U=f===3?0:f===2?1:2,B=ie.SamplingRateMap[U*3+E],M=L[x+3]>>6===3?1:2,Y=ie.SamplesCoefficients[f][g],H=ie.BytesInSlot[g],Z=Y*8*H,W=parseInt(Y*O/B+A,10)*H;return{sampleRate:B,channelCount:M,frameLength:W,samplesPerFrame:Z}}},isHeaderPattern:function(L,x){return L[x]===255&&(L[x+1]&224)===224&&(L[x+1]&6)!==0},isHeader:function(L,x){return!!(x+1<L.length&&this.isHeaderPattern(L,x))},probe:function(L,x){if(x+1<L.length&&this.isHeaderPattern(L,x)){var f=4,g=this.parseHeader(L,x),m=f;g&&g.frameLength&&(m=g.frameLength);var E=x+m;if(E===L.length||E+1<L.length&&this.isHeaderPattern(L,E))return!0}return!1}},fe=ie,Se=function(){function y(x){this.data=x,this.bytesAvailable=x.byteLength,this.word=0,this.bitsAvailable=0}var L=y.prototype;return L.loadWord=function(){var f=this.data,g=this.bytesAvailable,m=f.byteLength-g,E=new Uint8Array(4),A=Math.min(4,g);if(A===0)throw new Error("no bytes available");E.set(f.subarray(m,m+A)),this.word=new DataView(E.buffer).getUint32(0),this.bitsAvailable=A*8,this.bytesAvailable-=A},L.skipBits=function(f){var g;this.bitsAvailable>f?(this.word<<=f,this.bitsAvailable-=f):(f-=this.bitsAvailable,g=f>>3,f-=g>>3,this.bytesAvailable-=g,this.loadWord(),this.word<<=f,this.bitsAvailable-=f)},L.readBits=function(f){var g=Math.min(this.bitsAvailable,f),m=this.word>>>32-g;return f>32&&h.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=g,this.bitsAvailable>0?this.word<<=g:this.bytesAvailable>0&&this.loadWord(),g=f-g,g>0&&this.bitsAvailable?m<<g|this.readBits(g):m},L.skipLZ=function(){var f;for(f=0;f<this.bitsAvailable;++f)if((this.word&2147483648>>>f)!==0)return this.word<<=f,this.bitsAvailable-=f,f;return this.loadWord(),f+this.skipLZ()},L.skipUEG=function(){this.skipBits(1+this.skipLZ())},L.skipEG=function(){this.skipBits(1+this.skipLZ())},L.readUEG=function(){var f=this.skipLZ();return this.readBits(f+1)-1},L.readEG=function(){var f=this.readUEG();return 1&f?1+f>>>1:-1*(f>>>1)},L.readBoolean=function(){return this.readBits(1)===1},L.readUByte=function(){return this.readBits(8)},L.readUShort=function(){return this.readBits(16)},L.readUInt=function(){return this.readBits(32)},L.skipScalingList=function(f){var g=8,m=8,E,A;for(E=0;E<f;E++)m!==0&&(A=this.readEG(),m=(g+A+256)%256),g=m===0?g:m},L.readSPS=function(){var f=0,g=0,m=0,E=0,A,b,O,U,B,M,Y,H=this.readUByte.bind(this),Z=this.readBits.bind(this),W=this.readUEG.bind(this),se=this.readBoolean.bind(this),ae=this.skipBits.bind(this),he=this.skipEG.bind(this),Te=this.skipUEG.bind(this),ce=this.skipScalingList.bind(this);if(H(),A=H(),Z(5),ae(3),H(),Te(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){var we=W();if(we===3&&ae(1),Te(),Te(),ae(1),se())for(M=we!==3?8:12,Y=0;Y<M;Y++)se()&&(Y<6?ce(16):ce(64))}Te();var Ee=W();if(Ee===0)W();else if(Ee===1)for(ae(1),he(),he(),b=W(),Y=0;Y<b;Y++)he();Te(),ae(1),O=W(),U=W(),B=Z(1),B===0&&ae(1),ae(1),se()&&(f=W(),g=W(),m=W(),E=W());var me=[1,1];if(se()&&se()){var Ae=H();switch(Ae){case 1:me=[1,1];break;case 2:me=[12,11];break;case 3:me=[10,11];break;case 4:me=[16,11];break;case 5:me=[40,33];break;case 6:me=[24,11];break;case 7:me=[20,11];break;case 8:me=[32,11];break;case 9:me=[80,33];break;case 10:me=[18,11];break;case 11:me=[15,11];break;case 12:me=[64,33];break;case 13:me=[160,99];break;case 14:me=[4,3];break;case 15:me=[3,2];break;case 16:me=[2,1];break;case 255:{me=[H()<<8|H(),H()<<8|H()];break}}}return{width:Math.ceil((O+1)*16-f*2-g*2),height:(2-B)*(U+1)*16-(B?2:4)*(m+E),pixelRatio:me}},L.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},y}(),Ce=Se,Pe=function(){function y(x,f,g,m){this.decryptdata=g,this.discardEPB=m,this.decrypter=new D.default(x,f,{removePKCS7Padding:!1})}var L=y.prototype;return L.decryptBuffer=function(f,g){this.decrypter.decrypt(f,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,g)},L.decryptAacSample=function(f,g,m,E){var A=f[g].unit,b=A.subarray(16,A.length-A.length%16),O=b.buffer.slice(b.byteOffset,b.byteOffset+b.length),U=this;this.decryptBuffer(O,function(B){B=new Uint8Array(B),A.set(B,16),E||U.decryptAacSamples(f,g+1,m)})},L.decryptAacSamples=function(f,g,m){for(;;g++){if(g>=f.length){m();return}if(!(f[g].unit.length<32)){var E=this.decrypter.isSync();if(this.decryptAacSample(f,g,m,E),!E)return}}},L.getAvcEncryptedData=function(f){for(var g=Math.floor((f.length-48)/160)*16+16,m=new Int8Array(g),E=0,A=32;A<=f.length-16;A+=160,E+=16)m.set(f.subarray(A,A+16),E);return m},L.getAvcDecryptedUnit=function(f,g){g=new Uint8Array(g);for(var m=0,E=32;E<=f.length-16;E+=160,m+=16)f.set(g.subarray(m,m+16),E);return f},L.decryptAvcSample=function(f,g,m,E,A,b){var O=this.discardEPB(A.data),U=this.getAvcEncryptedData(O),B=this;this.decryptBuffer(U.buffer,function(M){A.data=B.getAvcDecryptedUnit(O,M),b||B.decryptAvcSamples(f,g,m+1,E)})},L.decryptAvcSamples=function(f,g,m,E){for(;;g++,m=0){if(g>=f.length){E();return}for(var A=f[g].units;!(m>=A.length);m++){var b=A[m];if(!(b.data.length<=48||b.type!==1&&b.type!==5)){var O=this.decrypter.isSync();if(this.decryptAvcSample(f,g,m,E,b,O),!O)return}}}},y}(),be=Pe,ut={video:1,audio:2,id3:3,text:4},Ie=function(){function y(x,f,g,m){this.observer=x,this.config=g,this.typeSupported=m,this.remuxer=f,this.sampleAes=null,this.pmtUnknownTypes={}}var L=y.prototype;return L.setDecryptData=function(f){f!=null&&f.key!=null&&f.method==="SAMPLE-AES"?this.sampleAes=new be(this.observer,this.config,f,this.discardEPB):this.sampleAes=null},y.probe=function(f){var g=y._syncOffset(f);return g<0?!1:(g&&h.logger.warn("MPEG2-TS detected but first sync word found @ offset "+g+", junk ahead ?"),!0)},y._syncOffset=function(f){for(var g=Math.min(1e3,f.length-564),m=0;m<g;){if(f[m]===71&&f[m+188]===71&&f[m+2*188]===71)return m;m++}return-1},y.createTrack=function(f,g){return{container:f==="video"||f==="audio"?"video/mp2t":void 0,type:f,id:ut[f],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:f==="video"?0:void 0,isAAC:f==="audio"?!0:void 0,duration:f==="audio"?g:void 0}},L.resetInitSegment=function(f,g,m,E){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=y.createTrack("video",E),this._audioTrack=y.createTrack("audio",E),this._id3Track=y.createTrack("id3",E),this._txtTrack=y.createTrack("text",E),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=g,this.videoCodec=m,this._duration=E},L.resetTimeStamp=function(){},L.append=function(f,g,m,E){var A,b=f.length,O,U,B,M,Y,H=!1;this.pmtUnknownTypes={},this.contiguous=m;var Z=this.pmtParsed,W=this._avcTrack,se=this._audioTrack,ae=this._id3Track,he=W.pid,Te=se.pid,ce=ae.pid,we=this._pmtId,Ee=W.pesData,me=se.pesData,Ae=ae.pesData,Le=this._parsePAT,qe=this._parsePMT.bind(this),He=this._parsePES,Fe=this._parseAVCPES.bind(this),et=this._parseAACPES.bind(this),We=this._parseMPEGPES.bind(this),it=this._parseID3PES.bind(this),Ke=y._syncOffset(f);for(b-=(b+Ke)%188,A=Ke;A<b;A+=188)if(f[A]===71){if(O=!!(f[A+1]&64),U=((f[A+1]&31)<<8)+f[A+2],B=(f[A+3]&48)>>4,B>1){if(M=A+5+f[A+4],M===A+188)continue}else M=A+4;switch(U){case he:O&&(Ee&&(Y=He(Ee))&&Fe(Y,!1),Ee={data:[],size:0}),Ee&&(Ee.data.push(f.subarray(M,A+188)),Ee.size+=A+188-M);break;case Te:O&&(me&&(Y=He(me))&&(se.isAAC?et(Y):We(Y)),me={data:[],size:0}),me&&(me.data.push(f.subarray(M,A+188)),me.size+=A+188-M);break;case ce:O&&(Ae&&(Y=He(Ae))&&it(Y),Ae={data:[],size:0}),Ae&&(Ae.data.push(f.subarray(M,A+188)),Ae.size+=A+188-M);break;case 0:O&&(M+=f[M]+1),we=this._pmtId=Le(f,M);break;case we:O&&(M+=f[M]+1);var Oe=qe(f,M,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,this.sampleAes!=null);he=Oe.avc,he>0&&(W.pid=he),Te=Oe.audio,Te>0&&(se.pid=Te,se.isAAC=Oe.isAAC),ce=Oe.id3,ce>0&&(ae.pid=ce),H&&!Z&&(h.logger.log("reparse from beginning"),H=!1,A=Ke-188),Z=this.pmtParsed=!0;break;case 17:case 8191:break;default:H=!0;break}}else this.observer.trigger($.default.ERROR,{type:V.ErrorTypes.MEDIA_ERROR,details:V.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});Ee&&(Y=He(Ee))?(Fe(Y,!0),W.pesData=null):W.pesData=Ee,me&&(Y=He(me))?(se.isAAC?et(Y):We(Y),se.pesData=null):(me&&me.size&&h.logger.log("last AAC PES packet truncated,might overlap between fragments"),se.pesData=me),Ae&&(Y=He(Ae))?(it(Y),ae.pesData=null):ae.pesData=Ae,this.sampleAes==null?this.remuxer.remux(se,W,ae,this._txtTrack,g,m,E):this.decryptAndRemux(se,W,ae,this._txtTrack,g,m,E)},L.decryptAndRemux=function(f,g,m,E,A,b,O){if(f.samples&&f.isAAC){var U=this;this.sampleAes.decryptAacSamples(f.samples,0,function(){U.decryptAndRemuxAvc(f,g,m,E,A,b,O)})}else this.decryptAndRemuxAvc(f,g,m,E,A,b,O)},L.decryptAndRemuxAvc=function(f,g,m,E,A,b,O){if(g.samples){var U=this;this.sampleAes.decryptAvcSamples(g.samples,0,0,function(){U.remuxer.remux(f,g,m,E,A,b,O)})}else this.remuxer.remux(f,g,m,E,A,b,O)},L.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},L._parsePAT=function(f,g){return(f[g+10]&31)<<8|f[g+11]},L._trackUnknownPmt=function(f,g,m){var E=this.pmtUnknownTypes[f]||0;return E===0&&(this.pmtUnknownTypes[f]=0,g.call(h.logger,m)),this.pmtUnknownTypes[f]++,E},L._parsePMT=function(f,g,m,E){var A,b,O,U,B={audio:-1,avc:-1,id3:-1,isAAC:!0};for(A=(f[g+1]&15)<<8|f[g+2],b=g+3+A-4,O=(f[g+10]&15)<<8|f[g+11],g+=12+O;g<b;){switch(U=(f[g+1]&31)<<8|f[g+2],f[g]){case 207:if(!E){this._trackUnknownPmt(f[g],h.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:B.audio===-1&&(B.audio=U);break;case 21:B.id3===-1&&(B.id3=U);break;case 219:if(!E){this._trackUnknownPmt(f[g],h.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:B.avc===-1&&(B.avc=U);break;case 3:case 4:m?B.audio===-1&&(B.audio=U,B.isAAC=!1):this._trackUnknownPmt(f[g],h.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(f[g],h.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(f[g],h.logger.log,"Unknown stream type:"+f[g]);break}g+=((f[g+3]&15)<<8|f[g+4])+5}return B},L._parsePES=function(f){var g=0,m,E,A,b,O,U,B,M,Y,H=f.data;if(!f||f.size===0)return null;for(;H[0].length<19&&H.length>1;){var Z=new Uint8Array(H[0].length+H[1].length);Z.set(H[0]),Z.set(H[1],H[0].length),H[0]=Z,H.splice(1,1)}if(m=H[0],A=(m[0]<<16)+(m[1]<<8)+m[2],A===1){if(b=(m[4]<<8)+m[5],b&&b>f.size-6||(E=m[7],E&192&&(B=(m[9]&14)*536870912+(m[10]&255)*4194304+(m[11]&254)*16384+(m[12]&255)*128+(m[13]&254)/2,E&64?(M=(m[14]&14)*536870912+(m[15]&255)*4194304+(m[16]&254)*16384+(m[17]&255)*128+(m[18]&254)/2,B-M>60*9e4&&(h.logger.warn(Math.round((B-M)/9e4)+"s delta between PTS and DTS, align them"),B=M)):M=B),O=m[8],Y=O+9,f.size<=Y))return null;f.size-=Y,U=new Uint8Array(f.size);for(var W=0,se=H.length;W<se;W++){m=H[W];var ae=m.byteLength;if(Y)if(Y>ae){Y-=ae;continue}else m=m.subarray(Y),ae-=Y,Y=0;U.set(m,g),g+=ae}return b&&(b-=O+3),{data:U,pts:B,dts:M,len:b}}else return null},L.pushAccesUnit=function(f,g){if(f.units.length&&f.frame){var m=g.samples,E=m.length;if(isNaN(f.pts))if(E){var A=m[E-1];f.pts=A.pts,f.dts=A.dts}else{g.dropped++;return}!this.config.forceKeyFrameOnDiscontinuity||f.key===!0||g.sps&&(E||this.contiguous)?(f.id=E,m.push(f)):g.dropped++}f.debug.length&&h.logger.log(f.pts+"/"+f.dts+":"+f.debug)},L._parseAVCPES=function(f,g){var m=this,E=this._avcTrack,A=this._parseAVCNALu(f.data),b,O=this.avcSample,U,B=!1,M,Y=this.pushAccesUnit.bind(this),H=function(W,se,ae,he){return{key:W,pts:se,dts:ae,units:[],debug:he}};f.data=null,O&&A.length&&!E.audFound&&(Y(O,E),O=this.avcSample=H(!1,f.pts,f.dts,"")),A.forEach(function(Z){switch(Z.type){case 1:U=!0,O||(O=m.avcSample=H(!0,f.pts,f.dts,"")),O.frame=!0;var W=Z.data;if(B&&W.length>4){var se=new Ce(W).readSliceType();(se===2||se===4||se===7||se===9)&&(O.key=!0)}break;case 5:U=!0,O||(O=m.avcSample=H(!0,f.pts,f.dts,"")),O.key=!0,O.frame=!0;break;case 6:U=!0,b=new Ce(m.discardEPB(Z.data)),b.readUByte();for(var ae=0,he=0,Te=!1,ce=0;!Te&&b.bytesAvailable>1;){ae=0;do ce=b.readUByte(),ae+=ce;while(ce===255);he=0;do ce=b.readUByte(),he+=ce;while(ce===255);if(ae===4&&b.bytesAvailable!==0){Te=!0;var we=b.readUByte();if(we===181){var Ee=b.readUShort();if(Ee===49){var me=b.readUInt();if(me===1195456820){var Ae=b.readUByte();if(Ae===3){var Le=b.readUByte(),qe=b.readUByte(),He=31&Le,Fe=[Le,qe];for(M=0;M<He;M++)Fe.push(b.readUByte()),Fe.push(b.readUByte()),Fe.push(b.readUByte());m._insertSampleInOrder(m._txtTrack.samples,{type:3,pts:f.pts,bytes:Fe})}}}}}else if(ae===5&&b.bytesAvailable!==0){if(Te=!0,he>16){var et=[];for(M=0;M<16;M++)et.push(b.readUByte().toString(16)),(M===3||M===5||M===7||M===9)&&et.push("-");var We=he-16,it=new Uint8Array(We);for(M=0;M<We;M++)it[M]=b.readUByte();m._insertSampleInOrder(m._txtTrack.samples,{pts:f.pts,payloadType:ae,uuid:et.join(""),userDataBytes:it,userData:Object(G.utf8ArrayToStr)(it.buffer)})}}else if(he<b.bytesAvailable)for(M=0;M<he;M++)b.readUByte()}break;case 7:if(U=!0,B=!0,!E.sps){b=new Ce(Z.data);var Ke=b.readSPS();E.width=Ke.width,E.height=Ke.height,E.pixelRatio=Ke.pixelRatio,E.sps=[Z.data],E.duration=m._duration;var Oe=Z.data.subarray(1,4),dt="avc1.";for(M=0;M<3;M++){var ht=Oe[M].toString(16);ht.length<2&&(ht="0"+ht),dt+=ht}E.codec=dt}break;case 8:U=!0,E.pps||(E.pps=[Z.data]);break;case 9:U=!1,E.audFound=!0,O&&Y(O,E),O=m.avcSample=H(!1,f.pts,f.dts,"");break;case 12:U=!1;break;default:U=!1,O&&(O.debug+="unknown NAL "+Z.type+" ");break}if(O&&U){var ot=O.units;ot.push(Z)}}),g&&O&&(Y(O,E),this.avcSample=null)},L._insertSampleInOrder=function(f,g){var m=f.length;if(m>0){if(g.pts>=f[m-1].pts)f.push(g);else for(var E=m-1;E>=0;E--)if(g.pts<f[E].pts){f.splice(E,0,g);break}}else f.push(g)},L._getLastNalUnit=function(){var f=this.avcSample,g;if(!f||f.units.length===0){var m=this._avcTrack,E=m.samples;f=E[E.length-1]}if(f){var A=f.units;g=A[A.length-1]}return g},L._parseAVCNALu=function(f){var g=0,m=f.byteLength,E,A,b=this._avcTrack,O=b.naluState||0,U=O,B=[],M,Y,H=-1,Z;for(O===-1&&(H=0,Z=f[0]&31,O=0,g=1);g<m;){if(E=f[g++],!O){O=E?0:1;continue}if(O===1){O=E?0:2;continue}if(!E)O=3;else if(E===1){if(H>=0)M={data:f.subarray(H,g-O-1),type:Z},B.push(M);else{var W=this._getLastNalUnit();if(W&&(U&&g<=4-U&&W.state&&(W.data=W.data.subarray(0,W.data.byteLength-U)),A=g-O-1,A>0)){var se=new Uint8Array(W.data.byteLength+A);se.set(W.data,0),se.set(f.subarray(0,A),W.data.byteLength),W.data=se}}g<m?(Y=f[g]&31,H=g,Z=Y,O=0):O=-1}else O=0}if(H>=0&&O>=0&&(M={data:f.subarray(H,m),type:Z,state:O},B.push(M)),B.length===0){var ae=this._getLastNalUnit();if(ae){var he=new Uint8Array(ae.data.byteLength+f.byteLength);he.set(ae.data,0),he.set(f,ae.data.byteLength),ae.data=he}}return b.naluState=O,B},L.discardEPB=function(f){for(var g=f.byteLength,m=[],E=1,A,b;E<g-2;)f[E]===0&&f[E+1]===0&&f[E+2]===3?(m.push(E+2),E+=2):E++;if(m.length===0)return f;A=g-m.length,b=new Uint8Array(A);var O=0;for(E=0;E<A;O++,E++)O===m[0]&&(O++,m.shift()),b[E]=f[O];return b},L._parseAACPES=function(f){var g=this._audioTrack,m=f.data,E=f.pts,A=0,b=this.aacOverFlow,O=this.aacLastPTS,U,B,M,Y,H;if(b){var Z=new Uint8Array(b.byteLength+m.byteLength);Z.set(b,0),Z.set(m,b.byteLength),m=Z}for(M=A,H=m.length;M<H-1&&!S(m,M);M++);if(M){var W,se;if(M<H-1?(W="AAC PES did not start with ADTS header,offset:"+M,se=!1):(W="no ADTS header found in AAC PES",se=!0),h.logger.warn("parsing error:"+W),this.observer.trigger($.default.ERROR,{type:V.ErrorTypes.MEDIA_ERROR,details:V.ErrorDetails.FRAG_PARSING_ERROR,fatal:se,reason:W}),se)return}if(P(g,this.observer,m,M,this.audioCodec),B=0,U=C(g.samplerate),b&&O){var ae=O+U;Math.abs(ae-E)>1&&(h.logger.log("AAC: align PTS for overlapping frames by "+Math.round((ae-E)/90)),E=ae)}for(;M<H;)if(S(m,M)){if(M+5<H){var he=N(g,m,M,E,B);if(he){M+=he.length,Y=he.sample.pts,B++;continue}}break}else M++;M<H?b=m.subarray(M,H):b=null,this.aacOverFlow=b,this.aacLastPTS=Y},L._parseMPEGPES=function(f){for(var g=f.data,m=g.length,E=0,A=0,b=f.pts;A<m;)if(fe.isHeader(g,A)){var O=fe.appendFrame(this._audioTrack,g,A,b,E);if(O)A+=O.length,E++;else break}else A++},L._parseID3PES=function(f){this._id3Track.samples.push(f)},y}(),Me=Ie,Ve=function(){function y(x,f,g){this.observer=x,this.config=g,this.remuxer=f}var L=y.prototype;return L.resetInitSegment=function(f,g,m,E){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:g,duration:E,inputTimeScale:9e4}},L.resetTimeStamp=function(){},y.probe=function(f){var g,m,E=G.default.getID3Data(f,0);if(E&&G.default.getTimeStamp(E)!==void 0){for(g=E.length,m=Math.min(f.length-1,g+100);g<m;g++)if(fe.probe(f,g))return h.logger.log("MPEG Audio sync word found !"),!0}return!1},L.append=function(f,g,m,E){for(var A=G.default.getID3Data(f,0)||[],b=G.default.getTimeStamp(A),O=b!==void 0?90*b:g*9e4,U=A.length,B=f.length,M=0,Y=0,H=this._audioTrack,Z=[{pts:O,dts:O,data:A}];U<B;)if(fe.isHeader(f,U)){var W=fe.appendFrame(H,f,U,O,M);if(W)U+=W.length,Y=W.sample.pts,M++;else break}else G.default.isHeader(f,U)?(A=G.default.getID3Data(f,U),Z.push({pts:Y,dts:Y,data:A}),U+=A.length):U++;this.remuxer.remux(H,{samples:[]},{samples:Z,inputTimeScale:9e4},{samples:[]},g,m,E)},L.destroy=function(){},y}(),Be=Ve,Ge=function(){function y(){}return y.getSilentFrame=function(x,f){switch(x){case"mp4a.40.2":if(f===1)return new Uint8Array([0,200,0,128,35,128]);if(f===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(f===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(f===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(f===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(f===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(f===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(f===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(f===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}return null},y}(),Ne=Ge,ge=Math.pow(2,32)-1,tt=function(){function y(){}return y.init=function(){y.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var x;for(x in y.types)y.types.hasOwnProperty(x)&&(y.types[x]=[x.charCodeAt(0),x.charCodeAt(1),x.charCodeAt(2),x.charCodeAt(3)]);var f=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),g=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);y.HDLR_TYPES={video:f,audio:g};var m=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),E=new Uint8Array([0,0,0,0,0,0,0,0]);y.STTS=y.STSC=y.STCO=E,y.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),y.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),y.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),y.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var A=new Uint8Array([105,115,111,109]),b=new Uint8Array([97,118,99,49]),O=new Uint8Array([0,0,0,1]);y.FTYP=y.box(y.types.ftyp,A,O,A,b),y.DINF=y.box(y.types.dinf,y.box(y.types.dref,m))},y.box=function(x){for(var f=Array.prototype.slice.call(arguments,1),g=8,m=f.length,E=m,A;m--;)g+=f[m].byteLength;for(A=new Uint8Array(g),A[0]=g>>24&255,A[1]=g>>16&255,A[2]=g>>8&255,A[3]=g&255,A.set(x,4),m=0,g=8;m<E;m++)A.set(f[m],g),g+=f[m].byteLength;return A},y.hdlr=function(x){return y.box(y.types.hdlr,y.HDLR_TYPES[x])},y.mdat=function(x){return y.box(y.types.mdat,x)},y.mdhd=function(x,f){f*=x;var g=Math.floor(f/(ge+1)),m=Math.floor(f%(ge+1));return y.box(y.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,g>>24,g>>16&255,g>>8&255,g&255,m>>24,m>>16&255,m>>8&255,m&255,85,196,0,0]))},y.mdia=function(x){return y.box(y.types.mdia,y.mdhd(x.timescale,x.duration),y.hdlr(x.type),y.minf(x))},y.mfhd=function(x){return y.box(y.types.mfhd,new Uint8Array([0,0,0,0,x>>24,x>>16&255,x>>8&255,x&255]))},y.minf=function(x){return x.type==="audio"?y.box(y.types.minf,y.box(y.types.smhd,y.SMHD),y.DINF,y.stbl(x)):y.box(y.types.minf,y.box(y.types.vmhd,y.VMHD),y.DINF,y.stbl(x))},y.moof=function(x,f,g){return y.box(y.types.moof,y.mfhd(x),y.traf(g,f))},y.moov=function(x){for(var f=x.length,g=[];f--;)g[f]=y.trak(x[f]);return y.box.apply(null,[y.types.moov,y.mvhd(x[0].timescale,x[0].duration)].concat(g).concat(y.mvex(x)))},y.mvex=function(x){for(var f=x.length,g=[];f--;)g[f]=y.trex(x[f]);return y.box.apply(null,[y.types.mvex].concat(g))},y.mvhd=function(x,f){f*=x;var g=Math.floor(f/(ge+1)),m=Math.floor(f%(ge+1)),E=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,g>>24,g>>16&255,g>>8&255,g&255,m>>24,m>>16&255,m>>8&255,m&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return y.box(y.types.mvhd,E)},y.sdtp=function(x){var f=x.samples||[],g=new Uint8Array(4+f.length),m,E;for(E=0;E<f.length;E++)m=f[E].flags,g[E+4]=m.dependsOn<<4|m.isDependedOn<<2|m.hasRedundancy;return y.box(y.types.sdtp,g)},y.stbl=function(x){return y.box(y.types.stbl,y.stsd(x),y.box(y.types.stts,y.STTS),y.box(y.types.stsc,y.STSC),y.box(y.types.stsz,y.STSZ),y.box(y.types.stco,y.STCO))},y.avc1=function(x){var f=[],g=[],m,E,A;for(m=0;m<x.sps.length;m++)E=x.sps[m],A=E.byteLength,f.push(A>>>8&255),f.push(A&255),f=f.concat(Array.prototype.slice.call(E));for(m=0;m<x.pps.length;m++)E=x.pps[m],A=E.byteLength,g.push(A>>>8&255),g.push(A&255),g=g.concat(Array.prototype.slice.call(E));var b=y.box(y.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|x.sps.length].concat(f).concat([x.pps.length]).concat(g))),O=x.width,U=x.height,B=x.pixelRatio[0],M=x.pixelRatio[1];return y.box(y.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,O>>8&255,O&255,U>>8&255,U&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),b,y.box(y.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),y.box(y.types.pasp,new Uint8Array([B>>24,B>>16&255,B>>8&255,B&255,M>>24,M>>16&255,M>>8&255,M&255])))},y.esds=function(x){var f=x.config.length;return new Uint8Array([0,0,0,0,3,23+f,0,1,0,4,15+f,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([f]).concat(x.config).concat([6,1,2]))},y.mp4a=function(x){var f=x.samplerate;return y.box(y.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,f>>8&255,f&255,0,0]),y.box(y.types.esds,y.esds(x)))},y.mp3=function(x){var f=x.samplerate;return y.box(y.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,f>>8&255,f&255,0,0]))},y.stsd=function(x){return x.type==="audio"?!x.isAAC&&x.codec==="mp3"?y.box(y.types.stsd,y.STSD,y.mp3(x)):y.box(y.types.stsd,y.STSD,y.mp4a(x)):y.box(y.types.stsd,y.STSD,y.avc1(x))},y.tkhd=function(x){var f=x.id,g=x.duration*x.timescale,m=x.width,E=x.height,A=Math.floor(g/(ge+1)),b=Math.floor(g%(ge+1));return y.box(y.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,f>>24&255,f>>16&255,f>>8&255,f&255,0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255,b>>24,b>>16&255,b>>8&255,b&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,m>>8&255,m&255,0,0,E>>8&255,E&255,0,0]))},y.traf=function(x,f){var g=y.sdtp(x),m=x.id,E=Math.floor(f/(ge+1)),A=Math.floor(f%(ge+1));return y.box(y.types.traf,y.box(y.types.tfhd,new Uint8Array([0,0,0,0,m>>24,m>>16&255,m>>8&255,m&255])),y.box(y.types.tfdt,new Uint8Array([1,0,0,0,E>>24,E>>16&255,E>>8&255,E&255,A>>24,A>>16&255,A>>8&255,A&255])),y.trun(x,g.length+16+20+8+16+8+8),g)},y.trak=function(x){return x.duration=x.duration||4294967295,y.box(y.types.trak,y.tkhd(x),y.mdia(x))},y.trex=function(x){var f=x.id;return y.box(y.types.trex,new Uint8Array([0,0,0,0,f>>24,f>>16&255,f>>8&255,f&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},y.trun=function(x,f){var g=x.samples||[],m=g.length,E=12+16*m,A=new Uint8Array(E),b,O,U,B,M,Y;for(f+=8+E,A.set([0,0,15,1,m>>>24&255,m>>>16&255,m>>>8&255,m&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255],0),b=0;b<m;b++)O=g[b],U=O.duration,B=O.size,M=O.flags,Y=O.cts,A.set([U>>>24&255,U>>>16&255,U>>>8&255,U&255,B>>>24&255,B>>>16&255,B>>>8&255,B&255,M.isLeading<<2|M.dependsOn,M.isDependedOn<<6|M.hasRedundancy<<4|M.paddingValue<<1|M.isNonSync,M.degradPrio&240<<8,M.degradPrio&15,Y>>>24&255,Y>>>16&255,Y>>>8&255,Y&255],12+16*b);return y.box(y.types.trun,A)},y.initSegment=function(x){y.types||y.init();var f=y.moov(x),g;return g=new Uint8Array(y.FTYP.byteLength+f.byteLength),g.set(y.FTYP),g.set(f,y.FTYP.byteLength),g},y}(),Re=tt,yt=9e4;function Et(y,L,x,f){x===void 0&&(x=1),f===void 0&&(f=!1);var g=y*L*x;return f?Math.round(g):g}function _e(y,L){return L===void 0&&(L=!1),Et(y,1e3,1/yt,L)}function Ze(y,L){return L===void 0&&(L=1),Et(y,yt,1/L)}var rt=Ze(10),nt=Ze(.2),pt=null,bt=function(){function y(x,f,g,m){if(this.observer=x,this.config=f,this.typeSupported=g,this.ISGenerated=!1,pt===null){var E=navigator.userAgent.match(/Chrome\/(\d+)/i);pt=E?parseInt(E[1]):0}}var L=y.prototype;return L.destroy=function(){},L.resetTimeStamp=function(f){this._initPTS=this._initDTS=f},L.resetInitSegment=function(){this.ISGenerated=!1},L.getVideoStartPts=function(f){var g=!1,m=f.reduce(function(E,A){var b=A.pts-E;return b<-4294967296?(g=!0,Je(E,A.pts)):b>0?E:A.pts},f[0].pts);return g&&h.logger.debug("PTS rollover detected"),m},L.remux=function(f,g,m,E,A,b,O){if(this.ISGenerated||this.generateIS(f,g,A),this.ISGenerated){var U=f.samples.length,B=g.samples.length,M=A,Y=A;if(U&&B){var H=this.getVideoStartPts(g.samples),Z=Je(f.samples[0].pts,H)-H,W=Z/g.inputTimeScale;M+=Math.max(0,W),Y+=Math.max(0,-W)}if(U){f.timescale||(h.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(f,g,A));var se=this.remuxAudio(f,M,b,O);if(B){var ae;se&&(ae=se.endPTS-se.startPTS),g.timescale||(h.logger.warn("regenerate InitSegment as video detected"),this.generateIS(f,g,A)),this.remuxVideo(g,Y,b,ae)}}else if(B){var he=this.remuxVideo(g,Y,b,0,O);he&&f.codec&&this.remuxEmptyAudio(f,M,b,he)}}m.samples.length&&this.remuxID3(m,A),E.samples.length&&this.remuxText(E,A),this.observer.trigger($.default.FRAG_PARSED)},L.generateIS=function(f,g,m){var E=this.observer,A=f.samples,b=g.samples,O=this.typeSupported,U="audio/mp4",B={},M={tracks:B},Y=this._initPTS===void 0,H,Z;if(Y&&(H=Z=1/0),f.config&&A.length&&(f.timescale=f.samplerate,h.logger.log("audio sampling rate : "+f.samplerate),f.isAAC||(O.mpeg?(U="audio/mpeg",f.codec=""):O.mp3&&(f.codec="mp3")),B.audio={container:U,codec:f.codec,initSegment:!f.isAAC&&O.mpeg?new Uint8Array:Re.initSegment([f]),metadata:{channelCount:f.channelCount}},Y&&(H=Z=A[0].pts-Math.round(f.inputTimeScale*m))),g.sps&&g.pps&&b.length){var W=g.inputTimeScale;if(g.timescale=W,B.video={container:"video/mp4",codec:g.codec,initSegment:Re.initSegment([g]),metadata:{width:g.width,height:g.height}},Y){var se=this.getVideoStartPts(b),ae=Math.round(W*m);Z=Math.min(Z,Je(b[0].dts,se)-ae),H=Math.min(H,se-ae),this.observer.trigger($.default.INIT_PTS_FOUND,{initPTS:H})}}else Y&&B.audio&&this.observer.trigger($.default.INIT_PTS_FOUND,{initPTS:H});Object.keys(B).length?(E.trigger($.default.FRAG_PARSING_INIT_SEGMENT,M),this.ISGenerated=!0,Y&&(this._initPTS=H,this._initDTS=Z)):E.trigger($.default.ERROR,{type:V.ErrorTypes.MEDIA_ERROR,details:V.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},L.remuxVideo=function(f,g,m,E){var A=f.timescale,b=f.samples,O=[],U=b.length,B=this._initPTS,M=8,Y,H,Z,W,se,ae=Number.POSITIVE_INFINITY,he=Number.NEGATIVE_INFINITY,Te=0,ce=!1,we=this.nextAvcDts;if(U!==0){if(!m){var Ee=g*A,me=b[0].pts-Je(b[0].dts,b[0].pts);we=Ee-me}for(var Ae=0;Ae<U;Ae++){var Le=b[Ae];Le.pts=Je(Le.pts-B,we),Le.dts=Je(Le.dts-B,we),Le.dts>Le.pts&&(Te=Math.max(Math.min(Te,Le.pts-Le.dts),-1*nt)),Le.dts<b[Ae>0?Ae-1:Ae].dts&&(ce=!0)}ce&&b.sort(function(Pt,Ht){var sr=Pt.dts-Ht.dts,or=Pt.pts-Ht.pts;return sr||or||Pt.id-Ht.id}),W=b[0].dts,se=b[U-1].dts;var qe=Math.round((se-W)/(U-1));if(Te<0){if(Te<qe*-2){h.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+_e(-qe,!0)+" ms");for(var He=Te,Fe=0;Fe<U;Fe++)b[Fe].dts=He=Math.max(He,b[Fe].pts-qe),b[Fe].pts=Math.max(He,b[Fe].pts)}else{h.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+_e(Te,!0)+" ms to overcome this issue");for(var et=0;et<U;et++)b[et].dts=b[et].dts+Te}W=b[0].dts,se=b[U-1].dts}if(m){var We=W-we,it=We>qe,Ke=We<-1;if(it||Ke){it?h.logger.warn("AVC: "+_e(We,!0)+" ms ("+We+"dts) hole between fragments detected, filling it"):h.logger.warn("AVC: "+_e(-We,!0)+" ms ("+We+"dts) overlapping between fragments detected"),W=we;var Oe=b[0].pts-We;b[0].dts=W,b[0].pts=Oe,h.logger.log("Video: First PTS/DTS adjusted: "+_e(Oe,!0)+"/"+_e(W,!0)+", delta: "+_e(We,!0)+" ms")}}pt&&pt<75&&(W=Math.max(0,W));for(var dt=0,ht=0,ot=0;ot<U;ot++){for(var Qe=b[ot],ft=Qe.units,ct=ft.length,mt=0,Dt=0;Dt<ct;Dt++)mt+=ft[Dt].data.length;ht+=mt,dt+=ct,Qe.length=mt,Qe.dts=Math.max(Qe.dts,W),Qe.pts=Math.max(Qe.pts,Qe.dts,0),ae=Math.min(Qe.pts,ae),he=Math.max(Qe.pts,he)}se=b[U-1].dts;var xt=ht+4*dt+8;try{H=new Uint8Array(xt)}catch{this.observer.trigger($.default.ERROR,{type:V.ErrorTypes.MUX_ERROR,details:V.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:xt,reason:"fail allocating video mdat "+xt});return}var It=new DataView(H.buffer);It.setUint32(0,xt),H.set(Re.types.mdat,4);for(var k=0;k<U;k++){for(var at=b[k],At=at.units,wt=0,gt=void 0,Gt=0,ar=At.length;Gt<ar;Gt++){var zt=At[Gt],qt=zt.data,Kt=zt.data.byteLength;It.setUint32(M,Kt),M+=4,H.set(qt,M),M+=Kt,wt+=4+Kt}if(k<U-1)Y=b[k+1].dts-at.dts;else{var Qt=this.config,Ft=at.dts-b[k>0?k-1:k].dts;if(Qt.stretchShortVideoTrack){var nr=Qt.maxBufferHole,jt=Math.floor(nr*A),kt=(E?ae+E*A:this.nextAudioPts)-at.pts;kt>jt?(Y=kt-Ft,Y<0&&(Y=Ft),h.logger.log("It is approximately "+_e(kt,!1)+" ms to the next segment; using duration "+_e(Y,!1)+" ms for the last video frame.")):Y=Ft}else Y=Ft}gt=Math.round(at.pts-at.dts),O.push({size:wt,duration:Y,cts:gt,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:at.key?2:1,isNonSync:at.key?0:1}})}this.nextAvcDts=se+Y;var Ot=f.dropped;if(f.nbNalu=0,f.dropped=0,O.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var $t=O[0].flags;$t.dependsOn=2,$t.isNonSync=0}f.samples=O,Z=Re.moof(f.sequenceNumber++,W,f),f.samples=[];var Zt={data1:Z,data2:H,startPTS:ae/A,endPTS:(he+Y)/A,startDTS:W/A,endDTS:this.nextAvcDts/A,type:"video",hasAudio:!1,hasVideo:!0,nb:O.length,dropped:Ot};return this.observer.trigger($.default.FRAG_PARSING_DATA,Zt),Zt}},L.remuxAudio=function(f,g,m,E){var A=f.inputTimeScale,b=f.timescale,O=A/b,U=f.isAAC?1024:1152,B=U*O,M=this._initPTS,Y=!f.isAAC&&this.typeSupported.mpeg,H,Z,W,se,ae,he,Te=Y?0:8,ce=f.samples,we=[],Ee=this.nextAudioPts;if(m|=ce.length&&Ee&&(E&&Math.abs(g-Ee/A)<.1||Math.abs(ce[0].pts-Ee-M)<20*B),ce.forEach(function(gt){gt.pts=gt.dts=Je(gt.pts-M,g*A)}),ce=ce.filter(function(gt){return gt.pts>=0}),ce.length!==0){if(m||(E?Ee=Math.max(0,g*A):Ee=ce[0].pts),f.isAAC)for(var me=this.config.maxAudioFramesDrift,Ae=0,Le=Ee;Ae<ce.length;){var qe=ce[Ae],He=qe.pts,Fe=He-Le;if(Fe<=-me*B)m||Ae>0?(h.logger.warn("Dropping 1 audio frame @ "+_e(Le,!0)/1e3+"s due to "+_e(Fe,!0)+" ms overlap."),ce.splice(Ae,1)):(h.logger.warn("Audio frame @ "+_e(He,!0)/1e3+"s overlaps nextAudioPts by "+_e(Fe,!0)+" ms."),Le=He+B,Ae++);else if(Fe>=me*B&&Fe<rt&&Le){var et=Math.round(Fe/B);h.logger.warn("Injecting "+et+" audio frames @ "+_e(Le,!0)/1e3+"s due to "+_e(Fe,!0)+" ms gap.");for(var We=0;We<et;We++){var it=Math.max(Le,0);Z=Ne.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),Z||(h.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Z=qe.unit.subarray()),ce.splice(Ae,0,{unit:Z,pts:it,dts:it}),Le+=B,Ae++}qe.pts=qe.dts=Le,Le+=B,Ae++}else qe.pts=qe.dts=Le,Le+=B,Ae++}for(var Ke=ce.length,Oe=0;Ke--;)Oe+=ce[Ke].unit.byteLength;for(var dt=0,ht=ce.length;dt<ht;dt++){var ot=ce[dt],Qe=ot.unit,ft=ot.pts;if(he!==void 0&&H)H.duration=Math.round((ft-he)/O);else{var ct=ft-Ee,mt=0;if(m&&f.isAAC&&ct){if(ct>0&&ct<rt)mt=Math.round((ft-Ee)/B),h.logger.log(_e(ct,!0)+" ms hole between AAC samples detected,filling it"),mt>0&&(Z=Ne.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),Z||(Z=Qe.subarray()),Oe+=mt*Z.length);else if(ct<-12){h.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+_e(Ee,!0)+" ms / "+_e(ft,!0)+" ms / "+_e(-ct,!0)+" ms"),Oe-=Qe.byteLength;continue}ft=Ee}if(ae=ft,Oe>0){Oe+=Te;try{W=new Uint8Array(Oe)}catch{this.observer.trigger($.default.ERROR,{type:V.ErrorTypes.MUX_ERROR,details:V.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Oe,reason:"fail allocating audio mdat "+Oe});return}if(!Y){var Dt=new DataView(W.buffer);Dt.setUint32(0,Oe),W.set(Re.types.mdat,4)}}else return;for(var xt=0;xt<mt;xt++)Z=Ne.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),Z||(h.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),Z=Qe.subarray()),W.set(Z,Te),Te+=Z.byteLength,H={size:Z.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},we.push(H)}W.set(Qe,Te);var It=Qe.byteLength;Te+=It,H={size:It,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},we.push(H),he=ft}var k=0;if(Ke=we.length,Ke>=2&&(k=we[Ke-2].duration,H.duration=k),Ke){this.nextAudioPts=Ee=he+O*k,f.samples=we,Y?se=new Uint8Array:se=Re.moof(f.sequenceNumber++,ae/O,f),f.samples=[];var at=ae/A,At=Ee/A,wt={data1:se,data2:W,startPTS:at,endPTS:At,startDTS:at,endDTS:At,type:"audio",hasAudio:!0,hasVideo:!1,nb:Ke};return this.observer.trigger($.default.FRAG_PARSING_DATA,wt),wt}return null}},L.remuxEmptyAudio=function(f,g,m,E){var A=f.inputTimeScale,b=f.samplerate?f.samplerate:A,O=A/b,U=this.nextAudioPts,B=(U!==void 0?U:E.startDTS*A)+this._initDTS,M=E.endDTS*A+this._initDTS,Y=1024,H=O*Y,Z=Math.ceil((M-B)/H),W=Ne.getSilentFrame(f.manifestCodec||f.codec,f.channelCount);if(h.logger.warn("remux empty Audio"),!W){h.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");return}for(var se=[],ae=0;ae<Z;ae++){var he=B+ae*H;se.push({unit:W,pts:he,dts:he})}f.samples=se,this.remuxAudio(f,g,m)},L.remuxID3=function(f,g){var m=f.samples.length;if(!!m){for(var E=f.inputTimeScale,A=this._initPTS,b=this._initDTS,O=0;O<m;O++){var U=f.samples[O];U.pts=Je(U.pts-A,g*E)/E,U.dts=Je(U.dts-b,g*E)/E}this.observer.trigger($.default.FRAG_PARSING_METADATA,{samples:f.samples}),f.samples=[]}},L.remuxText=function(f,g){var m=f.samples.length,E=f.inputTimeScale,A=this._initPTS;if(m){for(var b=0;b<m;b++){var O=f.samples[b];O.pts=Je(O.pts-A,g*E)/E}f.samples.sort(function(U,B){return U.pts-B.pts}),this.observer.trigger($.default.FRAG_PARSING_USERDATA,{samples:f.samples})}f.samples=[]},y}();function Je(y,L){var x;if(L===void 0)return y;for(L<y?x=-8589934592:x=8589934592;Math.abs(y-L)>4294967296;)y+=x;return y}var Tt=bt,ze=function(){function y(x){this.observer=x}var L=y.prototype;return L.destroy=function(){},L.resetTimeStamp=function(){},L.resetInitSegment=function(){},L.remux=function(f,g,m,E,A,b,O,U){var B=this.observer,M="";f&&(M+="audio"),g&&(M+="video"),B.trigger($.default.FRAG_PARSING_DATA,{data1:U,startPTS:A,startDTS:A,type:M,hasAudio:!!f,hasVideo:!!g,nb:1,dropped:0}),B.trigger($.default.FRAG_PARSED)},y}(),Lt=ze,st=Object(c.getSelfScope)(),Ye;try{Ye=st.performance.now.bind(st.performance)}catch{h.logger.debug("Unable to use Performance API on this environment"),Ye=st.Date.now}var ir=function(){function y(x,f,g,m){this.observer=x,this.typeSupported=f,this.config=g,this.vendor=m}var L=y.prototype;return L.destroy=function(){var f=this.demuxer;f&&f.destroy()},L.push=function(f,g,m,E,A,b,O,U,B,M,Y,H){var Z=this;if(f.byteLength>0&&g!=null&&g.key!=null&&g.method==="AES-128"){var W=this.decrypter;W==null&&(W=this.decrypter=new D.default(this.observer,this.config));var se=Ye();W.decrypt(f,g.key.buffer,g.iv.buffer,function(ae){var he=Ye();Z.observer.trigger($.default.FRAG_DECRYPTED,{stats:{tstart:se,tdecrypt:he}}),Z.pushDecrypted(new Uint8Array(ae),g,new Uint8Array(m),E,A,b,O,U,B,M,Y,H)})}else this.pushDecrypted(new Uint8Array(f),g,new Uint8Array(m),E,A,b,O,U,B,M,Y,H)},L.pushDecrypted=function(f,g,m,E,A,b,O,U,B,M,Y,H){var Z=this.demuxer,W=this.remuxer;if(!Z||O||U){for(var se=this.observer,ae=this.typeSupported,he=this.config,Te=[{demux:Me,remux:Tt},{demux:oe.default,remux:Lt},{demux:J,remux:Tt},{demux:Be,remux:Tt}],ce,we=0,Ee=Te.length;we<Ee&&(ce=Te[we],!ce.demux.probe(f));we++);if(!ce){se.trigger($.default.ERROR,{type:V.ErrorTypes.MEDIA_ERROR,details:V.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});return}(!W||!(W instanceof ce.remux))&&(W=new ce.remux(se,he,ae,this.vendor)),(!Z||!(Z instanceof ce.demux))&&(Z=new ce.demux(se,W,he,ae),this.probe=ce.demux.probe),this.demuxer=Z,this.remuxer=W}(O||U)&&(Z.resetInitSegment(m,E,A,M),W.resetInitSegment()),O&&(Z.resetTimeStamp(H),W.resetTimeStamp(H)),typeof Z.setDecryptData=="function"&&Z.setDecryptData(g),Z.append(f,b,B,Y)},y}();re.default=ir},"./src/demux/demuxer-worker.js":function(ve,re,j){j.r(re);var $=j("./src/demux/demuxer-inline.js"),V=j("./src/events.js"),D=j("./src/utils/logger.js"),ee=j("./node_modules/eventemitter3/index.js"),h=function(q){var T=new ee.EventEmitter;T.trigger=function(S){for(var w=arguments.length,P=new Array(w>1?w-1:0),C=1;C<w;C++)P[C-1]=arguments[C];T.emit.apply(T,[S,S].concat(P))},T.off=function(S){for(var w=arguments.length,P=new Array(w>1?w-1:0),C=1;C<w;C++)P[C-1]=arguments[C];T.removeListener.apply(T,[S].concat(P))};var _=function(S,w){q.postMessage({event:S,data:w})};q.addEventListener("message",function(I){var S=I.data;switch(S.cmd){case"init":var w=JSON.parse(S.config);q.demuxer=new $.default(T,S.typeSupported,w,S.vendor),Object(D.enableLogs)(w.debug),_("init",null);break;case"demux":q.demuxer.push(S.data,S.decryptdata,S.initSegment,S.audioCodec,S.videoCodec,S.timeOffset,S.discontinuity,S.trackSwitch,S.contiguous,S.duration,S.accurateTimeOffset,S.defaultInitPTS);break}}),T.on(V.default.FRAG_DECRYPTED,_),T.on(V.default.FRAG_PARSING_INIT_SEGMENT,_),T.on(V.default.FRAG_PARSED,_),T.on(V.default.ERROR,_),T.on(V.default.FRAG_PARSING_METADATA,_),T.on(V.default.FRAG_PARSING_USERDATA,_),T.on(V.default.INIT_PTS_FOUND,_),T.on(V.default.FRAG_PARSING_DATA,function(I,S){var w=[],P={event:I,data:S};S.data1&&(P.data1=S.data1.buffer,w.push(S.data1.buffer),delete S.data1),S.data2&&(P.data2=S.data2.buffer,w.push(S.data2.buffer),delete S.data2),q.postMessage(P,w)})};re.default=h},"./src/demux/id3.js":function(ve,re,j){j.r(re),j.d(re,"utf8ArrayToStr",function(){return h});var $=j("./src/utils/get-self-scope.js"),V=function(){function c(){}return c.isHeader=function(T,_){return _+10<=T.length&&T[_]===73&&T[_+1]===68&&T[_+2]===51&&T[_+3]<255&&T[_+4]<255&&T[_+6]<128&&T[_+7]<128&&T[_+8]<128&&T[_+9]<128},c.isFooter=function(T,_){return _+10<=T.length&&T[_]===51&&T[_+1]===68&&T[_+2]===73&&T[_+3]<255&&T[_+4]<255&&T[_+6]<128&&T[_+7]<128&&T[_+8]<128&&T[_+9]<128},c.getID3Data=function(T,_){for(var I=_,S=0;c.isHeader(T,_);){S+=10;var w=c._readSize(T,_+6);S+=w,c.isFooter(T,_+10)&&(S+=10),_+=S}if(S>0)return T.subarray(I,I+S)},c._readSize=function(T,_){var I=0;return I=(T[_]&127)<<21,I|=(T[_+1]&127)<<14,I|=(T[_+2]&127)<<7,I|=T[_+3]&127,I},c.getTimeStamp=function(T){for(var _=c.getID3Frames(T),I=0;I<_.length;I++){var S=_[I];if(c.isTimeStampFrame(S))return c._readTimeStamp(S)}},c.isTimeStampFrame=function(T){return T&&T.key==="PRIV"&&T.info==="com.apple.streaming.transportStreamTimestamp"},c._getFrameData=function(T){var _=String.fromCharCode(T[0],T[1],T[2],T[3]),I=c._readSize(T,4),S=10;return{type:_,size:I,data:T.subarray(S,S+I)}},c.getID3Frames=function(T){for(var _=0,I=[];c.isHeader(T,_);){var S=c._readSize(T,_+6);_+=10;for(var w=_+S;_+8<w;){var P=c._getFrameData(T.subarray(_)),C=c._decodeFrame(P);C&&I.push(C),_+=P.size+10}c.isFooter(T,_)&&(_+=10)}return I},c._decodeFrame=function(T){return T.type==="PRIV"?c._decodePrivFrame(T):T.type[0]==="W"?c._decodeURLFrame(T):c._decodeTextFrame(T)},c._readTimeStamp=function(T){if(T.data.byteLength===8){var _=new Uint8Array(T.data),I=_[3]&1,S=(_[4]<<23)+(_[5]<<15)+(_[6]<<7)+_[7];return S/=45,I&&(S+=4772185884e-2),Math.round(S)}},c._decodePrivFrame=function(T){if(!(T.size<2)){var _=c._utf8ArrayToStr(T.data,!0),I=new Uint8Array(T.data.subarray(_.length+1));return{key:T.type,info:_,data:I.buffer}}},c._decodeTextFrame=function(T){if(!(T.size<2))if(T.type==="TXXX"){var _=1,I=c._utf8ArrayToStr(T.data.subarray(_),!0);_+=I.length+1;var S=c._utf8ArrayToStr(T.data.subarray(_));return{key:T.type,info:I,data:S}}else{var w=c._utf8ArrayToStr(T.data.subarray(1));return{key:T.type,data:w}}},c._decodeURLFrame=function(T){if(T.type==="WXXX"){if(T.size<2)return;var _=1,I=c._utf8ArrayToStr(T.data.subarray(_),!0);_+=I.length+1;var S=c._utf8ArrayToStr(T.data.subarray(_));return{key:T.type,info:I,data:S}}else{var w=c._utf8ArrayToStr(T.data);return{key:T.type,data:w}}},c._utf8ArrayToStr=function(T,_){_===void 0&&(_=!1);var I=ee();if(I){var S=I.decode(T);if(_){var w=S.indexOf("\0");return w!==-1?S.substring(0,w):S}return S.replace(/\0/g,"")}for(var P=T.length,C,z,N,G="",Q=0;Q<P;){if(C=T[Q++],C===0&&_)return G;if(C===0||C===3)continue;switch(C>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:G+=String.fromCharCode(C);break;case 12:case 13:z=T[Q++],G+=String.fromCharCode((C&31)<<6|z&63);break;case 14:z=T[Q++],N=T[Q++],G+=String.fromCharCode((C&15)<<12|(z&63)<<6|(N&63)<<0);break}}return G},c}(),D;function ee(){var c=Object($.getSelfScope)();return!D&&typeof c.TextDecoder!="undefined"&&(D=new c.TextDecoder("utf-8")),D}var h=V._utf8ArrayToStr;re.default=V},"./src/demux/mp4demuxer.js":function(ve,re,j){j.r(re);var $=j("./src/utils/logger.js"),V=j("./src/events.js"),D=Math.pow(2,32)-1,ee=function(){function h(q,T){this.observer=q,this.remuxer=T}var c=h.prototype;return c.resetTimeStamp=function(T){this.initPTS=T},c.resetInitSegment=function(T,_,I,S){if(T&&T.byteLength){var w=this.initData=h.parseInitSegment(T);_==null&&(_="mp4a.40.5"),I==null&&(I="avc1.42e01e");var P={};w.audio&&w.video?P.audiovideo={container:"video/mp4",codec:_+","+I,initSegment:S?T:null}:(w.audio&&(P.audio={container:"audio/mp4",codec:_,initSegment:S?T:null}),w.video&&(P.video={container:"video/mp4",codec:I,initSegment:S?T:null})),this.observer.trigger(V.default.FRAG_PARSING_INIT_SEGMENT,{tracks:P})}else _&&(this.audioCodec=_),I&&(this.videoCodec=I)},h.probe=function(T){return h.findBox({data:T,start:0,end:Math.min(T.length,16384)},["moof"]).length>0},h.bin2str=function(T){return String.fromCharCode.apply(null,T)},h.readUint16=function(T,_){T.data&&(_+=T.start,T=T.data);var I=T[_]<<8|T[_+1];return I<0?65536+I:I},h.readUint32=function(T,_){T.data&&(_+=T.start,T=T.data);var I=T[_]<<24|T[_+1]<<16|T[_+2]<<8|T[_+3];return I<0?4294967296+I:I},h.writeUint32=function(T,_,I){T.data&&(_+=T.start,T=T.data),T[_]=I>>24,T[_+1]=I>>16&255,T[_+2]=I>>8&255,T[_+3]=I&255},h.findBox=function(T,_){var I=[],S,w,P,C,z,N,G;if(T.data?(N=T.start,C=T.end,T=T.data):(N=0,C=T.byteLength),!_.length)return null;for(S=N;S<C;)w=h.readUint32(T,S),P=h.bin2str(T.subarray(S+4,S+8)),G=w>1?S+w:C,P===_[0]&&(_.length===1?I.push({data:T,start:S+8,end:G}):(z=h.findBox({data:T,start:S+8,end:G},_.slice(1)),z.length&&(I=I.concat(z)))),S=G;return I},h.parseSegmentIndex=function(T){var _=h.findBox(T,["moov"])[0],I=_?_.end:null,S=0,w=h.findBox(T,["sidx"]),P;if(!w||!w[0])return null;P=[],w=w[0];var C=w.data[0];S=C===0?8:16;var z=h.readUint32(w,S);S+=4;var N=0,G=0;C===0?S+=8:S+=16,S+=2;var Q=w.end+G,J=h.readUint16(w,S);S+=2;for(var oe=0;oe<J;oe++){var ie=S,fe=h.readUint32(w,ie);ie+=4;var Se=fe&2147483647,Ce=(fe&2147483648)>>>31;if(Ce===1){console.warn("SIDX has hierarchical references (not supported)");return}var Pe=h.readUint32(w,ie);ie+=4,P.push({referenceSize:Se,subsegmentDuration:Pe,info:{duration:Pe/z,start:Q,end:Q+Se-1}}),Q+=Se,ie+=4,S=ie}return{earliestPresentationTime:N,timescale:z,version:C,referencesCount:J,references:P,moovEndOffset:I}},h.parseInitSegment=function(T){var _=[],I=h.findBox(T,["moov","trak"]);return I.forEach(function(S){var w=h.findBox(S,["tkhd"])[0];if(w){var P=w.data[w.start],C=P===0?12:20,z=h.readUint32(w,C),N=h.findBox(S,["mdia","mdhd"])[0];if(N){P=N.data[N.start],C=P===0?12:20;var G=h.readUint32(N,C),Q=h.findBox(S,["mdia","hdlr"])[0];if(Q){var J=h.bin2str(Q.data.subarray(Q.start+8,Q.start+12)),oe={soun:"audio",vide:"video"}[J];if(oe){var ie=h.findBox(S,["mdia","minf","stbl","stsd"]);if(ie.length){ie=ie[0];var fe=h.bin2str(ie.data.subarray(ie.start+12,ie.start+16));$.logger.log("MP4Demuxer:"+oe+":"+fe+" found")}_[z]={timescale:G,type:oe},_[oe]={timescale:G,id:z}}}}}}),_},h.getStartDTS=function(T,_){var I,S,w;return I=h.findBox(_,["moof","traf"]),S=[].concat.apply([],I.map(function(P){return h.findBox(P,["tfhd"]).map(function(C){var z,N,G;return z=h.readUint32(C,4),N=T[z].timescale||9e4,G=h.findBox(P,["tfdt"]).map(function(Q){var J,oe;return J=Q.data[Q.start],oe=h.readUint32(Q,4),J===1&&(oe*=Math.pow(2,32),oe+=h.readUint32(Q,8)),oe})[0],G/N})})),w=Math.min.apply(null,S),isFinite(w)?w:0},h.offsetStartDTS=function(T,_,I){h.findBox(_,["moof","traf"]).map(function(S){return h.findBox(S,["tfhd"]).map(function(w){var P=h.readUint32(w,4),C=T[P].timescale||9e4;h.findBox(S,["tfdt"]).map(function(z){var N=z.data[z.start],G=h.readUint32(z,4);if(N===0)h.writeUint32(z,4,G-I*C);else{G*=Math.pow(2,32),G+=h.readUint32(z,8),G-=I*C,G=Math.max(G,0);var Q=Math.floor(G/(D+1)),J=Math.floor(G%(D+1));h.writeUint32(z,4,Q),h.writeUint32(z,8,J)}})})})},c.append=function(T,_,I,S){var w=this.initData;w||(this.resetInitSegment(T,this.audioCodec,this.videoCodec,!1),w=this.initData);var P,C=this.initPTS;if(C===void 0){var z=h.getStartDTS(w,T);this.initPTS=C=z-_,this.observer.trigger(V.default.INIT_PTS_FOUND,{initPTS:C})}h.offsetStartDTS(w,T,C),P=h.getStartDTS(w,T),this.remuxer.remux(w.audio,w.video,null,null,P,I,S,T)},c.destroy=function(){},h}();re.default=ee},"./src/errors.ts":function(ve,re,j){j.r(re),j.d(re,"ErrorTypes",function(){return $}),j.d(re,"ErrorDetails",function(){return V});var $;(function(D){D.NETWORK_ERROR="networkError",D.MEDIA_ERROR="mediaError",D.KEY_SYSTEM_ERROR="keySystemError",D.MUX_ERROR="muxError",D.OTHER_ERROR="otherError"})($||($={}));var V;(function(D){D.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",D.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",D.KEY_SYSTEM_NO_SESSION="keySystemNoSession",D.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",D.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",D.MANIFEST_LOAD_ERROR="manifestLoadError",D.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",D.MANIFEST_PARSING_ERROR="manifestParsingError",D.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",D.LEVEL_EMPTY_ERROR="levelEmptyError",D.LEVEL_LOAD_ERROR="levelLoadError",D.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",D.LEVEL_SWITCH_ERROR="levelSwitchError",D.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",D.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",D.FRAG_LOAD_ERROR="fragLoadError",D.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",D.FRAG_DECRYPT_ERROR="fragDecryptError",D.FRAG_PARSING_ERROR="fragParsingError",D.REMUX_ALLOC_ERROR="remuxAllocError",D.KEY_LOAD_ERROR="keyLoadError",D.KEY_LOAD_TIMEOUT="keyLoadTimeOut",D.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",D.BUFFER_APPEND_ERROR="bufferAppendError",D.BUFFER_APPENDING_ERROR="bufferAppendingError",D.BUFFER_STALLED_ERROR="bufferStalledError",D.BUFFER_FULL_ERROR="bufferFullError",D.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",D.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",D.INTERNAL_EXCEPTION="internalException"})(V||(V={}))},"./src/events.js":function(ve,re,j){j.r(re);var $={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"};re.default=$},"./src/hls.ts":function(ve,re,j){j.r(re),j.d(re,"default",function(){return Yr});var $={};j.r($),j.d($,"newCue",function(){return Pi});var V=j("./node_modules/url-toolkit/src/url-toolkit.js"),D=j("./src/errors.ts"),ee=j("./src/polyfills/number.js"),h=j("./src/events.js"),c=j("./src/utils/logger.js"),q={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},T=function(){function o(i){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=i,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];this.handledEvents=e,this.useGenericHandler=!0,this.registerListeners()}var n=o.prototype;return n.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},n.onHandlerDestroying=function(){},n.onHandlerDestroyed=function(){},n.isEventHandler=function(){return typeof this.handledEvents=="object"&&this.handledEvents.length&&typeof this.onEvent=="function"},n.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(r){if(q[r])throw new Error("Forbidden event-name: "+r);this.hls.on(r,this.onEvent)},this)},n.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(r){this.hls.off(r,this.onEvent)},this)},n.onEvent=function(r,e){this.onEventGeneric(r,e)},n.onEventGeneric=function(r,e){var t=function(s,l){var u="on"+s.replace("hls","");if(typeof this[u]!="function")throw new Error("Event "+s+" has no generic handler in this "+this.constructor.name+" class (tried "+u+")");return this[u].bind(this,l)};try{t.call(this,r,e).call()}catch(a){c.logger.error("An internal error happened while handling event "+r+'. Error message: "'+a.message+'". Here is a stacktrace:',a),this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:r,err:a})}},o}(),_=T,I;(function(o){o.MANIFEST="manifest",o.LEVEL="level",o.AUDIO_TRACK="audioTrack",o.SUBTITLE_TRACK="subtitleTrack"})(I||(I={}));var S;(function(o){o.MAIN="main",o.AUDIO="audio",o.SUBTITLE="subtitle"})(S||(S={}));var w=j("./src/demux/mp4demuxer.js");function P(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function C(o,n,i){return n&&P(o.prototype,n),i&&P(o,i),o}var z=function(){function o(n,i){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=n,this.reluri=i}return C(o,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(V.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),o}();function N(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function G(o,n,i){return n&&N(o.prototype,n),i&&N(o,i),o}var Q;(function(o){o.AUDIO="audio",o.VIDEO="video"})(Q||(Q={}));var J=function(){function o(){var i;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=(i={},i[Q.AUDIO]=!1,i[Q.VIDEO]=!1,i),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var n=o.prototype;return n.setByteRange=function(r,e){var t=r.split("@",2),a=[];t.length===1?a[0]=e?e.byteRangeEndOffset:0:a[0]=parseInt(t[1]),a[1]=parseInt(t[0])+a[0],this._byteRange=a},n.addElementaryStream=function(r){this._elementaryStreams[r]=!0},n.hasElementaryStream=function(r){return this._elementaryStreams[r]===!0},n.createInitializationVector=function(r){for(var e=new Uint8Array(16),t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e},n.setDecryptDataFromLevelKey=function(r,e){var t=r;return(r==null?void 0:r.method)&&r.uri&&!r.iv&&(t=new z(r.baseuri,r.reluri),t.method=r.method,t.iv=this.createInitializationVector(e)),t},G(o,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(V.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(r){this._url=r}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var r=this.sn;typeof r!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&c.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),r=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,r)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(ee.isFiniteNumber)(this.programDateTime))return null;var r=Object(ee.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+r*1e3}},{key:"encrypted",get:function(){return!!(this.decryptdata&&this.decryptdata.uri!==null&&this.decryptdata.key===null)}}]),o}();function oe(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function ie(o,n,i){return n&&oe(o.prototype,n),i&&oe(o,i),o}var fe=function(){function o(n){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=n,this.version=null}return ie(o,[{key:"hasProgramDateTime",get:function(){return!!(this.fragments[0]&&Object(ee.isFiniteNumber)(this.fragments[0].programDateTime))}}]),o}(),Se=/^(\d+)x(\d+)$/,Ce=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Pe=function(){function o(i){typeof i=="string"&&(i=o.parseAttrList(i));for(var r in i)i.hasOwnProperty(r)&&(this[r]=i[r])}var n=o.prototype;return n.decimalInteger=function(r){var e=parseInt(this[r],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},n.hexadecimalInteger=function(r){if(this[r]){var e=(this[r]||"0x").slice(2);e=(e.length&1?"0":"")+e;for(var t=new Uint8Array(e.length/2),a=0;a<e.length/2;a++)t[a]=parseInt(e.slice(a*2,a*2+2),16);return t}else return null},n.hexadecimalIntegerAsNumber=function(r){var e=parseInt(this[r],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},n.decimalFloatingPoint=function(r){return parseFloat(this[r])},n.enumeratedString=function(r){return this[r]},n.decimalResolution=function(r){var e=Se.exec(this[r]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},o.parseAttrList=function(r){var e,t={};for(Ce.lastIndex=0;(e=Ce.exec(r))!==null;){var a=e[2],s='"';a.indexOf(s)===0&&a.lastIndexOf(s)===a.length-1&&(a=a.slice(1,-1)),t[e[1]]=a}return t},o}(),be=Pe,ut={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function Ie(o,n){var i=ut[n];return!!i&&i[o.slice(0,4)]===!0}function Me(o,n){return MediaSource.isTypeSupported((n||"video")+'/mp4;codecs="'+o+'"')}var Ve=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,Be=/#EXT-X-MEDIA:(.*)/g,Ge=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Ne=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,ge=/\.(mp4|m4s|m4v|m4a)$/i,tt=function(){function o(){}return o.findGroup=function(i,r){for(var e=0;e<i.length;e++){var t=i[e];if(t.id===r)return t}},o.convertAVC1ToAVCOTI=function(i){var r=i.split("."),e;return r.length>2?(e=r.shift()+".",e+=parseInt(r.shift()).toString(16),e+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):e=i,e},o.resolve=function(i,r){return V.buildAbsoluteURL(r,i,{alwaysNormalize:!0})},o.parseMasterPlaylist=function(i,r){var e=[],t={},a=!1;Ve.lastIndex=0;function s(R,F){["video","audio"].forEach(function(K){var X=R.filter(function(te){return Ie(te,K)});if(X.length){var ne=X.filter(function(te){return te.lastIndexOf("avc1",0)===0||te.lastIndexOf("mp4a",0)===0});F[K+"Codec"]=ne.length>0?ne[0]:X[0],R=R.filter(function(te){return X.indexOf(te)===-1})}}),F.unknownCodecs=R}for(var l;(l=Ve.exec(i))!=null;)if(l[1]){var u={},d=u.attrs=new be(l[1]);u.url=o.resolve(l[2],r);var v=d.decimalResolution("RESOLUTION");v&&(u.width=v.width,u.height=v.height),u.bitrate=d.decimalInteger("AVERAGE-BANDWIDTH")||d.decimalInteger("BANDWIDTH"),u.name=d.NAME,s([].concat((d.CODECS||"").split(/[ ,]+/)),u),u.videoCodec&&u.videoCodec.indexOf("avc1")!==-1&&(u.videoCodec=o.convertAVC1ToAVCOTI(u.videoCodec)),e.push(u)}else if(l[3]){var p=new be(l[3]);p["DATA-ID"]&&(a=!0,t[p["DATA-ID"]]=p)}return{levels:e,sessionData:a?t:null}},o.parseMasterPlaylistMedia=function(i,r,e,t){t===void 0&&(t=[]);var a,s=[],l=0;for(Be.lastIndex=0;(a=Be.exec(i))!==null;){var u=new be(a[1]);if(u.TYPE===e){var d={attrs:u,id:l++,groupId:u["GROUP-ID"],instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE,type:e,default:u.DEFAULT==="YES",autoselect:u.AUTOSELECT==="YES",forced:u.FORCED==="YES",lang:u.LANGUAGE};if(u.URI&&(d.url=o.resolve(u.URI,r)),t.length){var v=o.findGroup(t,d.groupId);d.audioCodec=v?v.codec:t[0].codec}s.push(d)}}return s},o.parseLevelPlaylist=function(i,r,e,t,a){var s=0,l=0,u=new fe(r),d=0,v=null,p=new J,R,F,K,X=null;for(Ge.lastIndex=0;(R=Ge.exec(i))!==null;){var ne=R[1];if(ne){p.duration=parseFloat(ne);var te=(" "+R[2]).slice(1);p.title=te||null,p.tagList.push(te?["INF",ne,te]:["INF",ne])}else if(R[3]){if(Object(ee.isFiniteNumber)(p.duration)){var ue=s++;p.type=t,p.start=l,K&&(p.levelkey=K),p.sn=ue,p.level=e,p.cc=d,p.urlId=a,p.baseurl=r,p.relurl=(" "+R[3]).slice(1),yt(p,v),u.fragments.push(p),v=p,l+=p.duration,p=new J}}else if(R[4]){var de=(" "+R[4]).slice(1);v?p.setByteRange(de,v):p.setByteRange(de)}else if(R[5])p.rawProgramDateTime=(" "+R[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),X===null&&(X=u.fragments.length);else{if(R=R[0].match(Ne),!R){c.logger.warn("No matches on slow regex match for level playlist!");continue}for(F=1;F<R.length&&typeof R[F]=="undefined";F++);var ye=(" "+R[F+1]).slice(1),Ue=(" "+R[F+2]).slice(1);switch(R[F]){case"#":p.tagList.push(Ue?[ye,Ue]:[ye]);break;case"PLAYLIST-TYPE":u.type=ye.toUpperCase();break;case"MEDIA-SEQUENCE":s=u.startSN=parseInt(ye);break;case"TARGETDURATION":u.targetduration=parseFloat(ye);break;case"VERSION":u.version=parseInt(ye);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":d++,p.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(ye);break;case"KEY":{var lt=ye,$e=new be(lt),_t=$e.enumeratedString("METHOD"),le=$e.URI,pe=$e.hexadecimalInteger("IV"),je=$e.KEYFORMAT||"identity";if(je==="com.apple.streamingkeydelivery"){c.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}_t&&(K=new z(r,le),le&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(_t)>=0&&(K.method=_t,K.key=null,K.iv=pe));break}case"START":{var Ut=new be(ye),Bt=Ut.decimalFloatingPoint("TIME-OFFSET");Object(ee.isFiniteNumber)(Bt)&&(u.startTimeOffset=Bt);break}case"MAP":{var Vt=new be(ye);p.relurl=Vt.URI,Vt.BYTERANGE&&p.setByteRange(Vt.BYTERANGE),p.baseurl=r,p.level=e,p.type=t,p.sn="initSegment",u.initSegment=p,p=new J,p.rawProgramDateTime=u.initSegment.rawProgramDateTime;break}default:c.logger.warn("line parsed but not handled: "+R);break}}}return p=v,p&&!p.relurl&&(u.fragments.pop(),l-=p.duration),u.totalduration=l,u.averagetargetduration=l/u.fragments.length,u.endSN=s-1,u.startCC=u.fragments[0]?u.fragments[0].cc:0,u.endCC=d,!u.initSegment&&u.fragments.length&&u.fragments.every(function(rr){return ge.test(rr.relurl)})&&(c.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),p=new J,p.relurl=u.fragments[0].relurl,p.baseurl=r,p.level=e,p.type=t,p.sn="initSegment",u.initSegment=p,u.needSidxRanges=!0),X&&Re(u.fragments,X),u},o}();function Re(o,n){for(var i=o[n],r=n-1;r>=0;r--){var e=o[r];e.programDateTime=i.programDateTime-e.duration*1e3,i=e}}function yt(o,n){o.rawProgramDateTime?o.programDateTime=Date.parse(o.rawProgramDateTime):n!=null&&n.programDateTime&&(o.programDateTime=n.endProgramDateTime),Object(ee.isFiniteNumber)(o.programDateTime)||(o.programDateTime=null,o.rawProgramDateTime=null)}function Et(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var _e=window,Ze=_e.performance,rt=function(o){Et(n,o);function n(r){var e;return e=o.call(this,r,h.default.MANIFEST_LOADING,h.default.LEVEL_LOADING,h.default.AUDIO_TRACK_LOADING,h.default.SUBTITLE_TRACK_LOADING)||this,e.loaders={},e}n.canHaveQualityLevels=function(e){return e!==I.AUDIO_TRACK&&e!==I.SUBTITLE_TRACK},n.mapContextToLevelType=function(e){var t=e.type;switch(t){case I.AUDIO_TRACK:return S.AUDIO;case I.SUBTITLE_TRACK:return S.SUBTITLE;default:return S.MAIN}},n.getResponseUrl=function(e,t){var a=e.url;return(a===void 0||a.indexOf("data:")===0)&&(a=t.url),a};var i=n.prototype;return i.createInternalLoader=function(e){var t=this.hls.config,a=t.pLoader,s=t.loader,l=a||s,u=new l(t);return e.loader=u,this.loaders[e.type]=u,u},i.getInternalLoader=function(e){return this.loaders[e.type]},i.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},i.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},i.destroy=function(){this.destroyInternalLoaders(),o.prototype.destroy.call(this)},i.onManifestLoading=function(e){this.load({url:e.url,type:I.MANIFEST,level:0,id:null,responseType:"text"})},i.onLevelLoading=function(e){this.load({url:e.url,type:I.LEVEL,level:e.level,id:e.id,responseType:"text"})},i.onAudioTrackLoading=function(e){this.load({url:e.url,type:I.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},i.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:I.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},i.load=function(e){var t=this.hls.config;c.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var a=this.getInternalLoader(e);if(a){var s=a.context;if(s&&s.url===e.url)return c.logger.trace("playlist request ongoing"),!1;c.logger.warn("aborting previous loader for type: "+e.type),a.abort()}var l,u,d,v;switch(e.type){case I.MANIFEST:l=t.manifestLoadingMaxRetry,u=t.manifestLoadingTimeOut,d=t.manifestLoadingRetryDelay,v=t.manifestLoadingMaxRetryTimeout;break;case I.LEVEL:l=0,v=0,d=0,u=t.levelLoadingTimeOut;break;default:l=t.levelLoadingMaxRetry,u=t.levelLoadingTimeOut,d=t.levelLoadingRetryDelay,v=t.levelLoadingMaxRetryTimeout;break}a=this.createInternalLoader(e);var p={timeout:u,maxRetry:l,retryDelay:d,maxRetryDelay:v},R={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return c.logger.debug("Calling internal loader delegate for URL: "+e.url),a.load(e,p,R),!0},i.loadsuccess=function(e,t,a,s){if(s===void 0&&(s=null),a.isSidxRequest){this._handleSidxRequest(e,a),this._handlePlaylistLoaded(e,t,a,s);return}if(this.resetInternalLoader(a.type),typeof e.data!="string")throw new Error('expected responseType of "text" for PlaylistLoader');var l=e.data;if(t.tload=Ze.now(),l.indexOf("#EXTM3U")!==0){this._handleManifestParsingError(e,a,"no EXTM3U delimiter",s);return}l.indexOf("#EXTINF:")>0||l.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,a,s):this._handleMasterPlaylist(e,t,a,s)},i.loaderror=function(e,t,a){a===void 0&&(a=null),this._handleNetworkError(t,a,!1,e)},i.loadtimeout=function(e,t,a){a===void 0&&(a=null),this._handleNetworkError(t,a,!0)},i._handleMasterPlaylist=function(e,t,a,s){var l=this.hls,u=e.data,d=n.getResponseUrl(e,a),v=tt.parseMasterPlaylist(u,d),p=v.levels,R=v.sessionData;if(!p.length){this._handleManifestParsingError(e,a,"no level found in manifest",s);return}var F=p.map(function(ue){return{id:ue.attrs.AUDIO,codec:ue.audioCodec}}),K=tt.parseMasterPlaylistMedia(u,d,"AUDIO",F),X=tt.parseMasterPlaylistMedia(u,d,"SUBTITLES"),ne=tt.parseMasterPlaylistMedia(u,d,"CLOSED-CAPTIONS");if(K.length){var te=!1;K.forEach(function(ue){ue.url||(te=!0)}),te===!1&&p[0].audioCodec&&!p[0].attrs.AUDIO&&(c.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),K.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}l.trigger(h.default.MANIFEST_LOADED,{levels:p,audioTracks:K,subtitles:X,captions:ne,url:d,stats:t,networkDetails:s,sessionData:R})},i._handleTrackOrLevelPlaylist=function(e,t,a,s){var l=this.hls,u=a.id,d=a.level,v=a.type,p=n.getResponseUrl(e,a),R=Object(ee.isFiniteNumber)(u)?u:0,F=Object(ee.isFiniteNumber)(d)?d:R,K=n.mapContextToLevelType(a),X=tt.parseLevelPlaylist(e.data,p,F,K,R);if(X.tload=t.tload,!X.fragments.length){l.trigger(h.default.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:p,reason:"no fragments found in level",level:typeof a.level=="number"?a.level:void 0});return}if(v===I.MANIFEST){var ne={url:p,details:X};l.trigger(h.default.MANIFEST_LOADED,{levels:[ne],audioTracks:[],url:p,stats:t,networkDetails:s,sessionData:null})}if(t.tparsed=Ze.now(),X.needSidxRanges){var te=X.initSegment.url;this.load({url:te,isSidxRequest:!0,type:v,level:d,levelDetails:X,id:u,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"});return}a.levelDetails=X,this._handlePlaylistLoaded(e,t,a,s)},i._handleSidxRequest=function(e,t){if(typeof e.data=="string")throw new Error("sidx request must be made with responseType of array buffer");var a=w.default.parseSegmentIndex(new Uint8Array(e.data));if(!!a){var s=a.references,l=t.levelDetails;s.forEach(function(u,d){var v=u.info;if(!!l){var p=l.fragments[d];p.byteRange.length===0&&p.setByteRange(String(1+v.end-v.start)+"@"+String(v.start))}}),l&&l.initSegment.setByteRange(String(a.moovEndOffset)+"@0")}},i._handleManifestParsingError=function(e,t,a,s){this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:a,networkDetails:s})},i._handleNetworkError=function(e,t,a,s){a===void 0&&(a=!1),s===void 0&&(s=null),c.logger.info("A network error occured while loading a "+e.type+"-type playlist");var l,u,d=this.getInternalLoader(e);switch(e.type){case I.MANIFEST:l=a?D.ErrorDetails.MANIFEST_LOAD_TIMEOUT:D.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case I.LEVEL:l=a?D.ErrorDetails.LEVEL_LOAD_TIMEOUT:D.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case I.AUDIO_TRACK:l=a?D.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;default:u=!1}d&&(d.abort(),this.resetInternalLoader(e.type));var v={type:D.ErrorTypes.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:d,context:e,networkDetails:t};s&&(v.response=s),this.hls.trigger(h.default.ERROR,v)},i._handlePlaylistLoaded=function(e,t,a,s){var l=a.type,u=a.level,d=a.id,v=a.levelDetails;if(!v||!v.targetduration){this._handleManifestParsingError(e,a,"invalid target duration",s);return}var p=n.canHaveQualityLevels(a.type);if(p)this.hls.trigger(h.default.LEVEL_LOADED,{details:v,level:u||0,id:d||0,stats:t,networkDetails:s});else switch(l){case I.AUDIO_TRACK:this.hls.trigger(h.default.AUDIO_TRACK_LOADED,{details:v,id:d,stats:t,networkDetails:s});break;case I.SUBTITLE_TRACK:this.hls.trigger(h.default.SUBTITLE_TRACK_LOADED,{details:v,id:d,stats:t,networkDetails:s});break}},n}(_),nt=rt;function pt(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var bt=function(o){pt(n,o);function n(r){var e;return e=o.call(this,r,h.default.FRAG_LOADING)||this,e.loaders={},e}var i=n.prototype;return i.destroy=function(){var e=this.loaders;for(var t in e){var a=e[t];a&&a.destroy()}this.loaders={},o.prototype.destroy.call(this)},i.onFragLoading=function(e){var t=e.frag,a=t.type,s=this.loaders,l=this.hls.config,u=l.fLoader,d=l.loader;t.loaded=0;var v=s[a];v&&(c.logger.warn("abort previous fragment loader for type: "+a),v.abort()),v=s[a]=t.loader=l.fLoader?new u(l):new d(l);var p,R,F;p={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var K=t.byteRangeStartOffset,X=t.byteRangeEndOffset;Object(ee.isFiniteNumber)(K)&&Object(ee.isFiniteNumber)(X)&&(p.rangeStart=K,p.rangeEnd=X),R={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout},F={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},v.load(p,R,F)},i.loadsuccess=function(e,t,a,s){s===void 0&&(s=null);var l=e.data,u=a.frag;u.loader=void 0,this.loaders[u.type]=void 0,this.hls.trigger(h.default.FRAG_LOADED,{payload:l,frag:u,stats:t,networkDetails:s})},i.loaderror=function(e,t,a){a===void 0&&(a=null);var s=t.frag,l=s.loader;l&&l.abort(),this.loaders[s.type]=void 0,this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:a})},i.loadtimeout=function(e,t,a){a===void 0&&(a=null);var s=t.frag,l=s.loader;l&&l.abort(),this.loaders[s.type]=void 0,this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:a})},i.loadprogress=function(e,t,a,s){s===void 0&&(s=null);var l=t.frag;l.loaded=e.loaded,this.hls.trigger(h.default.FRAG_LOAD_PROGRESS,{frag:l,stats:e,networkDetails:s})},n}(_),Je=bt;function Tt(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var ze=function(o){Tt(n,o);function n(r){var e;return e=o.call(this,r,h.default.KEY_LOADING)||this,e.loaders={},e.decryptkey=null,e.decrypturl=null,e}var i=n.prototype;return i.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},o.prototype.destroy.call(this)},i.onKeyLoading=function(e){var t=e.frag,a=t.type,s=this.loaders[a];if(!t.decryptdata){c.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var l=t.decryptdata.uri;if(l!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(s&&(c.logger.warn("abort previous key loader for type:"+a),s.abort()),!l){c.logger.warn("key uri is falsy");return}t.loader=this.loaders[a]=new u.loader(u),this.decrypturl=l,this.decryptkey=null;var d={url:l,frag:t,responseType:"arraybuffer"},v={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout},p={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.loader.load(d,v,p)}else this.decryptkey&&(t.decryptdata.key=this.decryptkey,this.hls.trigger(h.default.KEY_LOADED,{frag:t}))},i.loadsuccess=function(e,t,a){var s=a.frag;if(!s.decryptdata){c.logger.error("after key load, decryptdata unset");return}this.decryptkey=s.decryptdata.key=new Uint8Array(e.data),s.loader=void 0,delete this.loaders[s.type],this.hls.trigger(h.default.KEY_LOADED,{frag:s})},i.loaderror=function(e,t){var a=t.frag,s=a.loader;s&&s.abort(),delete this.loaders[a.type],this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:a,response:e})},i.loadtimeout=function(e,t){var a=t.frag,s=a.loader;s&&s.abort(),delete this.loaders[a.type],this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:a})},n}(_),Lt=ze;function st(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Ye={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},ir=function(o){st(n,o);function n(r){var e;return e=o.call(this,r,h.default.BUFFER_APPENDED,h.default.FRAG_BUFFERED,h.default.FRAG_LOADED)||this,e.bufferPadding=.2,e.fragments=Object.create(null),e.timeRanges=Object.create(null),e.config=r.config,e}var i=n.prototype;return i.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,_.prototype.destroy.call(this),o.prototype.destroy.call(this)},i.getBufferedFrag=function(e,t){var a=this.fragments,s=Object.keys(a).filter(function(u){var d=a[u];if(d.body.type!==t||!d.buffered)return!1;var v=d.body;return v.startPTS<=e&&e<=v.endPTS});if(s.length===0)return null;var l=s.pop();return a[l].body},i.detectEvictedFragments=function(e,t){var a=this;Object.keys(this.fragments).forEach(function(s){var l=a.fragments[s];if(!(!l||!l.buffered)){var u=l.range[e];if(!!u)for(var d=u.time,v=0;v<d.length;v++){var p=d[v];if(!a.isTimeBuffered(p.startPTS,p.endPTS,t)){a.removeFragment(l.body);break}}}})},i.detectPartialFragments=function(e){var t=this,a=this.getFragmentKey(e),s=this.fragments[a];s&&(s.buffered=!0,Object.keys(this.timeRanges).forEach(function(l){if(e.hasElementaryStream(l)){var u=t.timeRanges[l];s.range[l]=t.getBufferedTimes(e.startPTS,e.endPTS,u)}}))},i.getBufferedTimes=function(e,t,a){for(var s=[],l,u,d=!1,v=0;v<a.length;v++)if(l=a.start(v)-this.bufferPadding,u=a.end(v)+this.bufferPadding,e>=l&&t<=u){s.push({startPTS:Math.max(e,a.start(v)),endPTS:Math.min(t,a.end(v))});break}else if(e<u&&t>l)s.push({startPTS:Math.max(e,a.start(v)),endPTS:Math.min(t,a.end(v))}),d=!0;else if(t<=l)break;return{time:s,partial:d}},i.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},i.getPartialFragment=function(e){var t=this,a,s,l,u=null,d=0;return Object.keys(this.fragments).forEach(function(v){var p=t.fragments[v];t.isPartial(p)&&(s=p.body.startPTS-t.bufferPadding,l=p.body.endPTS+t.bufferPadding,e>=s&&e<=l&&(a=Math.min(e-s,l-e),d<=a&&(u=p.body,d=a)))}),u},i.getState=function(e){var t=this.getFragmentKey(e),a=this.fragments[t],s=Ye.NOT_LOADED;return a!==void 0&&(a.buffered?this.isPartial(a)===!0?s=Ye.PARTIAL:s=Ye.OK:s=Ye.APPENDING),s},i.isPartial=function(e){return e.buffered===!0&&(e.range.video!==void 0&&e.range.video.partial===!0||e.range.audio!==void 0&&e.range.audio.partial===!0)},i.isTimeBuffered=function(e,t,a){for(var s,l,u=0;u<a.length;u++){if(s=a.start(u)-this.bufferPadding,l=a.end(u)+this.bufferPadding,e>=s&&t<=l)return!0;if(t<=s)return!1}return!1},i.onFragLoaded=function(e){var t=e.frag;!Object(ee.isFiniteNumber)(t.sn)||t.bitrateTest||(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},i.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(a){var s=t.timeRanges[a];t.detectEvictedFragments(a,s)})},i.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},i.hasFragment=function(e){var t=this.getFragmentKey(e);return this.fragments[t]!==void 0},i.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},i.removeAllFragments=function(){this.fragments=Object.create(null)},n}(_),y={search:function(n,i){for(var r=0,e=n.length-1,t=null,a=null;r<=e;){t=(r+e)/2|0,a=n[t];var s=i(a);if(s>0)r=t+1;else if(s<0)e=t-1;else return a}return null}},L=y,x=function(){function o(){}return o.isBuffered=function(i,r){try{if(i){for(var e=i.buffered,t=0;t<e.length;t++)if(r>=e.start(t)&&r<=e.end(t))return!0}}catch{}return!1},o.bufferInfo=function(i,r,e){try{if(i){var t=i.buffered,a=[],s;for(s=0;s<t.length;s++)a.push({start:t.start(s),end:t.end(s)});return this.bufferedInfo(a,r,e)}}catch{}return{len:0,start:r,end:r,nextStart:void 0}},o.bufferedInfo=function(i,r,e){i.sort(function(X,ne){var te=X.start-ne.start;return te||ne.end-X.end});var t=[];if(e)for(var a=0;a<i.length;a++){var s=t.length;if(s){var l=t[s-1].end;i[a].start-l<e?i[a].end>l&&(t[s-1].end=i[a].end):t.push(i[a])}else t.push(i[a])}else t=i;for(var u=0,d,v=r,p=r,R=0;R<t.length;R++){var F=t[R].start,K=t[R].end;if(r+e>=F&&r<K)v=F,p=K,u=p-r;else if(r+e<F){d=F;break}}return{len:u,start:v,end:p,nextStart:d}},o}(),f=j("./node_modules/eventemitter3/index.js"),g=j("./node_modules/webworkify-webpack/index.js"),m=j("./src/demux/demuxer-inline.js");function E(){return window.MediaSource||window.WebKitMediaSource}var A=j("./src/utils/get-self-scope.js");function b(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var O=function(o){b(n,o);function n(){return o.apply(this,arguments)||this}var i=n.prototype;return i.trigger=function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),s=1;s<t;s++)a[s-1]=arguments[s];this.emit.apply(this,[e,e].concat(a))},n}(f.EventEmitter),U=Object(A.getSelfScope)(),B=E()||{isTypeSupported:function(){return!1}},M=function(){function o(i,r){var e=this;this.hls=i,this.id=r;var t=this.observer=new O,a=i.config,s=function(p,R){R=R||{},R.frag=e.frag,R.id=e.id,i.trigger(p,R)};t.on(h.default.FRAG_DECRYPTED,s),t.on(h.default.FRAG_PARSING_INIT_SEGMENT,s),t.on(h.default.FRAG_PARSING_DATA,s),t.on(h.default.FRAG_PARSED,s),t.on(h.default.ERROR,s),t.on(h.default.FRAG_PARSING_METADATA,s),t.on(h.default.FRAG_PARSING_USERDATA,s),t.on(h.default.INIT_PTS_FOUND,s);var l={mp4:B.isTypeSupported("video/mp4"),mpeg:B.isTypeSupported("audio/mpeg"),mp3:B.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(a.enableWorker&&typeof Worker!="undefined"){c.logger.log("demuxing in webworker");var d;try{d=this.w=g("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(v){i.trigger(h.default.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:v.message+" ("+v.filename+":"+v.lineno+")"}})},d.postMessage({cmd:"init",typeSupported:l,vendor:u,id:r,config:JSON.stringify(a)})}catch(v){c.logger.warn("Error in worker:",v),c.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),d&&U.URL.revokeObjectURL(d.objectURL),this.demuxer=new m.default(t,l,a,u),this.w=void 0}}else this.demuxer=new m.default(t,l,a,u)}var n=o.prototype;return n.destroy=function(){var r=this.w;if(r)r.removeEventListener("message",this.onwmsg),r.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var t=this.observer;t&&(t.removeAllListeners(),this.observer=null)},n.push=function(r,e,t,a,s,l,u,d){var v=this.w,p=Object(ee.isFiniteNumber)(s.startPTS)?s.startPTS:s.start,R=s.decryptdata,F=this.frag,K=!(F&&s.cc===F.cc),X=!(F&&s.level===F.level),ne=F&&s.sn===F.sn+1,te=!X&&ne;if(K&&c.logger.log(this.id+":discontinuity detected"),X&&c.logger.log(this.id+":switch detected"),this.frag=s,v)v.postMessage({cmd:"demux",data:r,decryptdata:R,initSegment:e,audioCodec:t,videoCodec:a,timeOffset:p,discontinuity:K,trackSwitch:X,contiguous:te,duration:l,accurateTimeOffset:u,defaultInitPTS:d},r instanceof ArrayBuffer?[r]:[]);else{var ue=this.demuxer;ue&&ue.push(r,R,e,t,a,p,K,X,te,l,u,d)}},n.onWorkerMessage=function(r){var e=r.data,t=this.hls;switch(e.event){case"init":U.URL.revokeObjectURL(this.w.objectURL);break;case h.default.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,t.trigger(e.event,e.data);break}},o}(),Y=M;function H(o,n,i){switch(n){case"audio":o.audioGroupIds||(o.audioGroupIds=[]),o.audioGroupIds.push(i);break;case"text":o.textGroupIds||(o.textGroupIds=[]),o.textGroupIds.push(i);break}}function Z(o,n,i){var r=o[n],e=o[i],t=e.startPTS;if(Object(ee.isFiniteNumber)(t))i>n?(r.duration=t-r.start,r.duration<0&&c.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(e.duration=r.start-t,e.duration<0&&c.logger.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!"));else if(i>n){var a=r.cc===e.cc;e.start=r.start+(a&&r.minEndPTS?r.minEndPTS-r.start:r.duration)}else e.start=Math.max(r.start-e.duration,0)}function W(o,n,i,r,e,t){var a=i,s=r;if(Object(ee.isFiniteNumber)(n.startPTS)){var l=Math.abs(n.startPTS-i);Object(ee.isFiniteNumber)(n.deltaPTS)?n.deltaPTS=Math.max(l,n.deltaPTS):n.deltaPTS=l,a=Math.max(i,n.startPTS),i=Math.min(i,n.startPTS),s=Math.min(r,n.endPTS),r=Math.max(r,n.endPTS),e=Math.min(e,n.startDTS),t=Math.max(t,n.endDTS)}var u=i-n.start;n.start=n.startPTS=i,n.maxStartPTS=a,n.endPTS=r,n.minEndPTS=s,n.startDTS=e,n.endDTS=t,n.duration=r-i;var d=n.sn;if(!o||d<o.startSN||d>o.endSN)return 0;var v,p,R;for(v=d-o.startSN,p=o.fragments,p[v]=n,R=v;R>0;R--)Z(p,R,R-1);for(R=v;R<p.length-1;R++)Z(p,R,R+1);return o.PTSKnown=!0,u}function se(o,n){n.initSegment&&o.initSegment&&(n.initSegment=o.initSegment);var i=0,r;if(he(o,n,function(a,s){i=a.cc-s.cc,Object(ee.isFiniteNumber)(a.startPTS)&&(s.start=s.startPTS=a.startPTS,s.endPTS=a.endPTS,s.duration=a.duration,s.backtracked=a.backtracked,s.dropped=a.dropped,r=s),n.PTSKnown=!0}),!!n.PTSKnown){if(i){c.logger.log("discontinuity sliding from playlist, take drift into account");for(var e=n.fragments,t=0;t<e.length;t++)e[t].cc+=i}r?W(n,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):Te(o,n),n.PTSKnown=o.PTSKnown}}function ae(o,n,i){i===void 0&&(i=0);var r=-1;he(o,n,function(a,s,l){s.start=a.start,r=l});var e=n.fragments;if(r<0){e.forEach(function(a){a.start+=i});return}for(var t=r+1;t<e.length;t++)e[t].start=e[t-1].start+e[t-1].duration}function he(o,n,i){if(!(!o||!n))for(var r=Math.max(o.startSN,n.startSN)-n.startSN,e=Math.min(o.endSN,n.endSN)-n.startSN,t=n.startSN-o.startSN,a=r;a<=e;a++){var s=o.fragments[t+a],l=n.fragments[a];if(!s||!l)break;i(s,l,a)}}function Te(o,n){var i=n.startSN-o.startSN,r=o.fragments,e=n.fragments;if(!(i<0||i>r.length))for(var t=0;t<e.length;t++)e[t].start+=r[i].start}function ce(o,n,i){var r=1e3*(n.averagetargetduration?n.averagetargetduration:n.targetduration),e=r/2;return o&&n.endSN===o.endSN&&(r=e),i&&(r=Math.max(e,r-(window.performance.now()-i))),Math.round(r)}var we={toString:function(n){for(var i="",r=n.length,e=0;e<r;e++)i+="["+n.start(e).toFixed(3)+","+n.end(e).toFixed(3)+"]";return i}},Ee=we;function me(o,n){for(var i=null,r=0;r<o.length;r+=1){var e=o[r];if(e&&e.cc===n){i=e;break}}return i}function Ae(o,n){return L.search(o,function(i){return i.cc<n?1:i.cc>n?-1:0})}function Le(o,n,i){var r=!1;return n&&n.details&&i&&(i.endCC>i.startCC||o&&o.cc<i.startCC)&&(r=!0),r}function qe(o,n){var i=o.fragments,r=n.fragments;if(!r.length||!i.length){c.logger.log("No fragments to align");return}var e=me(i,r[0].cc);if(!e||e&&!e.startPTS){c.logger.log("No frag in previous level to align on");return}return e}function He(o,n){n.fragments.forEach(function(i){if(i){var r=i.start+o;i.start=i.startPTS=r,i.endPTS=r+i.duration}}),n.PTSKnown=!0}function Fe(o,n,i){et(o,i,n),!i.PTSKnown&&n&&We(i,n.details)}function et(o,n,i){if(Le(o,i,n)){var r=qe(i.details,n);r&&(c.logger.log("Adjusting PTS using last level due to CC increase within current level"),He(r.start,n))}}function We(o,n){if(n&&n.fragments.length){if(!o.hasProgramDateTime||!n.hasProgramDateTime)return;var i=n.fragments[0].programDateTime,r=o.fragments[0].programDateTime,e=(r-i)/1e3+n.fragments[0].start;Object(ee.isFiniteNumber)(e)&&(c.logger.log("adjusting PTS using programDateTime delta, sliding:"+e.toFixed(3)),He(e,o))}}function it(o,n,i){if(n===null||!Array.isArray(o)||!o.length||!Object(ee.isFiniteNumber)(n))return null;var r=o[0].programDateTime;if(n<(r||0))return null;var e=o[o.length-1].endProgramDateTime;if(n>=(e||0))return null;i=i||0;for(var t=0;t<o.length;++t){var a=o[t];if(dt(n,i,a))return a}return null}function Ke(o,n,i,r){i===void 0&&(i=0),r===void 0&&(r=0);var e=null;if(o?e=n[o.sn-n[0].sn+1]:i===0&&n[0].start===0&&(e=n[0]),e&&Oe(i,r,e)===0)return e;var t=L.search(n,Oe.bind(null,i,r));return t||e}function Oe(o,n,i){o===void 0&&(o=0),n===void 0&&(n=0);var r=Math.min(n,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-r<=o?1:i.start-r>o&&i.start?-1:0}function dt(o,n,i){var r=Math.min(n,i.duration+(i.deltaPTS?i.deltaPTS:0))*1e3,e=i.endProgramDateTime||0;return e-r>o}var ht=250,ot=2,Qe=.1,ft=.05,ct=function(){function o(i,r,e,t){this.config=i,this.media=r,this.fragmentTracker=e,this.hls=t,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var n=o.prototype;return n.poll=function(r){var e=this.config,t=this.media,a=this.stalled,s=t.currentTime,l=t.seeking,u=this.seeking&&!l,d=!this.seeking&&l;if(this.seeking=l,s!==r){if(this.moved=!0,a!==null){if(this.stallReported){var v=self.performance.now()-a;c.logger.warn("playback not stuck anymore @"+s+", after "+Math.round(v)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((d||u)&&(this.stalled=null),!(t.paused||t.ended||t.playbackRate===0||!t.buffered.length)){var p=x.bufferInfo(t,s,0),R=p.len>0,F=p.nextStart||0;if(!(!R&&!F)){if(l){var K=p.len>ot,X=!F||F-s>ot&&!this.fragmentTracker.getPartialFragment(s);if(K||X)return;this.moved=!1}if(!this.moved&&this.stalled){var ne=Math.max(F,p.start||0)-s;if(ne>0&&ne<=ot){this._trySkipBufferHole(null);return}}var te=self.performance.now();if(a===null){this.stalled=te;return}var ue=te-a;!l&&ue>=ht&&this._reportStall(p.len);var de=x.bufferInfo(t,s,e.maxBufferHole);this._tryFixBufferStall(de,ue)}}},n._tryFixBufferStall=function(r,e){var t=this.config,a=this.fragmentTracker,s=this.media,l=s.currentTime,u=a.getPartialFragment(l);if(u){var d=this._trySkipBufferHole(u);if(d)return}r.len>t.maxBufferHole&&e>t.highBufferWatchdogPeriod*1e3&&(c.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},n._reportStall=function(r){var e=this.hls,t=this.media,a=this.stallReported;a||(this.stallReported=!0,c.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer (buffer="+r+")"),e.trigger(h.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:r}))},n._trySkipBufferHole=function(r){for(var e=this.config,t=this.hls,a=this.media,s=a.currentTime,l=0,u=0;u<a.buffered.length;u++){var d=a.buffered.start(u);if(s+e.maxBufferHole>=l&&s<d){var v=Math.max(d+ft,a.currentTime+Qe);return c.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+v),this.moved=!0,this.stalled=null,a.currentTime=v,r&&t.trigger(h.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+v,frag:r}),v}l=a.buffered.end(u)}return 0},n._tryNudgeBuffer=function(){var r=this.config,e=this.hls,t=this.media,a=t.currentTime,s=(this.nudgeRetry||0)+1;if(this.nudgeRetry=s,s<r.nudgeMaxRetry){var l=a+s*r.nudgeOffset;c.logger.warn("Nudging 'currentTime' from "+a+" to "+l),t.currentTime=l,e.trigger(h.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else c.logger.error("Playhead still not moving while enough data buffered @"+a+" after "+r.nudgeMaxRetry+" nudges"),e.trigger(h.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},o}();function mt(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function Dt(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var xt=function(o){Dt(n,o);function n(r){for(var e,t=arguments.length,a=new Array(t>1?t-1:0),s=1;s<t;s++)a[s-1]=arguments[s];return e=o.call.apply(o,[this,r].concat(a))||this,e._boundTick=void 0,e._tickTimer=null,e._tickInterval=null,e._tickCallCount=0,e._boundTick=e.tick.bind(mt(e)),e}var i=n.prototype;return i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(e){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,e),!0)},i.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},i.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},i.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},i.doTick=function(){},n}(_);function It(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var k={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},at=function(o){It(n,o);function n(){return o.apply(this,arguments)||this}var i=n.prototype;return i.doTick=function(){},i.startLoad=function(){},i.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=k.STOPPED},i._streamEnded=function(e,t){var a=this.fragCurrent,s=this.fragmentTracker;if(!t.live&&a&&!a.backtracked&&a.sn===t.endSN&&!e.nextStart){var l=s.getState(a);return l===Ye.PARTIAL||l===Ye.OK}return!1},i.onMediaSeeking=function(){var e=this.config,t=this.media,a=this.mediaBuffer,s=this.state,l=t?t.currentTime:null,u=x.bufferInfo(a||t,l,this.config.maxBufferHole);if(c.logger.log("media seeking to "+(Object(ee.isFiniteNumber)(l)?l.toFixed(3):l)),s===k.FRAG_LOADING){var d=this.fragCurrent;if(u.len===0&&d){var v=e.maxFragLookUpTolerance,p=d.start-v,R=d.start+d.duration+v;l<p||l>R?(d.loader&&(c.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),d.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=k.IDLE):c.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else s===k.ENDED&&(u.len===0&&(this.fragPrevious=null,this.fragCurrent=null),this.state=k.IDLE);t&&(this.lastCurrentTime=l),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=l),this.tick()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onHandlerDestroying=function(){this.stopLoad(),o.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=k.STOPPED,this.fragmentTracker=null},i.computeLivePosition=function(e,t){var a=this.config.liveSyncDuration!==void 0?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-a)},n}(xt);function At(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function wt(o,n,i){return n&&At(o.prototype,n),i&&At(o,i),o}function gt(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Gt=100,ar=function(o){gt(n,o);function n(r,e){var t;return t=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.MANIFEST_LOADING,h.default.MANIFEST_PARSED,h.default.LEVEL_LOADED,h.default.LEVELS_UPDATED,h.default.KEY_LOADED,h.default.FRAG_LOADED,h.default.FRAG_LOAD_EMERGENCY_ABORTED,h.default.FRAG_PARSING_INIT_SEGMENT,h.default.FRAG_PARSING_DATA,h.default.FRAG_PARSED,h.default.ERROR,h.default.AUDIO_TRACK_SWITCHING,h.default.AUDIO_TRACK_SWITCHED,h.default.BUFFER_CREATED,h.default.BUFFER_APPENDED,h.default.BUFFER_FLUSHED)||this,t.fragmentTracker=e,t.config=r.config,t.audioCodecSwap=!1,t._state=k.STOPPED,t.stallReported=!1,t.gapController=null,t.altAudio=!1,t.audioOnly=!1,t.bitrateTest=!1,t}var i=n.prototype;return i.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,a=this.hls;if(this.stopLoad(),this.setInterval(Gt),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var s=a.startLevel;s===-1&&(a.config.testBandwidth?(s=0,this.bitrateTest=!0):s=a.nextAutoLevel),this.level=a.nextLoadLevel=s,this.loadedmetadata=!1}t>0&&e===-1&&(c.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=k.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=k.STOPPED},i.stopLoad=function(){this.forceStartLoad=!1,o.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case k.BUFFER_FLUSHING:this.fragLoadError=0;break;case k.IDLE:this._doTickIdle();break;case k.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=k.IDLE);break;case k.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),a=this.retryDate;(!a||t>=a||this.media&&this.media.seeking)&&(c.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=k.IDLE);break}this._checkBuffer(),this._checkFragmentChanged()},i._doTickIdle=function(){var e=this.hls,t=e.config,a=this.media;if(!(this.levelLastLoaded===void 0||!a&&(this.startFragRequested||!t.startFragPrefetch))){if(this.altAudio&&this.audioOnly){this.demuxer.frag=null;return}var s;this.loadedmetadata?s=a.currentTime:s=this.nextLoadPosition;var l=e.nextLoadLevel,u=this.levels[l];if(!!u){var d=u.bitrate,v;d?v=Math.max(8*t.maxBufferSize/d,t.maxBufferLength):v=t.maxBufferLength,v=Math.min(v,t.maxMaxBufferLength);var p=s<t.maxBufferHole?Math.max(ot,t.maxBufferHole):t.maxBufferHole,R=x.bufferInfo(this.mediaBuffer?this.mediaBuffer:a,s,p),F=R.len;if(!(F>=v)){c.logger.trace("buffer length of "+F.toFixed(3)+" is below max of "+v.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=l;var K=u.details;if(!K||K.live&&this.levelLastLoaded!==l){this.state=k.WAITING_LEVEL;return}if(this._streamEnded(R,K)){var X={};this.altAudio&&(X.type="video"),this.hls.trigger(h.default.BUFFER_EOS,X),this.state=k.ENDED;return}this._fetchPayloadOrEos(s,R,K)}}}},i._fetchPayloadOrEos=function(e,t,a){var s=this.fragPrevious;this.level;var l=a.fragments,u=l.length;if(u!==0){var d=l[0].start,v=l[u-1].start+l[u-1].duration,p=t.end,R;if(a.initSegment&&!a.initSegment.data)R=a.initSegment;else if(a.live){var F=this.config.initialLiveManifestSize;if(u<F){c.logger.warn("Can not start playback of a level, reason: not enough fragments "+u+" < "+F);return}if(R=this._ensureFragmentAtLivePoint(a,p,d,v,s,l),R===null)return}else p<d&&(R=l[0]);R||(R=this._findFragment(d,s,u,l,p,v,a)),R&&(R.encrypted?this._loadKey(R,a):this._loadFragment(R,a,e,p))}},i._ensureFragmentAtLivePoint=function(e,t,a,s,l,u){var d=this.hls.config,v=this.media,p,R=1/0;if(d.liveMaxLatencyDuration!==void 0?R=d.liveMaxLatencyDuration:Object(ee.isFiniteNumber)(d.liveMaxLatencyDurationCount)&&(R=d.liveMaxLatencyDurationCount*e.targetduration),t<Math.max(a-d.maxFragLookUpTolerance,s-R)){var F=this.liveSyncPosition=this.computeLivePosition(a,e);t=F,v&&!v.paused&&v.readyState&&v.duration>F&&F>v.currentTime&&(c.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+F.toFixed(3)),v.currentTime=F),this.nextLoadPosition=F}if(e.PTSKnown&&t>s&&v&&v.readyState)return null;if(this.startFragRequested&&!e.PTSKnown&&l)if(e.hasProgramDateTime)c.logger.log("live playlist, switching playlist, load frag with same PDT: "+l.programDateTime),p=it(u,l.endProgramDateTime,d.maxFragLookUpTolerance);else{var K=l.sn+1;if(K>=e.startSN&&K<=e.endSN){var X=u[K-e.startSN];l.cc===X.cc&&(p=X,c.logger.log("live playlist, switching playlist, load frag with next SN: "+p.sn))}p||(p=L.search(u,function(ne){return l.cc-ne.cc}),p&&c.logger.log("live playlist, switching playlist, load frag with same CC: "+p.sn))}return p},i._findFragment=function(e,t,a,s,l,u,d){var v=this.hls.config,p;if(l<u){var R=l>u-v.maxFragLookUpTolerance?0:v.maxFragLookUpTolerance;p=Ke(t,s,l,R)}else p=s[a-1];if(p){var F=p.sn-d.startSN,K=t&&p.level===t.level,X=s[F-1],ne=s[F+1];if(t&&p.sn===t.sn)if(K&&!p.backtracked)if(p.sn<d.endSN){var te=t.deltaPTS;te&&te>v.maxBufferHole&&t.dropped&&F?(p=X,c.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(p=ne,this.fragmentTracker.getState(p)!==Ye.OK&&c.logger.log("Re-loading fragment with SN: "+p.sn))}else p=null;else p.backtracked&&(ne&&ne.backtracked?(c.logger.warn("Already backtracked from fragment "+ne.sn+", will not backtrack to fragment "+p.sn+". Loading fragment "+ne.sn),p=ne):(c.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),p.dropped=0,X?(p=X,p.backtracked=!0):F&&(p=null)))}return p},i._loadKey=function(e,t){c.logger.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level),this.state=k.KEY_LOADING,this.hls.trigger(h.default.KEY_LOADING,{frag:e})},i._loadFragment=function(e,t,a,s){var l=this.fragmentTracker.getState(e);this.fragCurrent=e,e.sn!=="initSegment"&&(this.startFragRequested=!0),Object(ee.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||l===Ye.NOT_LOADED||l===Ye.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,c.logger.log("Loading "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(a.toFixed(3))+", bufferEnd: "+parseFloat(s.toFixed(3))),this.hls.trigger(h.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new Y(this.hls,"main")),this.state=k.FRAG_LOADING):l===Ye.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},i.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,S.MAIN)},i.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},i._checkFragmentChanged=function(){var e,t,a=this.media;if(a&&a.readyState&&a.seeking===!1&&(t=a.currentTime,t>this.lastCurrentTime&&(this.lastCurrentTime=t),x.isBuffered(a,t)?e=this.getBufferedFrag(t):x.isBuffered(a,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var s=e;if(s!==this.fragPlaying){this.hls.trigger(h.default.FRAG_CHANGED,{frag:s});var l=s.level;(!this.fragPlaying||this.fragPlaying.level!==l)&&this.hls.trigger(h.default.LEVEL_SWITCHED,{level:l}),this.fragPlaying=s}}},i.immediateLevelSwitch=function(){if(c.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t;e?(t=e.paused,t||e.pause()):t=!0,this.previouslyPaused=t}var a=this.fragCurrent;a&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,e.currentTime>0&&x.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},i.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,a=this.getBufferedFrag(e.currentTime);if(a&&a.startPTS>1&&this.flushMainBuffer(0,a.startPTS-1),e.paused)t=0;else{var s=this.hls.nextLoadLevel,l=this.levels[s],u=this.fragLastKbps;u&&this.fragCurrent?t=this.fragCurrent.duration*l.bitrate/(1e3*u)+1:t=0}var d=this.getBufferedFrag(e.currentTime+t);if(d){var v=this.followingBufferedFrag(d);if(v){var p=this.fragCurrent;p&&p.loader&&p.loader.abort(),this.fragCurrent=null;var R=Math.max(d.endPTS,v.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,v.duration));this.flushMainBuffer(R,Number.POSITIVE_INFINITY)}}}},i.flushMainBuffer=function(e,t){this.state=k.BUFFER_FLUSHING;var a={startOffset:e,endOffset:t};this.altAudio&&(a.type="video"),this.hls.trigger(h.default.BUFFER_FLUSHING,a)},i.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var a=this.config;this.levels&&a.autoStartLoad&&this.hls.startLoad(a.startPosition),this.gapController=new ct(a,t,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(a){a.details&&a.details.fragments.forEach(function(s){s.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(ee.isFiniteNumber)(t)&&c.logger.log("media seeked to "+t.toFixed(3)),this.tick()},i.onManifestLoading=function(){c.logger.log("trigger BUFFER_RESET"),this.hls.trigger(h.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},i.onManifestParsed=function(e){var t=!1,a=!1,s;e.levels.forEach(function(u){s=u.audioCodec,s&&(s.indexOf("mp4a.40.2")!==-1&&(t=!0),s.indexOf("mp4a.40.5")!==-1&&(a=!0))}),this.audioCodecSwitch=t&&a,this.audioCodecSwitch&&c.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1;var l=this.config;(l.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(l.startPosition)},i.onLevelLoaded=function(e){var t=e.details,a=e.level,s=this.levels[this.levelLastLoaded],l=this.levels[a],u=t.totalduration,d=0;if(c.logger.log("level "+a+" loaded ["+t.startSN+","+t.endSN+"],duration:"+u),t.live||l.details&&l.details.live){var v=l.details;v&&t.fragments.length>0?(se(v,t),d=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(d,v),t.PTSKnown&&Object(ee.isFiniteNumber)(d)?c.logger.log("live playlist sliding:"+d.toFixed(3)):(c.logger.log("live playlist - outdated PTS, unknown sliding"),Fe(this.fragPrevious,s,t))):(c.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,Fe(this.fragPrevious,s,t))}else t.PTSKnown=!1;if(l.details=t,this.levelLastLoaded=a,this.hls.trigger(h.default.LEVEL_UPDATED,{details:t,level:a}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var p=t.startTimeOffset;Object(ee.isFiniteNumber)(p)?(p<0&&(c.logger.log("negative start time offset "+p+", count from end of last fragment"),p=d+u+p),c.logger.log("start time offset found in playlist, adjust startPosition to "+p),this.startPosition=p):t.live?(this.startPosition=this.computeLivePosition(d,t),c.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===k.WAITING_LEVEL&&(this.state=k.IDLE),this.tick()},i.onKeyLoaded=function(){this.state===k.KEY_LOADING&&(this.state=k.IDLE,this.tick())},i.onFragLoaded=function(e){var t=this.fragCurrent,a=this.hls,s=this.levels,l=this.media,u=e.frag;if(this.state===k.FRAG_LOADING&&t&&u.type==="main"&&u.level===t.level&&u.sn===t.sn){var d=e.stats,v=s[t.level],p=v.details;if(this.bitrateTest=!1,this.stats=d,c.logger.log("Loaded "+t.sn+" of ["+p.startSN+" ,"+p.endSN+"],level "+t.level),u.bitrateTest&&a.nextLoadLevel)this.state=k.IDLE,this.startFragRequested=!1,d.tparsed=d.tbuffered=window.performance.now(),a.trigger(h.default.FRAG_BUFFERED,{stats:d,frag:t,id:"main"}),this.tick();else if(u.sn==="initSegment")this.state=k.IDLE,d.tparsed=d.tbuffered=window.performance.now(),p.initSegment.data=e.payload,a.trigger(h.default.FRAG_BUFFERED,{stats:d,frag:t,id:"main"}),this.tick();else{c.logger.log("Parsing "+t.sn+" of ["+p.startSN+" ,"+p.endSN+"],level "+t.level+", cc "+t.cc),this.state=k.PARSING,this.pendingBuffering=!0,this.appended=!1,u.bitrateTest&&(u.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:u}));var R=!(l&&l.seeking)&&(p.PTSKnown||!p.live),F=p.initSegment?p.initSegment.data:[],K=this._getAudioCodec(v),X=this.demuxer=this.demuxer||new Y(this.hls,"main");X.push(e.payload,F,K,v.videoCodec,t,p.totalduration,R)}}this.fragLoadError=0},i.onFragParsingInitSegment=function(e){var t=this.fragCurrent,a=e.frag;if(t&&e.id==="main"&&a.sn===t.sn&&a.level===t.level&&this.state===k.PARSING){var s=e.tracks,l,u;if(this.audioOnly=s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio,u=s.audio,u){var d=this.levels[this.level].audioCodec,v=navigator.userAgent.toLowerCase();d&&this.audioCodecSwap&&(c.logger.log("swapping playlist audio codec"),d.indexOf("mp4a.40.5")!==-1?d="mp4a.40.2":d="mp4a.40.5"),this.audioCodecSwitch&&u.metadata.channelCount!==1&&v.indexOf("firefox")===-1&&(d="mp4a.40.5"),v.indexOf("android")!==-1&&u.container!=="audio/mpeg"&&(d="mp4a.40.2",c.logger.log("Android: force audio codec to "+d)),u.levelCodec=d,u.id=e.id}u=s.video,u&&(u.levelCodec=this.levels[this.level].videoCodec,u.id=e.id),this.hls.trigger(h.default.BUFFER_CODECS,s);for(l in s){u=s[l],c.logger.log("main track:"+l+",container:"+u.container+",codecs[level/parsed]=["+u.levelCodec+"/"+u.codec+"]");var p=u.initSegment;p&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.default.BUFFER_APPENDING,{type:l,data:p,parent:"main",content:"initSegment"}))}this.tick()}},i.onFragParsingData=function(e){var t=this,a=this.fragCurrent,s=e.frag;if(a&&e.id==="main"&&s.sn===a.sn&&s.level===a.level&&!(e.type==="audio"&&this.altAudio)&&this.state===k.PARSING){var l=this.levels[this.level],u=a;if(Object(ee.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+a.duration,e.endDTS=e.startDTS+a.duration),e.hasAudio===!0&&u.addElementaryStream(Q.AUDIO),e.hasVideo===!0&&u.addElementaryStream(Q.VIDEO),c.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),e.type==="video")if(u.dropped=e.dropped,u.dropped)if(u.backtracked)c.logger.warn("Already backtracked on this fragment, appending with the gap",u.sn);else{var d=l.details;if(d&&u.sn===d.startSN)c.logger.warn("missing video frame(s) on first frag, appending with gap",u.sn);else{c.logger.warn("missing video frame(s), backtracking fragment",u.sn),this.fragmentTracker.removeFragment(u),u.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=k.IDLE,this.fragPrevious=u,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.tick();return}}else u.backtracked=!1;var v=W(l.details,u,e.startPTS,e.endPTS,e.startDTS,e.endDTS),p=this.hls;p.trigger(h.default.LEVEL_PTS_UPDATED,{details:l.details,level:this.level,drift:v,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(R){R&&R.length&&t.state===k.PARSING&&(t.appended=!0,t.pendingBuffering=!0,p.trigger(h.default.BUFFER_APPENDING,{type:e.type,data:R,parent:"main",content:"data"}))}),this.tick()}},i.onFragParsed=function(e){var t=this.fragCurrent,a=e.frag;t&&e.id==="main"&&a.sn===t.sn&&a.level===t.level&&this.state===k.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=k.PARSED,this._checkAppendedParsed())},i.onAudioTrackSwitching=function(e){var t=this.altAudio,a=!!e.url,s=e.id;if(!a){if(this.mediaBuffer!==this.media){c.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var l=this.fragCurrent;l.loader&&(c.logger.log("switching to main audio track, cancel main fragment load"),l.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=k.IDLE}var u=this.hls;t&&u.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),u.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:s})}},i.onAudioTrackSwitched=function(e){var t=e.id,a=!!this.hls.audioTracks[t].url;if(a){var s=this.videoBuffer;s&&this.mediaBuffer!==s&&(c.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=a,this.tick()},i.onBufferCreated=function(e){var t=e.tracks,a,s,l=!1;for(var u in t){var d=t[u];d.id==="main"?(s=u,a=d,u==="video"&&(this.videoBuffer=t[u].buffer)):l=!0}l&&a?(c.logger.log("alternate track found, use "+s+".buffered to schedule main fragment loading"),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media},i.onBufferAppended=function(e){if(e.parent==="main"){var t=this.state;(t===k.PARSING||t===k.PARSED)&&(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},i._checkAppendedParsed=function(){if(this.state===k.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;c.logger.log("main buffered : "+Ee.toString(t.buffered)),this.fragPrevious=e;var a=this.stats;a.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*a.total/(a.tbuffered-a.tfirst)),this.hls.trigger(h.default.FRAG_BUFFERED,{stats:a,frag:e,id:"main"}),this.state=k.IDLE}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},i.onError=function(e){var t=e.frag||this.fragCurrent;if(!(t&&t.type!=="main")){var a=!!this.media&&x.isBuffered(this.media,this.media.currentTime)&&x.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var s=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);c.logger.warn("mediaController: frag loading failed, retry in "+s+" ms"),this.retryDate=window.performance.now()+s,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=k.FRAG_LOADING_WAITING_RETRY}else c.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=k.ERROR;break;case D.ErrorDetails.LEVEL_LOAD_ERROR:case D.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==k.ERROR&&(e.fatal?(this.state=k.ERROR,c.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):!e.levelRetry&&this.state===k.WAITING_LEVEL&&(this.state=k.IDLE));break;case D.ErrorDetails.BUFFER_FULL_ERROR:e.parent==="main"&&(this.state===k.PARSING||this.state===k.PARSED)&&(a?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=k.IDLE):(c.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)));break}}},i._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e?(t.maxMaxBufferLength/=2,c.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0):!1},i._checkBuffer=function(){var e=this.media;if(!(!e||e.readyState===0)){var t=this.mediaBuffer?this.mediaBuffer:e,a=t.buffered;!this.loadedmetadata&&a.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,a)}},i.onFragLoadEmergencyAborted=function(){this.state=k.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},i.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;if(e){var t=this.audioOnly?Q.AUDIO:Q.VIDEO;this.fragmentTracker.detectEvictedFragments(t,e.buffered)}this.state=k.IDLE,this.fragPrevious=null},i.onLevelsUpdated=function(e){this.levels=e.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i._seekToStartPos=function(){var e=this.media,t=e.currentTime,a=this.startPosition;if(t!==a&&a>=0){if(e.seeking){c.logger.log("could not seek to "+a+", already seeking at "+t);return}var s=e.buffered.length?e.buffered.start(0):0,l=s-a;l>0&&l<this.config.maxBufferHole&&(c.logger.log("adjusting start position by "+l+" to match buffer start"),a+=l,this.startPosition=a),c.logger.log("seek to target start position "+a+" from current time "+t+". ready state "+e.readyState),e.currentTime=a}},i._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(c.logger.log("swapping playlist audio codec"),t&&(t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5")),t},wt(n,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.logger.log("main stream-controller: "+t+"->"+e),this.hls.trigger(h.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),n}(at),zt=ar;function qt(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function Kt(o,n,i){return n&&qt(o.prototype,n),i&&qt(o,i),o}function Qt(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Ft,nr=function(o){Qt(n,o);function n(r){var e;return e=o.call(this,r,h.default.MANIFEST_LOADED,h.default.LEVEL_LOADED,h.default.AUDIO_TRACK_SWITCHED,h.default.FRAG_LOADED,h.default.ERROR)||this,e.canload=!1,e.currentLevelIndex=null,e.manualLevelIndex=-1,e.timer=null,Ft=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),e}var i=n.prototype;return i.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},i.clearTimer=function(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)},i.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(t){t.loadError=0;var a=t.details;a&&a.live&&(t.details=void 0)}),this.timer!==null&&this.loadLevel()},i.stopLoad=function(){this.canload=!1},i.onManifestLoaded=function(e){var t=[],a=[],s,l={},u=null,d=!1,v=!1;if(e.levels.forEach(function(F){var K=F.attrs;F.loadError=0,F.fragmentError=!1,d=d||!!F.videoCodec,v=v||!!F.audioCodec,Ft&&F.audioCodec&&F.audioCodec.indexOf("mp4a.40.34")!==-1&&(F.audioCodec=void 0),u=l[F.bitrate],u?u.url.push(F.url):(F.url=[F.url],F.urlId=0,l[F.bitrate]=F,t.push(F)),K&&(K.AUDIO&&H(u||F,"audio",K.AUDIO),K.SUBTITLES&&H(u||F,"text",K.SUBTITLES))}),d&&v&&(t=t.filter(function(F){var K=F.videoCodec;return!!K})),t=t.filter(function(F){var K=F.audioCodec,X=F.videoCodec;return(!K||Me(K,"audio"))&&(!X||Me(X,"video"))}),e.audioTracks&&(a=e.audioTracks.filter(function(F){return!F.audioCodec||Me(F.audioCodec,"audio")}),a.forEach(function(F,K){F.id=K})),t.length>0){s=t[0].bitrate,t.sort(function(F,K){return F.bitrate-K.bitrate}),this._levels=t;for(var p=0;p<t.length;p++)if(t[p].bitrate===s){this._firstLevel=p,c.logger.log("manifest loaded,"+t.length+" level(s) found, first bitrate:"+s);break}var R=v&&!d;this.hls.trigger(h.default.MANIFEST_PARSED,{levels:t,audioTracks:a,firstLevel:this._firstLevel,stats:e.stats,audio:v,video:d,altAudio:!R&&a.some(function(F){return!!F.url})})}else this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},i.setLevelInternal=function(e){var t=this._levels,a=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){c.logger.log("switching to level "+e),this.currentLevelIndex=e;var s=t[e];s.level=e,a.trigger(h.default.LEVEL_SWITCHING,s)}var l=t[e],u=l.details;if(!u||u.live){var d=l.urlId;a.trigger(h.default.LEVEL_LOADING,{url:l.url[d],level:e,id:d})}}else a.trigger(h.default.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},i.onError=function(e){if(e.fatal){e.type===D.ErrorTypes.NETWORK_ERROR&&this.clearTimer();return}var t=!1,a=!1,s;switch(e.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:s=e.frag.level,a=!0;break;case D.ErrorDetails.LEVEL_LOAD_ERROR:case D.ErrorDetails.LEVEL_LOAD_TIMEOUT:s=e.context.level,t=!0;break;case D.ErrorDetails.REMUX_ALLOC_ERROR:s=e.level,t=!0;break}s!==void 0&&this.recoverLevel(e,s,t,a)},i.recoverLevel=function(e,t,a,s){var l=this,u=this.hls.config,d=e.details,v=this._levels[t],p,R,F;if(v.loadError++,v.fragmentError=s,a)if(this.levelRetryCount+1<=u.levelLoadingMaxRetry)R=Math.min(Math.pow(2,this.levelRetryCount)*u.levelLoadingRetryDelay,u.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return l.loadLevel()},R),e.levelRetry=!0,this.levelRetryCount++,c.logger.warn("level controller, "+d+", retry in "+R+" ms, current retry count is "+this.levelRetryCount);else{c.logger.error("level controller, cannot recover from "+d+" error"),this.currentLevelIndex=null,this.clearTimer(),e.fatal=!0;return}(a||s)&&(p=v.url.length,p>1&&v.loadError<p?(v.urlId=(v.urlId+1)%p,v.details=void 0,c.logger.warn("level controller, "+d+" for level "+t+": switching to redundant URL-id "+v.urlId)):this.manualLevelIndex===-1?(F=t===0?this._levels.length-1:t-1,c.logger.warn("level controller, "+d+": switch to "+F),this.hls.nextAutoLevel=this.currentLevelIndex=F):s&&(c.logger.warn("level controller, "+d+": reload a fragment"),this.currentLevelIndex=null))},i.onFragLoaded=function(e){var t=e.frag;if(t!==void 0&&t.type==="main"){var a=this._levels[t.level];a!==void 0&&(a.fragmentError=!1,a.loadError=0,this.levelRetryCount=0)}},i.onLevelLoaded=function(e){var t=this,a=e.level,s=e.details;if(a===this.currentLevelIndex){var l=this._levels[a];if(l.fragmentError||(l.loadError=0,this.levelRetryCount=0),s.live){var u=ce(l.details,s,e.stats.trequest);c.logger.log("live playlist, reload in "+Math.round(u)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},u)}else this.clearTimer()}},i.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,a=this.hls.levels[this.currentLevelIndex];if(!!a&&a.audioGroupIds){for(var s=-1,l=0;l<a.audioGroupIds.length;l++)if(a.audioGroupIds[l]===t){s=l;break}s!==a.urlId&&(a.urlId=s,this.startLoad())}},i.loadLevel=function(){if(c.logger.debug("call to loadLevel"),this.currentLevelIndex!==null&&this.canload){var e=this._levels[this.currentLevelIndex];if(typeof e=="object"&&e.url.length>0){var t=this.currentLevelIndex,a=e.urlId,s=e.url[a];c.logger.log("Attempt loading level index "+t+" with URL-id "+a),this.hls.trigger(h.default.LEVEL_LOADING,{url:s,level:t,id:a})}}},i.removeLevel=function(e,t){var a=this.levels.filter(function(s,l){return l!==e?!0:s.url.length>1&&t!==void 0?(s.url=s.url.filter(function(u,d){return d!==t}),s.urlId=0,!0):!1}).map(function(s,l){var u=s.details;return u&&u.fragments&&u.fragments.forEach(function(d){d.level=l}),s});this._levels=a,this.hls.trigger(h.default.LEVELS_UPDATED,{levels:a})},Kt(n,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),(this.currentLevelIndex!==e||!t[e].details)&&this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this._firstLevel}else return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}]),n}(_),jt=j("./src/demux/id3.js");function kt(o,n){var i;try{i=new Event("addtrack")}catch{i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=o,n.dispatchEvent(i)}function Ot(o){if(o!=null&&o.cues)for(;o.cues.length>0;)o.removeCue(o.cues[0])}function $t(o,n){if(n<o[0].endTime)return o[0];if(n>o[o.length-1].endTime)return o[o.length-1];for(var i=0,r=o.length-1;i<=r;){var e=Math.floor((r+i)/2);if(n<o[e].endTime)r=e-1;else if(n>o[e].endTime)i=e+1;else return o[e]}return o[i].endTime-n<n-o[r].endTime?o[i]:o[r]}function Zt(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Pt=.25,Ht=function(o){Zt(n,o);function n(r){var e;return e=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.FRAG_PARSING_METADATA,h.default.LIVE_BACK_BUFFER_REACHED)||this,e.id3Track=void 0,e.media=void 0,e}var i=n.prototype;return i.destroy=function(){_.prototype.destroy.call(this)},i.onMediaAttached=function(e){this.media=e.media,this.media},i.onMediaDetaching=function(){Ot(this.id3Track),this.id3Track=void 0,this.media=void 0},i.getID3Track=function(e){for(var t=0;t<e.length;t++){var a=e[t];if(a.kind==="metadata"&&a.label==="id3")return kt(a,this.media),a}return this.media.addTextTrack("metadata","id3")},i.onFragParsingMetadata=function(e){var t=e.frag,a=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var s=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,l=0;l<a.length;l++){var u=jt.default.getID3Frames(a[l].data);if(u){var d=Math.max(a[l].pts,0),v=l<a.length-1?a[l+1].pts:t.endPTS;v||(v=t.start+t.duration);var p=v-d;p<=0&&(v=d+Pt);for(var R=0;R<u.length;R++){var F=u[R];if(!jt.default.isTimeStampFrame(F)){var K=new s(d,v,"");K.value=F,this.id3Track.addCue(K)}}}}},i.onLiveBackBufferReached=function(e){var t=e.bufferEnd,a=this.id3Track;if(!(!a||!a.cues||!a.cues.length)){var s=$t(a.cues,t);if(!!s)for(;a.cues[0]!==s;)a.removeCue(a.cues[0])}},n}(_),sr=Ht;function or(){var o=E();if(!o)return!1;var n=self.SourceBuffer||self.WebKitSourceBuffer,i=o&&typeof o.isTypeSupported=="function"&&o.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!n||n.prototype&&typeof n.prototype.appendBuffer=="function"&&typeof n.prototype.remove=="function";return!!i&&!!r}var Zr=function(){function o(i){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=i?Math.exp(Math.log(.5)/i):0,this.estimate_=0,this.totalWeight_=0}var n=o.prototype;return n.sample=function(r,e){var t=Math.pow(this.alpha_,r);this.estimate_=e*(1-t)+t*this.estimate_,this.totalWeight_+=r},n.getTotalWeight=function(){return this.totalWeight_},n.getEstimate=function(){if(this.alpha_){var r=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/r}else return this.estimate_},o}(),pr=Zr,Jr=function(){function o(i,r,e,t){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=i,this.defaultEstimate_=t,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new pr(r),this.fast_=new pr(e)}var n=o.prototype;return n.sample=function(r,e){r=Math.max(r,this.minDelayMs_);var t=8*e,a=r/1e3,s=t/a;this.fast_.sample(a,s),this.slow_.sample(a,s)},n.canEstimate=function(){var r=this.fast_;return r&&r.getTotalWeight()>=this.minWeight_},n.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},n.destroy=function(){},o}(),ei=Jr;function mr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function ti(o,n,i){return n&&mr(o.prototype,n),i&&mr(o,i),o}function ri(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function ii(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var ai=window,ni=ai.performance,si=function(o){ii(n,o);function n(r){var e;return e=o.call(this,r,h.default.FRAG_LOADING,h.default.FRAG_LOADED,h.default.FRAG_BUFFERED,h.default.ERROR)||this,e.lastLoadedFragLevel=0,e._nextAutoLevel=-1,e.hls=r,e.timer=null,e._bwEstimator=null,e.onCheck=e._abandonRulesCheck.bind(ri(e)),e}var i=n.prototype;return i.destroy=function(){this.clearTimer(),_.prototype.destroy.call(this)},i.onFragLoading=function(e){var t=e.frag;if(t.type==="main"&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var a=this.hls,s=a.config,l=t.level,u=a.levels[l].details.live,d,v;u?(d=s.abrEwmaFastLive,v=s.abrEwmaSlowLive):(d=s.abrEwmaFastVoD,v=s.abrEwmaSlowVoD),this._bwEstimator=new ei(a,v,d,s.abrEwmaDefaultEstimate)}},i._abandonRulesCheck=function(){var e=this.hls,t=e.media,a=this.fragCurrent;if(!!a){var s=a.loader;if(!s||s.stats&&s.stats.aborted){c.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}var l=s.stats;if(t&&l&&(!t.paused&&t.playbackRate!==0||!t.readyState)&&a.autoLevel&&a.level){var u=ni.now()-l.trequest,d=Math.abs(t.playbackRate);if(u>500*a.duration/d){var v=e.levels,p=Math.max(1,l.bw?l.bw/8:l.loaded*1e3/u),R=v[a.level];if(!R)return;var F=R.realBitrate?Math.max(R.realBitrate,R.bitrate):R.bitrate,K=l.total?l.total:Math.max(l.loaded,Math.round(a.duration*F/8)),X=t.currentTime,ne=(K-l.loaded)/p,te=(x.bufferInfo(t,X,e.config.maxBufferHole).end-X)/d;if(te<2*a.duration/d&&ne>te){var ue=e.minAutoLevel,de,ye;for(ye=a.level-1;ye>ue;ye--){var Ue=v[ye].realBitrate?Math.max(v[ye].realBitrate,v[ye].bitrate):v[ye].bitrate,lt=a.duration*Ue/(8*.8*p);if(lt<te)break}de<ne&&(c.logger.warn("loading too slow, abort fragment loading and switch to level "+ye+":fragLoadedDelay["+ye+"]<fragLoadedDelay["+(a.level-1)+"];bufferStarvationDelay:"+de.toFixed(1)+"<"+ne.toFixed(1)+":"+te.toFixed(1)),e.nextLoadLevel=ye,this._bwEstimator.sample(u,l.loaded),s.abort(),this.clearTimer(),e.trigger(h.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:a,stats:l}))}}}}},i.onFragLoaded=function(e){var t=e.frag;if(t.type==="main"&&Object(ee.isFiniteNumber)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=this.hls.levels[t.level],s=(a.loaded?a.loaded.bytes:0)+e.stats.loaded,l=(a.loaded?a.loaded.duration:0)+e.frag.duration;a.loaded={bytes:s,duration:l},a.realBitrate=Math.round(8*s/l)}if(e.frag.bitrateTest){var u=e.stats;u.tparsed=u.tbuffered=u.tload,this.onFragBuffered(e)}}},i.onFragBuffered=function(e){var t=e.stats,a=e.frag;if(t.aborted!==!0&&a.type==="main"&&Object(ee.isFiniteNumber)(a.sn)&&(!a.bitrateTest||t.tload===t.tbuffered)){var s=t.tparsed-t.trequest;c.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(s,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),a.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},i.onError=function(e){switch(e.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},i.clearTimer=function(){clearInterval(this.timer),this.timer=null},i._findBestLevel=function(e,t,a,s,l,u,d,v,p){for(var R=l;R>=s;R--){var F=p[R];if(!!F){var K=F.details,X=K?K.totalduration/K.fragments.length:t,ne=K?K.live:!1,te=void 0;R<=e?te=d*a:te=v*a;var ue=p[R].realBitrate?Math.max(p[R].realBitrate,p[R].bitrate):p[R].bitrate,de=ue*X/te;if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+R+"/"+Math.round(te)+"/"+ue+"/"+X+"/"+u+"/"+de),te>ue&&(!de||ne&&!this.bitrateTestDelay||de<u))return R}}return-1},ti(n,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(e!==-1&&(!t||!t.canEstimate()))return e;var a=this._nextABRAutoLevel;return e!==-1&&(a=Math.min(e,a)),a},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,a=e.levels,s=e.config,l=e.minAutoLevel,u=e.media,d=this.lastLoadedFragLevel,v=this.fragCurrent?this.fragCurrent.duration:0,p=u?u.currentTime:0,R=u&&u.playbackRate!==0?Math.abs(u.playbackRate):1,F=this._bwEstimator?this._bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,K=(x.bufferInfo(u,p,s.maxBufferHole).end-p)/R,X=this._findBestLevel(d,v,F,l,t,K,s.abrBandWidthFactor,s.abrBandWidthUpFactor,a);if(X>=0)return X;c.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var ne=v?Math.min(v,s.maxStarvationDelay):s.maxStarvationDelay,te=s.abrBandWidthFactor,ue=s.abrBandWidthUpFactor;if(K===0){var de=this.bitrateTestDelay;if(de){var ye=v?Math.min(v,s.maxLoadingDelay):s.maxLoadingDelay;ne=ye-de,c.logger.trace("bitrate test took "+Math.round(1e3*de)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*ne)+" ms"),te=ue=1}}return X=this._findBestLevel(d,v,F,l,t,K+ne,te,ue,a),Math.max(X,0)}}]),n}(_),oi=si;function li(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var xr=E(),ui=function(o){li(n,o);function n(r){var e;return e=o.call(this,r,h.default.MEDIA_ATTACHING,h.default.MEDIA_DETACHING,h.default.MANIFEST_PARSED,h.default.BUFFER_RESET,h.default.BUFFER_APPENDING,h.default.BUFFER_CODECS,h.default.BUFFER_EOS,h.default.BUFFER_FLUSHING,h.default.LEVEL_PTS_UPDATED,h.default.LEVEL_UPDATED)||this,e._msDuration=null,e._levelDuration=null,e._levelTargetDuration=10,e._live=null,e._objectUrl=null,e._needsFlush=!1,e._needsEos=!1,e.config=void 0,e.audioTimestampOffset=void 0,e.bufferCodecEventsExpected=0,e._bufferCodecEventsTotal=0,e.media=null,e.mediaSource=null,e.segments=[],e.parent=void 0,e.appending=!1,e.appended=0,e.appendError=0,e.flushBufferCounter=0,e.tracks={},e.pendingTracks={},e.sourceBuffer={},e.flushRange=[],e._onMediaSourceOpen=function(){c.logger.log("media source opened"),e.hls.trigger(h.default.MEDIA_ATTACHED,{media:e.media});var t=e.mediaSource;t&&t.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},e._onMediaSourceClose=function(){c.logger.log("media source closed")},e._onMediaSourceEnded=function(){c.logger.log("media source ended")},e._onSBUpdateEnd=function(){if(e.audioTimestampOffset&&e.sourceBuffer.audio){var t=e.sourceBuffer.audio;c.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+e.audioTimestampOffset),t.timestampOffset=e.audioTimestampOffset,delete e.audioTimestampOffset}e._needsFlush&&e.doFlush(),e._needsEos&&e.checkEos(),e.appending=!1;var a=e.parent,s=e.segments.reduce(function(p,R){return R.parent===a?p+1:p},0),l={},u=e.sourceBuffer;for(var d in u){var v=u[d];if(!v)throw Error("handling source buffer update end error: source buffer for "+d+" uninitilized and unable to update buffered TimeRanges.");l[d]=v.buffered}e.hls.trigger(h.default.BUFFER_APPENDED,{parent:a,pending:s,timeRanges:l}),e._needsFlush||e.doAppending(),e.updateMediaElementDuration(),s===0&&e.flushLiveBackBuffer()},e._onSBUpdateError=function(t){c.logger.error("sourceBuffer error:",t),e.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},e.config=r.config,e}var i=n.prototype;return i.destroy=function(){_.prototype.destroy.call(this)},i.onLevelPtsUpdated=function(e){var t=e.type,a=this.tracks.audio;if(t==="audio"&&a&&a.container==="audio/mpeg"){var s=this.sourceBuffer.audio;if(!s)throw Error("Level PTS Updated and source buffer for audio uninitalized");var l=Math.abs(s.timestampOffset-e.start);if(l>.1){var u=s.updating;try{s.abort()}catch(d){c.logger.warn("can not abort audio buffer: "+d)}u?this.audioTimestampOffset=e.start:(c.logger.warn("change mpeg audio timestamp offset from "+s.timestampOffset+" to "+e.start),s.timestampOffset=e.start)}}},i.onManifestParsed=function(e){var t=2;(e.audio&&!e.video||!e.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,c.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(e){var t=this.media=e.media;if(t&&xr){var a=this.mediaSource=new xr;a.addEventListener("sourceopen",this._onMediaSourceOpen),a.addEventListener("sourceended",this._onMediaSourceEnded),a.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(a),this._objectUrl=t.src}},i.onMediaDetaching=function(){c.logger.log("media source detaching");var e=this.mediaSource;if(e){if(e.readyState==="open")try{e.endOfStream()}catch(t){c.logger.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):c.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(h.default.MEDIA_DETACHED)},i.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,a=Object.keys(t).length;(a&&!e||a===2)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},i.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var a=e[t];try{a&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(a),a.removeEventListener("updateend",this._onSBUpdateEnd),a.removeEventListener("error",this._onSBUpdateError))}catch{}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach(function(a){t.pendingTracks[a]=e[a]}),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},i.createSourceBuffers=function(e){var t=this.sourceBuffer,a=this.mediaSource;if(!a)throw Error("createSourceBuffers called when mediaSource was null");for(var s in e)if(!t[s]){var l=e[s];if(!l)throw Error("source buffer exists for track "+s+", however track does not");var u=l.levelCodec||l.codec,d=l.container+";codecs="+u;c.logger.log("creating sourceBuffer("+d+")");try{var v=t[s]=a.addSourceBuffer(d);v.addEventListener("updateend",this._onSBUpdateEnd),v.addEventListener("error",this._onSBUpdateError),this.tracks[s]={buffer:v,codec:u,id:l.id,container:l.container,levelCodec:l.levelCodec}}catch(p){c.logger.error("error while trying to add sourceBuffer:"+p.message),this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:p,mimeType:d})}}this.hls.trigger(h.default.BUFFER_CREATED,{tracks:this.tracks})},i.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},i.onBufferEos=function(e){for(var t in this.sourceBuffer)if(!e.type||e.type===t){var a=this.sourceBuffer[t];a&&!a.ended&&(a.ended=!0,c.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},i.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||t.readyState!=="open"){this._needsEos=!1;return}for(var a in e){var s=e[a];if(!!s){if(!s.ended)return;if(s.updating){this._needsEos=!0;return}}}c.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch{c.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},i.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},i.flushLiveBackBuffer=function(){if(!!this._live){var e=this.config.liveBackBufferLength;if(!(!isFinite(e)||e<0)){if(!this.media){c.logger.error("flushLiveBackBuffer called without attaching media");return}for(var t=this.media.currentTime,a=this.sourceBuffer,s=Object.keys(a),l=t-Math.max(e,this._levelTargetDuration),u=s.length-1;u>=0;u--){var d=s[u],v=a[d];if(v){var p=v.buffered;p.length>0&&l>p.start(0)&&this.removeBufferRange(d,v,0,l)&&this.hls.trigger(h.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:l})}}}}},i.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},i.updateMediaElementDuration=function(){var e=this.config,t;if(!(this._levelDuration===null||!this.media||!this.mediaSource||!this.sourceBuffer||this.media.readyState===0||this.mediaSource.readyState!=="open")){for(var a in this.sourceBuffer){var s=this.sourceBuffer[a];if(s&&s.updating===!0)return}t=this.media.duration,this._msDuration===null&&(this._msDuration=this.mediaSource.duration),this._live===!0&&e.liveDurationInfinity===!0?(c.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||!Object(ee.isFiniteNumber)(t))&&(c.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(this.flushBuffer(e.start,e.end,e.type))this.flushRange.shift(),this.flushBufferCounter=0;else{this._needsFlush=!0;return}}if(this.flushRange.length===0){this._needsFlush=!1;var t=0,a=this.sourceBuffer;try{for(var s in a){var l=a[s];l&&(t+=l.buffered.length)}}catch{c.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(h.default.BUFFER_FLUSHED)}},i.doAppending=function(){var e=this.config,t=this.hls,a=this.segments,s=this.sourceBuffer;if(!!Object.keys(s).length){if(!this.media||this.media.error){this.segments=[],c.logger.error("trying to append although a media error occured, flush segment and abort");return}if(!this.appending){var l=a.shift();if(!!l)try{var u=s[l.type];if(!u){this._onSBUpdateEnd();return}if(u.updating){a.unshift(l);return}u.ended=!1,this.parent=l.parent,u.appendBuffer(l.data),this.appendError=0,this.appended++,this.appending=!0}catch(v){c.logger.error("error while trying to append buffer:"+v.message),a.unshift(l);var d={type:D.ErrorTypes.MEDIA_ERROR,parent:l.parent,details:"",fatal:!1};v.code===22?(this.segments=[],d.details=D.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,d.details=D.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(c.logger.log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],d.fatal=!0)),t.trigger(h.default.ERROR,d)}}}},i.flushBuffer=function(e,t,a){var s=this.sourceBuffer;if(!Object.keys(s).length)return!0;var l="null";if(this.media&&(l=this.media.currentTime.toFixed(3)),c.logger.log("flushBuffer,pos/start/end: "+l+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return c.logger.warn("abort flushing too many retries"),!0;var u=s[a];if(u){if(u.ended=!1,u.updating)return c.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(a,u,e,t))return this.flushBufferCounter++,!1}return c.logger.log("buffer flushed"),!0},i.removeBufferRange=function(e,t,a,s){try{for(var l=0;l<t.buffered.length;l++){var u=t.buffered.start(l),d=t.buffered.end(l),v=Math.max(u,a),p=Math.min(d,s);if(Math.min(p,d)-v>.5){var R="null";return this.media&&(R=this.media.currentTime.toString()),c.logger.log("sb remove "+e+" ["+v+","+p+"], of ["+u+","+d+"], pos:"+R),t.remove(v,p),!0}}}catch(F){c.logger.warn("removeBufferRange failed",F)}return!1},n}(_),fi=ui;function yr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function di(o,n,i){return n&&yr(o.prototype,n),i&&yr(o,i),o}function hi(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var ci=function(o){hi(n,o);function n(r){var e;return e=o.call(this,r,h.default.FPS_DROP_LEVEL_CAPPING,h.default.MEDIA_ATTACHING,h.default.MANIFEST_PARSED,h.default.LEVELS_UPDATED,h.default.BUFFER_CODECS,h.default.MEDIA_DETACHING)||this,e.autoLevelCapping=Number.POSITIVE_INFINITY,e.firstLevel=null,e.levels=[],e.media=null,e.restrictedLevels=[],e.timer=null,e.clientRect=null,e}var i=n.prototype;return i.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},i.onFpsDropLevelCapping=function(e){n.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},i.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},i.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},i.onBufferCodecs=function(e){var t=this.hls;t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},i.onLevelsUpdated=function(e){this.levels=e.levels},i.onMediaDetaching=function(){this.stopCapping()},i.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},i.getMaxLevel=function(e){var t=this;if(!this.levels)return-1;var a=this.levels.filter(function(s,l){return n.isLevelAllowed(l,t.restrictedLevels)&&l<=e});return this.clientRect=null,n.getMaxLevelByMediaSize(a,this.mediaWidth,this.mediaHeight)},i.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},i.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},i.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var a=e.getBoundingClientRect();t.width=a.width,t.height=a.height,!t.width&&!t.height&&(t.width=a.right-a.left||e.width||0,t.height=a.bottom-a.top||e.height||0)}return this.clientRect=t,t},n.isLevelAllowed=function(e,t){return t===void 0&&(t=[]),t.indexOf(e)===-1},n.getMaxLevelByMediaSize=function(e,t,a){if(!e||e&&!e.length)return-1;for(var s=function(p,R){return R?p.width!==R.width||p.height!==R.height:!0},l=e.length-1,u=0;u<e.length;u+=1){var d=e[u];if((d.width>=t||d.height>=a)&&s(d,e[u+1])){l=u;break}}return l},di(n,[{key:"mediaWidth",get:function(){return this.getDimensions().width*n.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*n.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch{}return e}}]),n}(_),gi=ci;function vi(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var pi=window,mi=pi.performance,xi=function(o){vi(n,o);function n(r){return o.call(this,r,h.default.MEDIA_ATTACHING)||this}var i=n.prototype;return i.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},i.onMediaAttaching=function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var a=this.video=e.media instanceof window.HTMLVideoElement?e.media:null;typeof a.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}},i.checkFPS=function(e,t,a){var s=mi.now();if(t){if(this.lastTime){var l=s-this.lastTime,u=a-this.lastDroppedFrames,d=t-this.lastDecodedFrames,v=1e3*u/l,p=this.hls;if(p.trigger(h.default.FPS_DROP,{currentDropped:u,currentDecoded:d,totalDroppedFrames:a}),v>0&&u>p.config.fpsDroppedMonitoringThreshold*d){var R=p.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+R),R>0&&(p.autoLevelCapping===-1||p.autoLevelCapping>=R)&&(R=R-1,p.trigger(h.default.FPS_DROP_LEVEL_CAPPING,{level:R,droppedLevel:p.currentLevel}),p.autoLevelCapping=R,p.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=a,this.lastDecodedFrames=t}},i.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},n}(_),yi=xi,Ei=function(){function o(i){i&&i.xhrSetup&&(this.xhrSetup=i.xhrSetup)}var n=o.prototype;return n.destroy=function(){this.abort(),this.loader=null},n.abort=function(){var r=this.loader;r&&r.readyState!==4&&(this.stats.aborted=!0,r.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},n.load=function(r,e,t){this.context=r,this.config=e,this.callbacks=t,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},n.loadInternal=function(){var r,e=this.context;r=this.loader=new window.XMLHttpRequest;var t=this.stats;t.tfirst=0,t.loaded=0;var a=this.xhrSetup;try{if(a)try{a(r,e.url)}catch{r.open("GET",e.url,!0),a(r,e.url)}r.readyState||r.open("GET",e.url,!0)}catch(s){this.callbacks.onError({code:r.status,text:s.message},e,r);return}e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),r.send()},n.readystatechange=function(r){var e=r.currentTarget,t=e.readyState,a=this.stats,s=this.context,l=this.config;if(!a.aborted&&t>=2)if(window.clearTimeout(this.requestTimeout),a.tfirst===0&&(a.tfirst=Math.max(window.performance.now(),a.trequest)),t===4){var u=e.status;if(u>=200&&u<300){a.tload=Math.max(a.tfirst,window.performance.now());var d,v;s.responseType==="arraybuffer"?(d=e.response,v=d.byteLength):(d=e.responseText,v=d.length),a.loaded=a.total=v;var p={url:e.responseURL,data:d};this.callbacks.onSuccess(p,a,s,e)}else a.retry>=l.maxRetry||u>=400&&u<499?(c.logger.error(u+" while loading "+s.url),this.callbacks.onError({code:u,text:e.statusText},s,e)):(c.logger.warn(u+" while loading "+s.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,l.maxRetryDelay),a.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),l.timeout)},n.loadtimeout=function(){c.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},n.loadprogress=function(r){var e=r.currentTarget,t=this.stats;t.loaded=r.loaded,r.lengthComputable&&(t.total=r.total);var a=this.callbacks.onProgress;a&&a(t,this.context,null,e)},o}(),Ti=Ei;function Er(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function Si(o,n,i){return n&&Er(o.prototype,n),i&&Er(o,i),o}function _i(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Ai=function(o){_i(n,o);function n(r){var e;return e=o.call(this,r,h.default.MANIFEST_LOADING,h.default.MANIFEST_PARSED,h.default.AUDIO_TRACK_LOADED,h.default.AUDIO_TRACK_SWITCHED,h.default.LEVEL_LOADED,h.default.ERROR)||this,e._trackId=-1,e._selectDefaultTrack=!0,e.tracks=[],e.trackIdBlacklist=Object.create(null),e.audioGroupId=null,e}var i=n.prototype;return i.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},i.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(h.default.AUDIO_TRACKS_UPDATED,{audioTracks:t}),this._selectAudioGroup(this.hls.nextLoadLevel)},i.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length){c.logger.warn("Invalid audio track id:",e.id);return}if(c.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=e.details.targetduration*1e3;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()},i.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},i.onLevelLoaded=function(e){this._selectAudioGroup(e.level)},i.onError=function(e){e.type===D.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(c.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},i._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details){c.logger.debug("Same id as current audio-track passed, and track details available -> no-op");return}if(e<0||e>=this.tracks.length){c.logger.warn("Invalid id passed to audio-track controller");return}var t=this.tracks[e];c.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var a=t.url,s=t.type,l=t.id;this.hls.trigger(h.default.AUDIO_TRACK_SWITCHING,{id:l,type:s,url:a}),this._loadTrackDetailsIfNeeded(t)},i.doTick=function(){this._updateTrack(this._trackId)},i._selectAudioGroup=function(e){var t=this.hls.levels[e];if(!(!t||!t.audioGroupIds)){var a=t.audioGroupIds[t.urlId];this.audioGroupId!==a&&(this.audioGroupId=a,this._selectInitialAudioTrack())}},i._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(!!t.length){var a=this.tracks[this._trackId],s=null;if(a&&(s=a.name),this._selectDefaultTrack){var l=t.filter(function(v){return v.default});l.length?t=l:c.logger.warn("No default audio tracks defined")}var u=!1,d=function(){t.forEach(function(p){u||(!e.audioGroupId||p.groupId===e.audioGroupId)&&(!s||s===p.name)&&(e._setAudioTrack(p.id),u=!0)})};d(),u||(s=null,d()),u||(c.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},i._needsTrackLoading=function(e){var t=e.details,a=e.url;return!t||t.live?!!a:!1},i._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,a=e.id;c.logger.log("loading audio-track playlist for id: "+a),this.hls.trigger(h.default.AUDIO_TRACK_LOADING,{url:t,id:a})}},i._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,c.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},i._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],a=t.name,s=t.language,l=t.groupId;c.logger.warn("Loading failed on audio track id: "+e+", group-id: "+l+', name/language: "'+a+'" / "'+s+'"');for(var u=e,d=0;d<this.tracks.length;d++)if(!this.trackIdBlacklist[d]){var v=this.tracks[d];if(v.name===a){u=d;break}}if(u===e){c.logger.warn('No fallback audio-track found for name/language: "'+a+'" / "'+s+'"');return}c.logger.log("Attempting audio-track fallback id:",u,"group-id:",this.tracks[u].groupId),this._setAudioTrack(u)},Si(n,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}]),n}(xt),Ri=Ai;function Tr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function bi(o,n,i){return n&&Tr(o.prototype,n),i&&Tr(o,i),o}function Li(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Di=window,Wt=Di.performance,Sr=100,Ii=function(o){Li(n,o);function n(r,e){var t;return t=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.AUDIO_TRACKS_UPDATED,h.default.AUDIO_TRACK_SWITCHING,h.default.AUDIO_TRACK_LOADED,h.default.KEY_LOADED,h.default.FRAG_LOADED,h.default.FRAG_PARSING_INIT_SEGMENT,h.default.FRAG_PARSING_DATA,h.default.FRAG_PARSED,h.default.ERROR,h.default.BUFFER_RESET,h.default.BUFFER_CREATED,h.default.BUFFER_APPENDED,h.default.BUFFER_FLUSHED,h.default.INIT_PTS_FOUND)||this,t.fragmentTracker=e,t.config=r.config,t.audioCodecSwap=!1,t._state=k.STOPPED,t.initPTS=[],t.waitingFragment=null,t.videoTrackCC=null,t.waitingVideoCC=null,t}var i=n.prototype;return i.onInitPtsFound=function(e){var t=e.id,a=e.frag.cc,s=e.initPTS;t==="main"&&(this.initPTS[a]=s,this.videoTrackCC=a,c.logger.log("InitPTS for cc: "+a+" found from main: "+s),this.state===k.WAITING_INIT_PTS&&this.tick())},i.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(Sr),this.fragLoadError=0,t>0&&e===-1?(c.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=k.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=k.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=k.STOPPED},i.doTick=function(){var e,t,a,s=this.hls,l=s.config;switch(this.state){case k.ERROR:case k.PAUSED:case k.BUFFER_FLUSHING:break;case k.STARTING:this.state=k.WAITING_TRACK,this.loadedmetadata=!1;break;case k.IDLE:var u=this.tracks;if(!u||!this.media&&(this.startFragRequested||!l.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(e=this.nextLoadPosition,e===void 0)break;var d=this.mediaBuffer?this.mediaBuffer:this.media,v=this.videoBuffer?this.videoBuffer:this.media,p=e<l.maxBufferHole?Math.max(ot,l.maxBufferHole):l.maxBufferHole,R=x.bufferInfo(d,e,p),F=x.bufferInfo(v,e,p),K=R.len,X=R.end,ne=this.fragPrevious,te=Math.min(l.maxBufferLength,l.maxMaxBufferLength),ue=Math.max(te,F.len),de=this.audioSwitch,ye=this.trackId;if((K<ue||de)&&ye<u.length){if(a=u[ye].details,typeof a=="undefined"){this.state=k.WAITING_TRACK;break}if(!de&&this._streamEnded(R,a)){this.hls.trigger(h.default.BUFFER_EOS,{type:"audio"}),this.state=k.ENDED;return}var Ue=a.fragments,lt=Ue.length,$e=Ue[0].start,_t=Ue[lt-1].start+Ue[lt-1].duration,le;if(de){if(a.live&&!a.PTSKnown)c.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),X=0;else if(X=e,a.PTSKnown&&e<$e)if(R.end>$e||R.nextStart)c.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=$e+.05;else return}if(a.initSegment&&!a.initSegment.data)le=a.initSegment;else if(X<=$e){if(le=Ue[0],this.videoTrackCC!==null&&le.cc!==this.videoTrackCC&&(le=Ae(Ue,this.videoTrackCC)),a.live&&le.loadIdx&&le.loadIdx===this.fragLoadIdx){var pe=R.nextStart?R.nextStart:$e;c.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(pe+.05)),this.media.currentTime=pe+.05;return}}else{var je,Ut=l.maxFragLookUpTolerance,Bt=ne?Ue[ne.sn-Ue[0].sn+1]:void 0;X<_t?(X>_t-Ut&&(Ut=0),Bt&&!Oe(X,Ut,Bt)?je=Bt:je=L.search(Ue,function(_a){return Oe(X,Ut,_a)})):je=Ue[lt-1],je&&(le=je,$e=je.start,ne&&le.level===ne.level&&le.sn===ne.sn&&(le.sn<a.endSN?(le=Ue[le.sn+1-a.startSN],this.fragmentTracker.getState(le)!==Ye.OK&&c.logger.log("SN just loaded, load next one: "+le.sn)):le=null))}le&&(le.encrypted?(c.logger.log("Loading key for "+le.sn+" of ["+a.startSN+" ,"+a.endSN+"],track "+ye),this.state=k.KEY_LOADING,s.trigger(h.default.KEY_LOADING,{frag:le})):(this.fragCurrent=le,(de||this.fragmentTracker.getState(le)===Ye.NOT_LOADED)&&(c.logger.log("Loading "+le.sn+", cc: "+le.cc+" of ["+a.startSN+" ,"+a.endSN+"],track "+ye+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+e+", bufferEnd: "+X.toFixed(3)),le.sn!=="initSegment"&&(this.startFragRequested=!0),Object(ee.isFiniteNumber)(le.sn)&&(this.nextLoadPosition=le.start+le.duration),s.trigger(h.default.FRAG_LOADING,{frag:le}),this.state=k.FRAG_LOADING)))}break;case k.WAITING_TRACK:t=this.tracks[this.trackId],t&&t.details&&(this.state=k.IDLE);break;case k.FRAG_LOADING_WAITING_RETRY:var Vt=Wt.now(),rr=this.retryDate;d=this.media;var Ta=d&&d.seeking;(!rr||Vt>=rr||Ta)&&(c.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=k.IDLE);break;case k.WAITING_INIT_PTS:var Yt=this.waitingFragment;if(Yt){var gr=Yt.frag.cc;if(this.initPTS[gr]!==void 0)this.waitingFragment=null,this.state=k.FRAG_LOADING,this.onFragLoaded(Yt);else if(this.videoTrackCC!==this.waitingVideoCC)c.logger.log("Waiting fragment cc ("+gr+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Xr=x.bufferInfo(this.mediaBuffer,this.media.currentTime,l.maxBufferHole),Sa=Oe(Xr.end,l.maxFragLookUpTolerance,Yt.frag);Sa<0&&(c.logger.log("Waiting fragment cc ("+gr+") @ "+Yt.frag.start+" cancelled because another fragment at "+Xr.end+" is needed"),this.clearWaitingFragment())}}else this.state=k.IDLE;break}},i.clearWaitingFragment=function(){var e=this.waitingFragment;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=k.IDLE)},i.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var a=this.config;this.tracks&&a.autoStartLoad&&this.startLoad(a.startPosition)},i.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onAudioTracksUpdated=function(e){c.logger.log("audio tracks updated"),this.tracks=e.audioTracks},i.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=k.PAUSED,t?this.setInterval(Sr):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=k.IDLE),this.tick()},i.onAudioTrackLoaded=function(e){var t=e.details,a=e.id,s=this.tracks[a],l=s.details,u=t.totalduration,d=0;if(c.logger.log("track "+a+" loaded ["+t.startSN+","+t.endSN+"],duration:"+u),t.live||l&&l.live?l&&t.fragments.length>0?(se(l,t),d=t.fragments[0].start,t.PTSKnown?c.logger.log("live audio playlist sliding:"+d.toFixed(3)):c.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,c.logger.log("live audio playlist - first load, unknown sliding")):t.PTSKnown=!1,s.details=t,!this.startFragRequested){if(this.startPosition===-1){var v=t.startTimeOffset;Object(ee.isFiniteNumber)(v)?(c.logger.log("start time offset found in playlist, adjust startPosition to "+v),this.startPosition=v):t.live?(this.startPosition=this.computeLivePosition(d,t),c.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===k.WAITING_TRACK&&(this.state=k.IDLE),this.tick()},i.onKeyLoaded=function(){this.state===k.KEY_LOADING&&(this.state=k.IDLE,this.tick())},i.onFragLoaded=function(e){var t=this.fragCurrent,a=e.frag;if(this.state===k.FRAG_LOADING&&t&&a.type==="audio"&&a.level===t.level&&a.sn===t.sn){var s=this.tracks[this.trackId],l=s.details,u=l.totalduration,d=t.level,v=t.sn,p=t.cc,R=this.config.defaultAudioCodec||s.audioCodec||"mp4a.40.2",F=this.stats=e.stats;if(v==="initSegment")this.state=k.IDLE,F.tparsed=F.tbuffered=Wt.now(),l.initSegment.data=e.payload,this.hls.trigger(h.default.FRAG_BUFFERED,{stats:F,frag:t,id:"audio"}),this.tick();else{this.state=k.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new Y(this.hls,"audio"));var K=this.initPTS[p],X=l.initSegment?l.initSegment.data:[];if(K!==void 0){this.pendingBuffering=!0,c.logger.log("Demuxing "+v+" of ["+l.startSN+" ,"+l.endSN+"],track "+d);var ne=!1;this.demuxer.push(e.payload,X,R,null,t,u,ne,K)}else c.logger.log("Unknown video PTS for cc "+p+", waiting for video PTS before demuxing audio frag "+v+" of ["+l.startSN+" ,"+l.endSN+"],track "+d),this.waitingFragment=e,this.waitingVideoCC=this.videoTrackCC,this.state=k.WAITING_INIT_PTS}}this.fragLoadError=0},i.onFragParsingInitSegment=function(e){var t=this.fragCurrent,a=e.frag;if(t&&e.id==="audio"&&a.sn===t.sn&&a.level===t.level&&this.state===k.PARSING){var s=e.tracks,l;if(s.video&&delete s.video,l=s.audio,l){l.levelCodec=l.codec,l.id=e.id,this.hls.trigger(h.default.BUFFER_CODECS,s),c.logger.log("audio track:audio,container:"+l.container+",codecs[level/parsed]=["+l.levelCodec+"/"+l.codec+"]");var u=l.initSegment;if(u){var d={type:"audio",data:u,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[d]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.default.BUFFER_APPENDING,d))}this.tick()}}},i.onFragParsingData=function(e){var t=this,a=this.fragCurrent,s=e.frag;if(a&&e.id==="audio"&&e.type==="audio"&&s.sn===a.sn&&s.level===a.level&&this.state===k.PARSING){var l=this.trackId,u=this.tracks[l],d=this.hls;Object(ee.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+a.duration,e.endDTS=e.startDTS+a.duration),a.addElementaryStream(Q.AUDIO),c.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),W(u.details,a,e.startPTS,e.endPTS);var v=this.media,p=!1;if(this.audioSwitch)if(v&&v.readyState){var R=v.currentTime;c.logger.log("switching audio track : currentTime:"+R),R>=e.startPTS&&(c.logger.log("switching audio track : flushing all audio"),this.state=k.BUFFER_FLUSHING,d.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),p=!0,this.audioSwitch=!1,d.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:l}))}else this.audioSwitch=!1,d.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:l});var F=this.pendingData;if(!F){c.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),d.trigger(h.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});return}this.audioSwitch||([e.data1,e.data2].forEach(function(K){K&&K.length&&F.push({type:e.type,data:K,parent:"audio",content:"data"})}),!p&&F.length&&(F.forEach(function(K){t.state===k.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(h.default.BUFFER_APPENDING,K))}),this.pendingData=[],this.appended=!0)),this.tick()}},i.onFragParsed=function(e){var t=this.fragCurrent,a=e.frag;t&&e.id==="audio"&&a.sn===t.sn&&a.level===t.level&&this.state===k.PARSING&&(this.stats.tparsed=Wt.now(),this.state=k.PARSED,this._checkAppendedParsed())},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},i.onBufferAppended=function(e){if(e.parent==="audio"){var t=this.state;(t===k.PARSING||t===k.PARSED)&&(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},i._checkAppendedParsed=function(){if(this.state===k.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,a=this.hls;if(e){this.fragPrevious=e,t.tbuffered=Wt.now(),a.trigger(h.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var s=this.mediaBuffer?this.mediaBuffer:this.media;s&&c.logger.log("audio buffered : "+Ee.toString(s.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,a.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=k.IDLE}this.tick()}},i.onError=function(e){var t=e.frag;if(!(t&&t.type!=="audio"))switch(e.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:var a=e.frag;if(a&&a.type!=="audio")break;if(!e.fatal){var s=this.fragLoadError;s?s++:s=1;var l=this.config;if(s<=l.fragLoadingMaxRetry){this.fragLoadError=s;var u=Math.min(Math.pow(2,s-1)*l.fragLoadingRetryDelay,l.fragLoadingMaxRetryTimeout);c.logger.warn("AudioStreamController: frag loading failed, retry in "+u+" ms"),this.retryDate=Wt.now()+u,this.state=k.FRAG_LOADING_WAITING_RETRY}else c.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=k.ERROR}break;case D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case D.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==k.ERROR&&(this.state=e.fatal?k.ERROR:k.IDLE,c.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case D.ErrorDetails.BUFFER_FULL_ERROR:if(e.parent==="audio"&&(this.state===k.PARSING||this.state===k.PARSED)){var d=this.mediaBuffer,v=this.media.currentTime,p=d&&x.isBuffered(d,v)&&x.isBuffered(d,v+.5);if(p){var R=this.config;R.maxMaxBufferLength>=R.maxBufferLength&&(R.maxMaxBufferLength/=2,c.logger.warn("AudioStreamController: reduce max buffer length to "+R.maxMaxBufferLength+"s")),this.state=k.IDLE}else c.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=k.BUFFER_FLUSHING,this.hls.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}break}},i.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(c.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach(function(a){e.hls.trigger(h.default.BUFFER_APPENDING,a)}),this.appended=!0,this.pendingData=[],this.state=k.PARSED):(this.state=k.IDLE,this.fragPrevious=null,this.tick())},bi(n,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),n}(at),wi=Ii,_r=function(){if(typeof window!="undefined"&&window.VTTCue)return window.VTTCue;var o="auto",n={"":!0,lr:!0,rl:!0},i={start:!0,middle:!0,end:!0,left:!0,right:!0};function r(s){if(typeof s!="string")return!1;var l=n[s.toLowerCase()];return l?s.toLowerCase():!1}function e(s){if(typeof s!="string")return!1;var l=i[s.toLowerCase()];return l?s.toLowerCase():!1}function t(s){for(var l=1;l<arguments.length;l++){var u=arguments[l];for(var d in u)s[d]=u[d]}return s}function a(s,l,u){var d=this,v={};v.enumerable=!0,d.hasBeenReset=!1;var p="",R=!1,F=s,K=l,X=u,ne=null,te="",ue=!0,de="auto",ye="start",Ue=50,lt="middle",$e=50,_t="middle";Object.defineProperty(d,"id",t({},v,{get:function(){return p},set:function(pe){p=""+pe}})),Object.defineProperty(d,"pauseOnExit",t({},v,{get:function(){return R},set:function(pe){R=!!pe}})),Object.defineProperty(d,"startTime",t({},v,{get:function(){return F},set:function(pe){if(typeof pe!="number")throw new TypeError("Start time must be set to a number.");F=pe,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",t({},v,{get:function(){return K},set:function(pe){if(typeof pe!="number")throw new TypeError("End time must be set to a number.");K=pe,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",t({},v,{get:function(){return X},set:function(pe){X=""+pe,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",t({},v,{get:function(){return ne},set:function(pe){ne=pe,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",t({},v,{get:function(){return te},set:function(pe){var je=r(pe);if(je===!1)throw new SyntaxError("An invalid or illegal string was specified.");te=je,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",t({},v,{get:function(){return ue},set:function(pe){ue=!!pe,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",t({},v,{get:function(){return de},set:function(pe){if(typeof pe!="number"&&pe!==o)throw new SyntaxError("An invalid number or illegal string was specified.");de=pe,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",t({},v,{get:function(){return ye},set:function(pe){var je=e(pe);if(!je)throw new SyntaxError("An invalid or illegal string was specified.");ye=je,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",t({},v,{get:function(){return Ue},set:function(pe){if(pe<0||pe>100)throw new Error("Position must be between 0 and 100.");Ue=pe,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",t({},v,{get:function(){return lt},set:function(pe){var je=e(pe);if(!je)throw new SyntaxError("An invalid or illegal string was specified.");lt=je,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",t({},v,{get:function(){return $e},set:function(pe){if(pe<0||pe>100)throw new Error("Size must be between 0 and 100.");$e=pe,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",t({},v,{get:function(){return _t},set:function(pe){var je=e(pe);if(!je)throw new SyntaxError("An invalid or illegal string was specified.");_t=je,this.hasBeenReset=!0}})),d.displayState=void 0}return a.prototype.getCueAsHTML=function(){var s=window.WebVTT;return s.convertCueToDOMTree(window,this.text)},a}(),Fi=function(){return{decode:function(i){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))}}};function Ar(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Fi,this.regionList=[]}function Oi(o){function n(r,e,t,a){return(r|0)*3600+(e|0)*60+(t|0)+(a|0)/1e3}var i=o.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?n(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?n(i[1],i[2],0,i[4]):n(0,i[1],i[2],i[4]):null}function Rr(){this.values=Object.create(null)}Rr.prototype={set:function(n,i){!this.get(n)&&i!==""&&(this.values[n]=i)},get:function(n,i,r){return r?this.has(n)?this.values[n]:i[r]:this.has(n)?this.values[n]:i},has:function(n){return n in this.values},alt:function(n,i,r){for(var e=0;e<r.length;++e)if(i===r[e]){this.set(n,i);break}},integer:function(n,i){/^-?\d+$/.test(i)&&this.set(n,parseInt(i,10))},percent:function(n,i){return i.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(i=parseFloat(i),i>=0&&i<=100)?(this.set(n,i),!0):!1}};function br(o,n,i,r){var e=r?o.split(r):[o];for(var t in e)if(typeof e[t]=="string"){var a=e[t].split(i);if(a.length===2){var s=a[0],l=a[1];n(s,l)}}}var lr=new _r(0,0,0),Jt=lr.align==="middle"?"middle":"center";function Ci(o,n,i){var r=o;function e(){var s=Oi(o);if(s===null)throw new Error("Malformed timestamp: "+r);return o=o.replace(/^[^\sa-zA-Z-]+/,""),s}function t(s,l){var u=new Rr;br(s,function(p,R){switch(p){case"region":for(var F=i.length-1;F>=0;F--)if(i[F].id===R){u.set(p,i[F].region);break}break;case"vertical":u.alt(p,R,["rl","lr"]);break;case"line":var K=R.split(","),X=K[0];u.integer(p,X),u.percent(p,X)&&u.set("snapToLines",!1),u.alt(p,X,["auto"]),K.length===2&&u.alt("lineAlign",K[1],["start",Jt,"end"]);break;case"position":K=R.split(","),u.percent(p,K[0]),K.length===2&&u.alt("positionAlign",K[1],["start",Jt,"end","line-left","line-right","auto"]);break;case"size":u.percent(p,R);break;case"align":u.alt(p,R,["start",Jt,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");var d=u.get("line","auto");d==="auto"&&lr.line===-1&&(d=-1),l.line=d,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",Jt);var v=u.get("position","auto");v==="auto"&&lr.position===50&&(v=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=v}function a(){o=o.replace(/^\s+/,"")}if(a(),n.startTime=e(),a(),o.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);o=o.substr(3),a(),n.endTime=e(),a(),t(o,n)}function Lr(o){return o.replace(/<br(?: \/)?>/gi,`
`)}Ar.prototype={parse:function(n){var i=this;n&&(i.buffer+=i.decoder.decode(n,{stream:!0}));function r(){var u=i.buffer,d=0;for(u=Lr(u);d<u.length&&u[d]!=="\r"&&u[d]!==`
`;)++d;var v=u.substr(0,d);return u[d]==="\r"&&++d,u[d]===`
`&&++d,i.buffer=u.substr(d),v}function e(u){br(u,function(d,v){},/:/)}try{var t;if(i.state==="INITIAL"){if(!/\r\n|\n/.test(i.buffer))return this;t=r();var a=t.match(/^()?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var s=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(s?s=!1:t=r(),i.state){case"HEADER":/:/.test(t)?e(t):t||(i.state="ID");continue;case"NOTE":t||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){i.state="NOTE";break}if(!t)continue;if(i.cue=new _r(0,0,""),i.state="CUE",t.indexOf("-->")===-1){i.cue.id=t;continue}case"CUE":try{Ci(t,i.cue,i.regionList)}catch{i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var l=t.indexOf("-->")!==-1;if(!t||l&&(s=!0)){i.oncue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}i.cue.text&&(i.cue.text+=`
`),i.cue.text+=t;continue;case"BADCUE":t||(i.state="ID");continue}}}catch{i.state==="CUETEXT"&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state=i.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var n=this;try{if(n.buffer+=n.decoder.decode(),(n.cue||n.state==="HEADER")&&(n.buffer+=`

`,n.parse()),n.state==="INITIAL")throw new Error("Malformed WebVTT signature.")}catch(i){throw i}return n.onflush&&n.onflush(),this}};var ki=Ar;function Pi(o,n,i,r){for(var e=[],t,a,s,l,u,d=window.VTTCue||TextTrackCue,v=0;v<r.rows.length;v++)if(t=r.rows[v],s=!0,l=0,u="",!t.isEmpty()){for(var p=0;p<t.chars.length;p++)t.chars[p].uchar.match(/\s/)&&s?l++:(u+=t.chars[p].uchar,s=!1);t.cueStartTime=n,n===i&&(i+=1e-4),a=new d(n,i,Lr(u.trim())),l>=16?l--:l++,navigator.userAgent.match(/Firefox\//)?a.line=v+1:a.line=v>7?v-2:v+1,a.align="left",a.position=Math.max(0,Math.min(100,100*(l/32))),e.push(a),o&&o.addCue(a)}return e}var Dr={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ir=function(n){var i=n;return Dr.hasOwnProperty(n)&&(i=Dr[n]),String.fromCharCode(i)},vt=15,St=100,Mi={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ni={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ui={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Bi={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Gi=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],xe;(function(o){o[o.ERROR=0]="ERROR",o[o.TEXT=1]="TEXT",o[o.WARNING=2]="WARNING",o[o.INFO=2]="INFO",o[o.DEBUG=3]="DEBUG",o[o.DATA=3]="DATA"})(xe||(xe={}));var Ki=function(){function o(){this.time=null,this.verboseLevel=xe.ERROR}var n=o.prototype;return n.log=function(r,e){this.verboseLevel>=r&&c.logger.log(this.time+" ["+r+"] "+e)},o}(),Ct=function(n){for(var i=[],r=0;r<n.length;r++)i.push(n[r].toString(16));return i},wr=function(){function o(i,r,e,t,a){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=i||"white",this.underline=r||!1,this.italics=e||!1,this.background=t||"black",this.flash=a||!1}var n=o.prototype;return n.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},n.setStyles=function(r){for(var e=["foreground","underline","italics","background","flash"],t=0;t<e.length;t++){var a=e[t];r.hasOwnProperty(a)&&(this[a]=r[a])}},n.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},n.equals=function(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash},n.copy=function(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash},n.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},o}(),ji=function(){function o(i,r,e,t,a,s){this.uchar=void 0,this.penState=void 0,this.uchar=i||" ",this.penState=new wr(r,e,t,a,s)}var n=o.prototype;return n.reset=function(){this.uchar=" ",this.penState.reset()},n.setChar=function(r,e){this.uchar=r,this.penState.copy(e)},n.setPenState=function(r){this.penState.copy(r)},n.equals=function(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)},n.copy=function(r){this.uchar=r.uchar,this.penState.copy(r.penState)},n.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},o}(),Hi=function(){function o(i){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var r=0;r<St;r++)this.chars.push(new ji);this.logger=i,this.pos=0,this.currPenState=new wr}var n=o.prototype;return n.equals=function(r){for(var e=!0,t=0;t<St;t++)if(!this.chars[t].equals(r.chars[t])){e=!1;break}return e},n.copy=function(r){for(var e=0;e<St;e++)this.chars[e].copy(r.chars[e])},n.isEmpty=function(){for(var r=!0,e=0;e<St;e++)if(!this.chars[e].isEmpty()){r=!1;break}return r},n.setCursor=function(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(xe.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>St&&(this.logger.log(xe.DEBUG,"Too large cursor position "+this.pos),this.pos=St)},n.moveCursor=function(r){var e=this.pos+r;if(r>1)for(var t=this.pos+1;t<e+1;t++)this.chars[t].setPenState(this.currPenState);this.setCursor(e)},n.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},n.insertChar=function(r){r>=144&&this.backSpace();var e=Ir(r);if(this.pos>=St){this.logger.log(xe.ERROR,"Cannot insert "+r.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)},n.clearFromPos=function(r){var e;for(e=r;e<St;e++)this.chars[e].reset()},n.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},n.clearToEndOfRow=function(){this.clearFromPos(this.pos)},n.getTextString=function(){for(var r=[],e=!0,t=0;t<St;t++){var a=this.chars[t].uchar;a!==" "&&(e=!1),r.push(a)}return e?"":r.join("")},n.setPenStyles=function(r){this.currPenState.setStyles(r);var e=this.chars[this.pos];e.setPenState(this.currPenState)},o}(),ur=function(){function o(i){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var r=0;r<vt;r++)this.rows.push(new Hi(i));this.logger=i,this.currRow=vt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var n=o.prototype;return n.reset=function(){for(var r=0;r<vt;r++)this.rows[r].clear();this.currRow=vt-1},n.equals=function(r){for(var e=!0,t=0;t<vt;t++)if(!this.rows[t].equals(r.rows[t])){e=!1;break}return e},n.copy=function(r){for(var e=0;e<vt;e++)this.rows[e].copy(r.rows[e])},n.isEmpty=function(){for(var r=!0,e=0;e<vt;e++)if(!this.rows[e].isEmpty()){r=!1;break}return r},n.backSpace=function(){var r=this.rows[this.currRow];r.backSpace()},n.clearToEndOfRow=function(){var r=this.rows[this.currRow];r.clearToEndOfRow()},n.insertChar=function(r){var e=this.rows[this.currRow];e.insertChar(r)},n.setPen=function(r){var e=this.rows[this.currRow];e.setPenStyles(r)},n.moveCursor=function(r){var e=this.rows[this.currRow];e.moveCursor(r)},n.setCursor=function(r){this.logger.log(xe.INFO,"setCursor: "+r);var e=this.rows[this.currRow];e.setCursor(r)},n.setPAC=function(r){this.logger.log(xe.INFO,"pacData = "+JSON.stringify(r));var e=r.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var t=0;t<vt;t++)this.rows[t].clear();var a=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var l=s.rows[a].cueStartTime,u=this.logger.time;if(l&&u!==null&&l<u)for(var d=0;d<this.nrRollUpRows;d++)this.rows[e-this.nrRollUpRows+d+1].copy(s.rows[a+d])}}this.currRow=e;var v=this.rows[this.currRow];if(r.indent!==null){var p=r.indent,R=Math.max(p-1,0);v.setCursor(r.indent),r.color=v.chars[R].penState.foreground}var F={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(F)},n.setBkgData=function(r){this.logger.log(xe.INFO,"bkgData = "+JSON.stringify(r)),this.backSpace(),this.setPen(r),this.insertChar(32)},n.setRollUpRows=function(r){this.nrRollUpRows=r},n.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(xe.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(xe.TEXT,this.getDisplayText());var r=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(r,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(xe.INFO,"Rolling up")},n.getDisplayText=function(r){r=r||!1;for(var e=[],t="",a=-1,s=0;s<vt;s++){var l=this.rows[s].getTextString();l&&(a=s+1,r?e.push("Row "+a+": '"+l+"'"):e.push(l.trim()))}return e.length>0&&(r?t="["+e.join(" | ")+"]":t=e.join(`
`)),t},n.getTextAndFormat=function(){return this.rows},o}(),Fr=function(){function o(i,r,e){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=i,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new ur(e),this.nonDisplayedMemory=new ur(e),this.lastOutputScreen=new ur(e),this.currRollUpRow=this.displayedMemory.rows[vt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=e}var n=o.prototype;return n.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[vt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},n.getHandler=function(){return this.outputFilter},n.setHandler=function(r){this.outputFilter=r},n.setPAC=function(r){this.writeScreen.setPAC(r)},n.setBkgData=function(r){this.writeScreen.setBkgData(r)},n.setMode=function(r){r!==this.mode&&(this.mode=r,this.logger.log(xe.INFO,"MODE="+r),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)},n.insertChars=function(r){for(var e=0;e<r.length;e++)this.writeScreen.insertChar(r[e]);var t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(xe.INFO,t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(xe.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},n.ccRCL=function(){this.logger.log(xe.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},n.ccBS=function(){this.logger.log(xe.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},n.ccAOF=function(){},n.ccAON=function(){},n.ccDER=function(){this.logger.log(xe.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},n.ccRU=function(r){this.logger.log(xe.INFO,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)},n.ccFON=function(){this.logger.log(xe.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},n.ccRDC=function(){this.logger.log(xe.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},n.ccTR=function(){this.logger.log(xe.INFO,"TR"),this.setMode("MODE_TEXT")},n.ccRTD=function(){this.logger.log(xe.INFO,"RTD"),this.setMode("MODE_TEXT")},n.ccEDM=function(){this.logger.log(xe.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},n.ccCR=function(){this.logger.log(xe.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},n.ccENM=function(){this.logger.log(xe.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},n.ccEOC=function(){if(this.logger.log(xe.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var r=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=r,this.writeScreen=this.nonDisplayedMemory,this.logger.log(xe.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},n.ccTO=function(r){this.logger.log(xe.INFO,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)},n.ccMIDROW=function(r){var e={flash:!1};if(e.underline=r%2===1,e.italics=r>=46,e.italics)e.foreground="white";else{var t=Math.floor(r/2)-16,a=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=a[t]}this.logger.log(xe.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},n.outputDataUpdate=function(r){r===void 0&&(r=!1);var e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))},n.cueSplitAtTime=function(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))},o}(),Wi=function(){function o(i,r,e){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var t=new Ki;this.channels=[null,new Fr(i,r,t),new Fr(i+1,e,t)],this.cmdHistory=Cr(),this.logger=t}var n=o.prototype;return n.getHandler=function(r){return this.channels[r].getHandler()},n.setHandler=function(r,e){this.channels[r].setHandler(e)},n.addData=function(r,e){var t,a,s,l=!1;this.logger.time=r;for(var u=0;u<e.length;u+=2)if(a=e[u]&127,s=e[u+1]&127,!(a===0&&s===0)){if(this.logger.log(xe.DATA,"["+Ct([e[u],e[u+1]])+"] -> ("+Ct([a,s])+")"),t=this.parseCmd(a,s),t||(t=this.parseMidrow(a,s)),t||(t=this.parsePAC(a,s)),t||(t=this.parseBackgroundAttributes(a,s)),!t&&(l=this.parseChars(a,s),l)){var d=this.currentChannel;if(d&&d>0){var v=this.channels[d];v.insertChars(l)}else this.logger.log(xe.WARNING,"No channel found yet. TEXT-MODE?")}!t&&!l&&this.logger.log(xe.WARNING,"Couldn't parse cleaned data "+Ct([a,s])+" orig: "+Ct([e[u],e[u+1]]))}},n.parseCmd=function(r,e){var t=this.cmdHistory,a=(r===20||r===28||r===21||r===29)&&e>=32&&e<=47,s=(r===23||r===31)&&e>=33&&e<=35;if(!(a||s))return!1;if(Or(r,e,t))return Mt(null,null,t),this.logger.log(xe.DEBUG,"Repeated command ("+Ct([r,e])+") is dropped"),!0;var l=r===20||r===21||r===23?1:2,u=this.channels[l];return r===20||r===21||r===28||r===29?e===32?u.ccRCL():e===33?u.ccBS():e===34?u.ccAOF():e===35?u.ccAON():e===36?u.ccDER():e===37?u.ccRU(2):e===38?u.ccRU(3):e===39?u.ccRU(4):e===40?u.ccFON():e===41?u.ccRDC():e===42?u.ccTR():e===43?u.ccRTD():e===44?u.ccEDM():e===45?u.ccCR():e===46?u.ccENM():e===47&&u.ccEOC():u.ccTO(e-32),Mt(r,e,t),this.currentChannel=l,!0},n.parseMidrow=function(r,e){var t=0;if((r===17||r===25)&&e>=32&&e<=47){if(r===17?t=1:t=2,t!==this.currentChannel)return this.logger.log(xe.ERROR,"Mismatch channel in midrow parsing"),!1;var a=this.channels[t];return a?(a.ccMIDROW(e),this.logger.log(xe.DEBUG,"MIDROW ("+Ct([r,e])+")"),!0):!1}return!1},n.parsePAC=function(r,e){var t,a=this.cmdHistory,s=(r>=17&&r<=23||r>=25&&r<=31)&&e>=64&&e<=127,l=(r===16||r===24)&&e>=64&&e<=95;if(!(s||l))return!1;if(Or(r,e,a))return Mt(null,null,a),!0;var u=r<=23?1:2;e>=64&&e<=95?t=u===1?Mi[r]:Ui[r]:t=u===1?Ni[r]:Bi[r];var d=this.channels[u];return d?(d.setPAC(this.interpretPAC(t,e)),Mt(r,e,a),this.currentChannel=u,!0):!1},n.interpretPAC=function(r,e){var t=e,a={color:null,italics:!1,indent:null,underline:!1,row:r};return e>95?t=e-96:t=e-64,a.underline=(t&1)===1,t<=13?a.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(t/2)]:t<=15?(a.italics=!0,a.color="white"):a.indent=Math.floor((t-16)/2)*4,a},n.parseChars=function(r,e){var t,a=null,s=null;if(r>=25?(t=2,s=r-8):(t=1,s=r),s>=17&&s<=19){var l=e;s===17?l=e+80:s===18?l=e+112:l=e+144,this.logger.log(xe.INFO,"Special char '"+Ir(l)+"' in channel "+t),a=[l]}else r>=32&&r<=127&&(a=e===0?[r]:[r,e]);if(a){var u=Ct(a);this.logger.log(xe.DEBUG,"Char codes =  "+u.join(",")),Mt(r,e,this.cmdHistory)}return a},n.parseBackgroundAttributes=function(r,e){var t=(r===16||r===24)&&e>=32&&e<=47,a=(r===23||r===31)&&e>=45&&e<=47;if(!(t||a))return!1;var s,l={};r===16||r===24?(s=Math.floor((e-32)/2),l.background=Gi[s],e%2===1&&(l.background=l.background+"_semi")):e===45?l.background="transparent":(l.foreground="black",e===47&&(l.underline=!0));var u=r<=23?1:2,d=this.channels[u];return d.setBkgData(l),Mt(r,e,this.cmdHistory),!0},n.reset=function(){for(var r=0;r<Object.keys(this.channels).length;r++){var e=this.channels[r];e&&e.reset()}this.cmdHistory=Cr()},n.cueSplitAtTime=function(r){for(var e=0;e<this.channels.length;e++){var t=this.channels[e];t&&t.cueSplitAtTime(r)}},o}();function Mt(o,n,i){i.a=o,i.b=n}function Or(o,n,i){return i.a===o&&i.b===n}function Cr(){return{a:null,b:null}}var kr=Wi,er=function(){function o(i,r){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=i,this.trackName=r}var n=o.prototype;return n.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},n.newCue=function(r,e,t){(this.startTime===null||this.startTime>r)&&(this.startTime=r),this.endTime=e,this.screen=t,this.timelineController.createCaptionsTrack(this.trackName)},n.reset=function(){this.cueRanges=[]},o}(),fr=function(n,i,r){return n.substr(r||0,i.length)===i},Vi=function(n){var i=parseInt(n.substr(-3)),r=parseInt(n.substr(-6,2)),e=parseInt(n.substr(-9,2)),t=n.length>9?parseInt(n.substr(0,n.indexOf(":"))):0;if(!Object(ee.isFiniteNumber)(i)||!Object(ee.isFiniteNumber)(r)||!Object(ee.isFiniteNumber)(e)||!Object(ee.isFiniteNumber)(t))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+n);return i+=1e3*r,i+=60*1e3*e,i+=60*60*1e3*t,i},dr=function(n){for(var i=5381,r=n.length;r;)i=i*33^n.charCodeAt(--r);return(i>>>0).toString()},Yi=function(n,i,r){var e=n[i],t=n[e.prevCC];if(!t||!t.new&&e.new){n.ccOffset=n.presentationOffset=e.start,e.new=!1;return}for(;t&&t.new;)n.ccOffset+=e.start-t.start,e.new=!1,e=t,t=n[e.prevCC];n.presentationOffset=r},Xi={parse:function(n,i,r,e,t,a){var s=/\r\n|\n\r|\n|\r/g,l=Object(jt.utf8ArrayToStr)(new Uint8Array(n)).trim().replace(s,`
`).split(`
`),u="00:00.000",d=0,v=0,p=0,R=[],F,K=!0,X=!1,ne=new ki;ne.oncue=function(te){var ue=r[e],de=r.ccOffset;ue&&ue.new&&(v!==void 0?de=r.ccOffset=ue.start:Yi(r,e,p)),p&&(de=p-r.presentationOffset),X&&(te.startTime+=de-v,te.endTime+=de-v),te.id=dr(te.startTime.toString())+dr(te.endTime.toString())+dr(te.text),te.text=decodeURIComponent(encodeURIComponent(te.text)),te.endTime>0&&R.push(te)},ne.onparsingerror=function(te){F=te},ne.onflush=function(){if(F&&a){a(F);return}t(R)},l.forEach(function(te){if(K)if(fr(te,"X-TIMESTAMP-MAP=")){K=!1,X=!0,te.substr(16).split(",").forEach(function(ue){fr(ue,"LOCAL:")?u=ue.substr(6):fr(ue,"MPEGTS:")&&(d=parseInt(ue.substr(7)))});try{i+(r[e].start*9e4||0)<0&&(i+=8589934592),d-=i,v=Vi(u)/1e3,p=d/9e4}catch(ue){X=!1,F=ue}return}else te===""&&(K=!1);ne.parse(te+`
`)}),ne.flush()}},zi=Xi;function tr(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function qi(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Qi=function(o){qi(n,o);function n(r){var e;if(e=o.call(this,r,h.default.MEDIA_ATTACHING,h.default.MEDIA_DETACHING,h.default.FRAG_PARSING_USERDATA,h.default.FRAG_DECRYPTED,h.default.MANIFEST_LOADING,h.default.MANIFEST_LOADED,h.default.FRAG_LOADED,h.default.INIT_PTS_FOUND)||this,e.media=null,e.config=void 0,e.enabled=!0,e.Cues=void 0,e.textTracks=[],e.tracks=[],e.initPTS=[],e.unparsedVttFrags=[],e.captionsTracks={},e.nonNativeCaptionsTracks={},e.captionsProperties=void 0,e.cea608Parser1=void 0,e.cea608Parser2=void 0,e.lastSn=-1,e.prevCC=-1,e.vttCCs=Pr(),e.hls=r,e.config=r.config,e.Cues=r.config.cueHandler,e.captionsProperties={textTrack1:{label:e.config.captionsTextTrack1Label,languageCode:e.config.captionsTextTrack1LanguageCode},textTrack2:{label:e.config.captionsTextTrack2Label,languageCode:e.config.captionsTextTrack2LanguageCode},textTrack3:{label:e.config.captionsTextTrack3Label,languageCode:e.config.captionsTextTrack3LanguageCode},textTrack4:{label:e.config.captionsTextTrack4Label,languageCode:e.config.captionsTextTrack4LanguageCode}},e.config.enableCEA708Captions){var t=new er(tr(e),"textTrack1"),a=new er(tr(e),"textTrack2"),s=new er(tr(e),"textTrack3"),l=new er(tr(e),"textTrack4");e.cea608Parser1=new kr(1,t,a),e.cea608Parser2=new kr(3,s,l)}return e}var i=n.prototype;return i.addCues=function(e,t,a,s,l){for(var u=!1,d=l.length;d--;){var v=l[d],p=Zi(v[0],v[1],t,a);if(p>=0&&(v[0]=Math.min(v[0],t),v[1]=Math.max(v[1],a),u=!0,p/(a-t)>.5))return}if(u||l.push([t,a]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[e],t,a,s);else{var R=this.Cues.newCue(null,t,a,s);this.hls.trigger(h.default.CUES_PARSED,{type:"captions",cues:R,track:e})}},i.onInitPtsFound=function(e){var t=this,a=e.frag,s=e.id,l=e.initPTS,u=this.unparsedVttFrags;s==="main"&&(this.initPTS[a.cc]=l),u.length&&(this.unparsedVttFrags=[],u.forEach(function(d){t.onFragLoaded(d)}))},i.getExistingTrack=function(e){var t=this.media;if(t)for(var a=0;a<t.textTracks.length;a++){var s=t.textTracks[a];if(s[e])return s}return null},i.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},i.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,a=this.captionsTracks,s=this.media,l=t[e],u=l.label,d=l.languageCode,v=this.getExistingTrack(e);if(v)a[e]=v,Ot(a[e]),kt(a[e],s);else{var p=this.createTextTrack("captions",u,d);p&&(p[e]=!0,a[e]=p)}}},i.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(!!t){var a=t.label,s={_id:e,label:a,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(h.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}}},i.createTextTrack=function(e,t,a){var s=this.media;if(!!s)return s.addTextTrack(e,t,a)},i.destroy=function(){o.prototype.destroy.call(this)},i.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},i.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){Ot(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=Pr(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},i._cleanTracks=function(){var e=this.media;if(!!e){var t=e.textTracks;if(t)for(var a=0;a<t.length;a++)Ot(t[a])}},i.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var a=e.subtitles||[],s=this.tracks&&a&&this.tracks.length===a.length;if(this.tracks=e.subtitles||[],this.config.renderTextTracksNatively){var l=this.media?this.media.textTracks:[];this.tracks.forEach(function(d,v){var p;if(v<l.length){for(var R=null,F=0;F<l.length;F++)if($i(l[F],d)){R=l[F];break}R&&(p=R)}p||(p=t.createTextTrack("subtitles",d.name,d.lang)),d.default?p.mode=t.hls.subtitleDisplay?"showing":"hidden":p.mode="disabled",t.textTracks.push(p)})}else if(!s&&this.tracks&&this.tracks.length){var u=this.tracks.map(function(d){return{label:d.name,kind:d.type.toLowerCase(),default:d.default,subtitleTrack:d}});this.hls.trigger(h.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(d){var v=/(?:CC|SERVICE)([1-4])/.exec(d.instreamId);if(!!v){var p="textTrack"+v[1],R=t.captionsProperties[p];!R||(R.label=d.name,d.lang&&(R.languageCode=d.lang),R.media=d)}})},i.onFragLoaded=function(e){var t=e.frag,a=e.payload,s=this.cea608Parser1,l=this.cea608Parser2,u=this.initPTS,d=this.lastSn,v=this.unparsedVttFrags;if(t.type==="main"){var p=t.sn;t.sn!==d+1&&s&&l&&(s.reset(),l.reset()),this.lastSn=p}else if(t.type==="subtitle")if(a.byteLength){if(!Object(ee.isFiniteNumber)(u[t.cc])){v.push(e),u.length&&this.hls.trigger(h.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t});return}var R=t.decryptdata;(R==null||R.key==null||R.method!=="AES-128")&&this._parseVTTs(t,a)}else this.hls.trigger(h.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},i._parseVTTs=function(e,t){var a=this,s=this.hls,l=this.prevCC,u=this.textTracks,d=this.vttCCs;d[e.cc]||(d[e.cc]={start:e.start,prevCC:l,new:!0},this.prevCC=e.cc),zi.parse(t,this.initPTS[e.cc],d,e.cc,function(v){if(a.config.renderTextTracksNatively){var p=u[e.level];if(p.mode==="disabled"){s.trigger(h.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});return}v.forEach(function(F){if(!p.cues.getCueById(F.id))try{if(p.addCue(F),!p.cues.getCueById(F.id))throw new Error("addCue is failed for: "+F)}catch(X){c.logger.debug("Failed occurred on adding cues: "+X);var K=new window.TextTrackCue(F.startTime,F.endTime,F.text);K.id=F.id,p.addCue(K)}})}else{var R=a.tracks[e.level].default?"default":"subtitles"+e.level;s.trigger(h.default.CUES_PARSED,{type:"subtitles",cues:v,track:R})}s.trigger(h.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(v){c.logger.log("Failed to parse VTT cue: "+v),s.trigger(h.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},i.onFragDecrypted=function(e){var t=e.frag,a=e.payload;if(t.type==="subtitle"){if(!Object(ee.isFiniteNumber)(this.initPTS[t.cc])){this.unparsedVttFrags.push(e);return}this._parseVTTs(t,a)}},i.onFragParsingUserdata=function(e){var t=this.cea608Parser1,a=this.cea608Parser2;if(!(!this.enabled||!(t&&a)))for(var s=0;s<e.samples.length;s++){var l=e.samples[s].bytes;if(l){var u=this.extractCea608Data(l);t.addData(e.samples[s].pts,u[0]),a.addData(e.samples[s].pts,u[1])}}},i.extractCea608Data=function(e){for(var t=e[0]&31,a=2,s=[[],[]],l=0;l<t;l++){var u=e[a++],d=127&e[a++],v=127&e[a++],p=(4&u)!==0,R=3&u;d===0&&v===0||p&&(R===0||R===1)&&(s[R].push(d),s[R].push(v))}return s},n}(_);function $i(o,n){return o&&o.label===n.name&&!(o.textTrack1||o.textTrack2)}function Zi(o,n,i,r){return Math.min(n,r)-Math.max(o,i)}function Pr(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}var Ji=Qi;function Mr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function ea(o,n,i){return n&&Mr(o.prototype,n),i&&Mr(o,i),o}function ta(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var ra=function(o){ta(n,o);function n(r){var e;return e=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.MANIFEST_LOADED,h.default.SUBTITLE_TRACK_LOADED)||this,e.tracks=[],e.trackId=-1,e.media=null,e.stopped=!0,e.subtitleDisplay=!0,e.queuedDefaultTrack=null,e}var i=n.prototype;return i.destroy=function(){_.prototype.destroy.call(this)},i.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(ee.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},i.onMediaDetaching=function(){if(!!this.media){this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(ee.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack);var e=hr(this.media.textTracks);e.forEach(function(t){Ot(t)}),this.subtitleTrack=-1,this.media=null}},i.onManifestLoaded=function(e){var t=this,a=e.subtitles||[];this.tracks=a,this.hls.trigger(h.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:a}),a.forEach(function(s){s.default&&(t.media?t.subtitleTrack=s.id:t.queuedDefaultTrack=s.id)})},i.onSubtitleTrackLoaded=function(e){var t=this,a=e.id,s=e.details,l=this.trackId,u=this.tracks,d=u[l];if(a>=u.length||a!==l||!d||this.stopped){this._clearReloadTimer();return}if(c.logger.log("subtitle track "+a+" loaded"),s.live){var v=ce(d.details,s,e.stats.trequest);c.logger.log("Reloading live subtitle playlist in "+v+"ms"),this.timer=setTimeout(function(){t._loadCurrentTrack()},v)}else this._clearReloadTimer()},i.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},i.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},i._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},i._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,a=this.hls,s=t[e];e<0||!s||s.details&&!s.details.live||(c.logger.log("Loading subtitle track "+e),a.trigger(h.default.SUBTITLE_TRACK_LOADING,{url:s.url,id:e}))},i._toggleTrackModes=function(e){var t=this.media,a=this.subtitleDisplay,s=this.trackId;if(!!t){var l=hr(t.textTracks);if(e===-1)[].slice.call(l).forEach(function(v){v.mode="disabled"});else{var u=l[s];u&&(u.mode="disabled")}var d=l[e];d&&(d.mode=a?"showing":"hidden")}},i._setSubtitleTrackInternal=function(e){var t=this.hls,a=this.tracks;!Object(ee.isFiniteNumber)(e)||e<-1||e>=a.length||(this.trackId=e,c.logger.log("Switching to subtitle track "+e),t.trigger(h.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},i._onTextTracksChanged=function(){if(!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,t=hr(this.media.textTracks),a=0;a<t.length;a++)if(t[a].mode==="hidden")e=a;else if(t[a].mode==="showing"){e=a;break}this.subtitleTrack=e}},ea(n,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}]),n}(_);function hr(o){for(var n=[],i=0;i<o.length;i++){var r=o[i];r.kind==="subtitles"&&r.label&&n.push(o[i])}return n}var ia=ra,aa=j("./src/crypt/decrypter.js");function na(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function sa(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var oa=window,Nr=oa.performance,cr=500,la=function(o){sa(n,o);function n(r,e){var t;return t=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.ERROR,h.default.KEY_LOADED,h.default.FRAG_LOADED,h.default.SUBTITLE_TRACKS_UPDATED,h.default.SUBTITLE_TRACK_SWITCH,h.default.SUBTITLE_TRACK_LOADED,h.default.SUBTITLE_FRAG_PROCESSED,h.default.LEVEL_UPDATED)||this,t.fragmentTracker=e,t.config=r.config,t.state=k.STOPPED,t.tracks=[],t.tracksBuffered=[],t.currentTrackId=-1,t.decrypter=new aa.default(r,r.config),t.lastAVStart=0,t._onMediaSeeking=t.onMediaSeeking.bind(na(t)),t}var i=n.prototype;return i.startLoad=function(){this.stopLoad(),this.state=k.IDLE;var e=this.tracks[this.currentTrackId];e&&e.details&&(this.setInterval(cr),this.tick())},i.onSubtitleFragProcessed=function(e){var t=e.frag,a=e.success;if(this.fragPrevious=t,this.state=k.IDLE,!!a){var s=this.tracksBuffered[this.currentTrackId];if(!!s){for(var l,u=t.start,d=0;d<s.length;d++)if(u>=s[d].start&&u<=s[d].end){l=s[d];break}var v=t.start+t.duration;l?l.end=v:(l={start:u,end:v},s.push(l))}}},i.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=k.IDLE},i.onMediaDetaching=function(){var e=this;!this.media||(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach(function(t){e.tracksBuffered[t.id]=[]}),this.media=null,this.state=k.STOPPED)},i.onError=function(e){var t=e.frag;!t||t.type!=="subtitle"||(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=k.IDLE)},i.onSubtitleTracksUpdated=function(e){var t=this;c.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(a){t.tracksBuffered[a.id]=[]})},i.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,!this.tracks||!this.tracks.length||this.currentTrackId===-1){this.clearInterval();return}var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(cr)},i.onSubtitleTrackLoaded=function(e){var t=e.id,a=e.details,s=this.currentTrackId,l=this.tracks,u=l[s];t>=l.length||t!==s||!u||(a.live&&ae(u.details,a,this.lastAVStart),u.details=a,this.setInterval(cr))},i.onKeyLoaded=function(){this.state===k.KEY_LOADING&&(this.state=k.IDLE)},i.onFragLoaded=function(e){var t=this.fragCurrent,a=e.frag.decryptdata,s=e.frag,l=this.hls;if(this.state===k.FRAG_LOADING&&t&&e.frag.type==="subtitle"&&t.sn===e.frag.sn&&e.payload.byteLength>0&&a&&a.key&&a.method==="AES-128"){var u=Nr.now();this.decrypter.decrypt(e.payload,a.key.buffer,a.iv.buffer,function(d){var v=Nr.now();l.trigger(h.default.FRAG_DECRYPTED,{frag:s,payload:d,stats:{tstart:u,tdecrypt:v}})})}},i.onLevelUpdated=function(e){var t=e.details,a=t.fragments;this.lastAVStart=a.length?a[0].start:0},i.doTick=function(){if(!this.media){this.state=k.IDLE;return}switch(this.state){case k.IDLE:{var e=this.config,t=this.currentTrackId,a=this.fragmentTracker,s=this.media,l=this.tracks;if(!l||!l[t]||!l[t].details)break;var u=e.maxBufferHole,d=e.maxFragLookUpTolerance,v=Math.min(e.maxBufferLength,e.maxMaxBufferLength),p=x.bufferedInfo(this._getBuffered(),s.currentTime,u),R=p.end,F=p.len,K=l[t].details,X=K.fragments,ne=X.length,te=X[ne-1].start+X[ne-1].duration;if(F>v)return;var ue,de=this.fragPrevious;R<te?(de&&K.hasProgramDateTime&&(ue=it(X,de.endProgramDateTime,d)),ue||(ue=Ke(de,X,R,d))):ue=X[ne-1],ue&&ue.encrypted?(c.logger.log("Loading key for "+ue.sn),this.state=k.KEY_LOADING,this.hls.trigger(h.default.KEY_LOADING,{frag:ue})):ue&&a.getState(ue)===Ye.NOT_LOADED&&(this.fragCurrent=ue,this.state=k.FRAG_LOADING,this.hls.trigger(h.default.FRAG_LOADING,{frag:ue}))}}},i.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,o.prototype.stopLoad.call(this)},i._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},i.onMediaSeeking=function(){if(this.fragCurrent){var e=this.media?this.media.currentTime:0,t=this.config.maxFragLookUpTolerance,a=this.fragCurrent.start-t,s=this.fragCurrent.start+this.fragCurrent.duration+t;(e<a||e>s)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=k.IDLE,this.tick())}},n}(at),Nt;(function(o){o.WIDEVINE="com.widevine.alpha",o.PLAYREADY="com.microsoft.playready"})(Nt||(Nt={}));var ua=function(){return typeof window!="undefined"&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}();function Ur(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function fa(o,n,i){return n&&Ur(o.prototype,n),i&&Ur(o,i),o}function da(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Br=3,ha=function(n,i,r){var e={audioCapabilities:[],videoCapabilities:[]};return n.forEach(function(t){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:r.audioRobustness||""})}),i.forEach(function(t){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:r.videoRobustness||""})}),[e]},ca=function(n,i,r,e){switch(n){case Nt.WIDEVINE:return ha(i,r,e);default:throw new Error("Unknown key-system: "+n)}},ga=function(o){da(n,o);function n(r){var e;return e=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHED,h.default.MANIFEST_PARSED)||this,e._widevineLicenseUrl=void 0,e._licenseXhrSetup=void 0,e._emeEnabled=void 0,e._requestMediaKeySystemAccess=void 0,e._drmSystemOptions=void 0,e._config=void 0,e._mediaKeysList=[],e._media=null,e._hasSetMediaKeys=!1,e._requestLicenseFailureCount=0,e.mediaKeysPromise=null,e._onMediaEncrypted=function(t){if(c.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!e.mediaKeysPromise){c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),e.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var a=function(l){!e._media||(e._attemptSetMediaKeys(l),e._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};e.mediaKeysPromise.then(a).catch(a)},e._config=r.config,e._widevineLicenseUrl=e._config.widevineLicenseUrl,e._licenseXhrSetup=e._config.licenseXhrSetup,e._emeEnabled=e._config.emeEnabled,e._requestMediaKeySystemAccess=e._config.requestMediaKeySystemAccessFunc,e._drmSystemOptions=r.config.drmSystemOptions,e}var i=n.prototype;return i.getLicenseServerUrl=function(e){switch(e){case Nt.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},i._attemptKeySystemAccess=function(e,t,a){var s=this,l=ca(e,t,a,this._drmSystemOptions);c.logger.log("Requesting encrypted media key-system access");var u=this.requestMediaKeySystemAccess(e,l);this.mediaKeysPromise=u.then(function(d){return s._onMediaKeySystemAccessObtained(e,d)}),u.catch(function(d){c.logger.error('Failed to obtain key-system "'+e+'" access:',d)})},i._onMediaKeySystemAccessObtained=function(e,t){var a=this;c.logger.log('Access for key-system "'+e+'" obtained');var s={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(s);var l=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(u){return s.mediaKeys=u,c.logger.log('Media-keys created for key-system "'+e+'"'),a._onMediaKeysCreated(),u});return l.catch(function(u){c.logger.error("Failed to create media-keys:",u)}),l},i._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},i._onNewMediaKeySession=function(e){var t=this;c.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(a){t._onKeySessionMessage(e,a.message)},!1)},i._onKeySessionMessage=function(e,t){c.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(a){c.logger.log("Received license data (length: "+(a&&a.byteLength)+"), updating key-session"),e.update(a)})},i._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys){c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}c.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},i._generateRequestWithPreferredKeySession=function(e,t){var a=this,s=this._mediaKeysList[0];if(!s){c.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(s.mediaKeysSessionInitialized){c.logger.warn("Key-Session already initialized but requested again");return}var l=s.mediaKeysSession;if(!l){c.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!t){c.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}c.logger.log('Generating key-session request for "'+e+'" init data type'),s.mediaKeysSessionInitialized=!0,l.generateRequest(e,t).then(function(){c.logger.debug("Key-session generation succeeded")}).catch(function(u){c.logger.error("Error generating key-session request:",u),a.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},i._createLicenseXhr=function(e,t,a){var s=new XMLHttpRequest,l=this._licenseXhrSetup;try{if(l)try{l(s,e)}catch{s.open("POST",e,!0),l(s,e)}s.readyState||s.open("POST",e,!0)}catch(u){throw new Error("issue setting up KeySystem license XHR "+u)}return s.responseType="arraybuffer",s.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,s,e,t,a),s},i._onLicenseRequestReadyStageChange=function(e,t,a,s){switch(e.readyState){case 4:if(e.status===200)this._requestLicenseFailureCount=0,c.logger.log("License request succeeded"),e.responseType!=="arraybuffer"&&c.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),s(e.response);else{if(c.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>Br){this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var l=Br-this._requestLicenseFailureCount+1;c.logger.warn("Retrying license request, "+l+" attempts left"),this._requestLicense(a,s)}break}},i._generateLicenseRequestChallenge=function(e,t){switch(e.mediaKeySystemDomain){case Nt.WIDEVINE:return t}throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},i._requestLicense=function(e,t){c.logger.log("Requesting content license for key-system");var a=this._mediaKeysList[0];if(!a){c.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var s=this.getLicenseServerUrl(a.mediaKeySystemDomain),l=this._createLicenseXhr(s,e,t);c.logger.log("Sending license request to URL: "+s);var u=this._generateLicenseRequestChallenge(a,e);l.send(u)}catch(d){c.logger.error("Failure requesting DRM license: "+d),this.hls.trigger(h.default.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},i.onMediaAttached=function(e){if(!!this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},i.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;!e||(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(a){if(a.mediaKeysSession)return a.mediaKeysSession.close().catch(function(){})})).then(function(){return e.setMediaKeys(null)}).catch(function(){}))},i.onManifestParsed=function(e){if(!!this._emeEnabled){var t=e.levels.map(function(s){return s.audioCodec}),a=e.levels.map(function(s){return s.videoCodec});this._attemptKeySystemAccess(Nt.WIDEVINE,t,a)}},fa(n,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),n}(_),va=ga;function Gr(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(o);n&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),i.push.apply(i,r)}return i}function Kr(o){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Gr(Object(i),!0).forEach(function(r){pa(o,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Gr(Object(i)).forEach(function(r){Object.defineProperty(o,r,Object.getOwnPropertyDescriptor(i,r))})}return o}function pa(o,n,i){return n in o?Object.defineProperty(o,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[n]=i,o}var ma=Kr(Kr({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ti,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:oi,bufferController:fi,capLevelController:gi,fpsController:yi,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:ua,testBandwidth:!0},xa()),{},{subtitleStreamController:la,subtitleTrackController:ia,timelineController:Ji,audioStreamController:wi,audioTrackController:Ri,emeController:va});function xa(){return{cueHandler:$,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function jr(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(o);n&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),i.push.apply(i,r)}return i}function Hr(o){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?jr(Object(i),!0).forEach(function(r){ya(o,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):jr(Object(i)).forEach(function(r){Object.defineProperty(o,r,Object.getOwnPropertyDescriptor(i,r))})}return o}function ya(o,n,i){return n in o?Object.defineProperty(o,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[n]=i,o}function Xe(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function Wr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function Vr(o,n,i){return n&&Wr(o.prototype,n),i&&Wr(o,i),o}function Ea(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Yr=function(o){Ea(n,o),n.isSupported=function(){return or()},Vr(n,null,[{key:"version",get:function(){return"0.14.17"}},{key:"Events",get:function(){return h.default}},{key:"ErrorTypes",get:function(){return D.ErrorTypes}},{key:"ErrorDetails",get:function(){return D.ErrorDetails}},{key:"DefaultConfig",get:function(){return n.defaultConfig?n.defaultConfig:ma},set:function(e){n.defaultConfig=e}}]);function n(r){var e;r===void 0&&(r={}),e=o.call(this)||this,e.config=void 0,e._autoLevelCapping=void 0,e.abrController=void 0,e.capLevelController=void 0,e.levelController=void 0,e.streamController=void 0,e.networkControllers=void 0,e.audioTrackController=void 0,e.subtitleTrackController=void 0,e.emeController=void 0,e.coreComponents=void 0,e.media=null,e.url=null;var t=n.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");e.config=Hr(Hr({},t),r);var a=Xe(e),s=a.config;if(s.liveMaxLatencyDurationCount!==void 0&&s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(s.liveMaxLatencyDuration!==void 0&&(s.liveSyncDuration===void 0||s.liveMaxLatencyDuration<=s.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(c.enableLogs)(s.debug),e._autoLevelCapping=-1;var l=e.abrController=new s.abrController(Xe(e)),u=new s.bufferController(Xe(e)),d=e.capLevelController=new s.capLevelController(Xe(e)),v=new s.fpsController(Xe(e)),p=new nt(Xe(e)),R=new Je(Xe(e)),F=new Lt(Xe(e)),K=new sr(Xe(e)),X=e.levelController=new nr(Xe(e)),ne=new ir(Xe(e)),te=e.streamController=new zt(Xe(e),ne),ue=[X,te],de=s.audioStreamController;de&&ue.push(new de(Xe(e),ne)),e.networkControllers=ue;var ye=[p,R,F,l,u,d,v,K,ne];if(de=s.audioTrackController,de){var Ue=new de(Xe(e));e.audioTrackController=Ue,ye.push(Ue)}if(de=s.subtitleTrackController,de){var lt=new de(Xe(e));e.subtitleTrackController=lt,ue.push(lt)}if(de=s.emeController,de){var $e=new de(Xe(e));e.emeController=$e,ye.push($e)}return de=s.subtitleStreamController,de&&ue.push(new de(Xe(e),ne)),de=s.timelineController,de&&ye.push(new de(Xe(e))),e.coreComponents=ye,e}var i=n.prototype;return i.destroy=function(){c.logger.log("destroy"),this.trigger(h.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},i.attachMedia=function(e){c.logger.log("attachMedia"),this.media=e,this.trigger(h.default.MEDIA_ATTACHING,{media:e})},i.detachMedia=function(){c.logger.log("detachMedia"),this.trigger(h.default.MEDIA_DETACHING),this.media=null},i.loadSource=function(e){e=V.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),c.logger.log("loadSource:"+e),this.url=e,this.trigger(h.default.MANIFEST_LOADING,{url:e})},i.startLoad=function(e){e===void 0&&(e=-1),c.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},i.stopLoad=function(){c.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},i.swapAudioCodec=function(){c.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){c.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},i.removeLevel=function(e,t){t===void 0&&(t=0),this.levelController.removeLevel(e,t)},Vr(n,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){c.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){c.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){c.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){c.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){c.logger.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){c.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,a=e?e.length:0,s=0;s<a;s++){var l=e[s].realBitrate?Math.max(e[s].realBitrate,e[s].bitrate):e[s].bitrate;if(l>t)return s}return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping,a;return t===-1&&e&&e.length?a=e.length-1:a=t,a}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return e?e.subtitleDisplay:!1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),n}(O);Yr.defaultConfig=void 0},"./src/polyfills/number.js":function(ve,re,j){j.r(re),j.d(re,"isFiniteNumber",function(){return $}),j.d(re,"MAX_SAFE_INTEGER",function(){return V});var $=Number.isFinite||function(D){return typeof D=="number"&&isFinite(D)},V=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":function(ve,re,j){j.r(re),j.d(re,"getSelfScope",function(){return $});function $(){return typeof window=="undefined"?self:window}},"./src/utils/logger.js":function(ve,re,j){j.r(re),j.d(re,"enableLogs",function(){return _}),j.d(re,"logger",function(){return I});var $=j("./src/utils/get-self-scope.js");function V(){}var D={trace:V,debug:V,log:V,warn:V,info:V,error:V},ee=D;function h(S,w){return w="["+S+"] > "+w,w}var c=Object($.getSelfScope)();function q(S){var w=c.console[S];return w?function(){for(var P=arguments.length,C=new Array(P),z=0;z<P;z++)C[z]=arguments[z];C[0]&&(C[0]=h(S,C[0])),w.apply(c.console,C)}:V}function T(S){for(var w=arguments.length,P=new Array(w>1?w-1:0),C=1;C<w;C++)P[C-1]=arguments[C];P.forEach(function(z){ee[z]=S[z]?S[z].bind(S):q(z)})}var _=function(w){if(c.console&&w===!0||typeof w=="object"){T(w,"debug","log","info","warn","error");try{ee.log()}catch{ee=D}}else ee=D},I=ee}}).default})})($r);var Rt=Da($r.exports),Xt=globalThis&&globalThis.__assign||function(){return Xt=Object.assign||function(De){for(var ke,ve=1,re=arguments.length;ve<re;ve++){ke=arguments[ve];for(var j in ke)Object.prototype.hasOwnProperty.call(ke,j)&&(De[j]=ke[j])}return De},Xt.apply(this,arguments)},Fa=globalThis&&globalThis.__rest||function(De,ke){var ve={};for(var re in De)Object.prototype.hasOwnProperty.call(De,re)&&ke.indexOf(re)<0&&(ve[re]=De[re]);if(De!=null&&typeof Object.getOwnPropertySymbols=="function")for(var j=0,re=Object.getOwnPropertySymbols(De);j<re.length;j++)ke.indexOf(re[j])<0&&Object.prototype.propertyIsEnumerable.call(De,re[j])&&(ve[re[j]]=De[re[j]]);return ve};function Pa(De){var ke=De.hlsConfig,ve=De.playerRef,re=ve===void 0?Ia.createRef():ve,j=De.src,$=De.autoPlay,V=Fa(De,["hlsConfig","playerRef","src","autoPlay"]);return wa.exports.useEffect(function(){var D;function ee(){D!=null&&D.destroy();var h=new Rt(Xt({enableWorker:!1},ke));re.current!=null&&h.attachMedia(re.current),h.on(Rt.Events.MEDIA_ATTACHED,function(){h.loadSource(j),h.on(Rt.Events.MANIFEST_PARSED,function(){var c;$&&((c=re==null?void 0:re.current)===null||c===void 0||c.play().catch(function(){return console.log("Unable to autoplay prior to user interaction with the dom.")}))})}),h.on(Rt.Events.ERROR,function(c,q){if(q.fatal)switch(q.type){case Rt.ErrorTypes.NETWORK_ERROR:h.startLoad();break;case Rt.ErrorTypes.MEDIA_ERROR:h.recoverMediaError();break;default:ee();break}}),D=h}return Rt.isSupported()&&ee(),function(){D!=null&&D.destroy()}},[$,ke,re,j]),Rt.isSupported()?Qr("video",vr({},Xt({ref:re},V))):Qr("video",vr({},Xt({ref:re,src:j,autoPlay:$},V)))}export{Pa as R};
